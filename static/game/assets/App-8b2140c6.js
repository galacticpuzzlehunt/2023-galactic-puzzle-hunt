var ka=Object.defineProperty;var Ta=(a,r,s)=>r in a?ka(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s;var Le=(a,r,s)=>(Ta(a,typeof r!="symbol"?r+"":r,s),s);import{u as ee,a as Wt,b as Te,c as Ds,d as U,e as Ge,F as ct,f as he,r as _,j as e,S as Oe,s as B,g as xt,h as Yt,N as Ea,L as $e,i as Ue,k as Ut,T as W,l as Vt,m as $,n as cn,o as dn,p as wt,W as G,q as wa,t as Na,v as Ca,w as Aa,x as Ee,y as ie,G as Pt,z as Ia,A as We,P as Ae,B as cs,C as Pa,D as Da,E as Oa,H as fr,I as Ra,J as La,K as je,R as Gt,M as Ma,O as at,Q as pr,U as gr,V as At,X as te,Y as mt,Z as vr,_ as ve,$ as xr,a0 as Pe,a1 as qt,a2 as Ke,a3 as ht,a4 as ae,a5 as Zt,a6 as un,a7 as De,a8 as mn,a9 as br,aa as yr,ab as jr,ac as V,ad as dt,ae as Ye,af as _r,ag as ds,ah as Dt,ai as K,aj as us,ak as Ot,al as hn,am as zt,an as fn,ao as Sr,ap as za,aq as xe,ar as Fa,as as ps,at as Ba,au as bt,av as As,aw as Os,ax as Rs,ay as pn,az as ze,aA as Ls,aB as Ms,aC as $a,aD as kr,aE as gn,aF as Me,aG as Ua,aH as nt,aI as Ga,aJ as An,aK as ot,aL as Qt,aM as Tr,aN as Ha,aO as lt,aP as Ka,aQ as Wa,aR as Ie,aS as Qs,aT as vn,aU as yt,aV as xn,aW as Ya,aX as Va,aY as Er,aZ as Tt,a_ as Et,a$ as Gs,b0 as qa,b1 as bn,b2 as yn,b3 as rt,b4 as wr,b5 as jt,b6 as Js,b7 as Is,b8 as Ht,b9 as Za,ba as Xa,bb as Kt,bc as It,bd as jn,be as ye,bf as gt,bg as Ft,bh as Hs,bi as In,bj as Se,bk as gs,bl as re,bm as os,bn as Bt,bo as en,bp as Nr,bq as Qa,br as Ja,bs as eo,bt as to,bu as so,bv as no,bw as ro,bx as ao,by as Ce,bz as Nt,bA as oo,bB as io,bC as lo,bD as co,bE as uo,bF as mo,bG as ho,bH as fo,bI as po,bJ as ms,bK as Xt,bL as go,bM as vo,bN as xo,bO as bo,bP as Pn,bQ as Cr,bR as yo,bS as jo,bT as _n,bU as Dn,bV as On,bW as Ar,bX as _o,bY as Ir,bZ as Pr,b_ as Sn,b$ as So,c0 as is,c1 as Dr,c2 as ko,c3 as Or,c4 as To,c5 as Eo,c6 as wo,c7 as No,c8 as vs,c9 as et,ca as Rn,cb as Rr,cc as kn,cd as Co,ce as Ao,cf as Io,cg as tn,ch as Po,ci as Lr,cj as Ln,ck as Mn,cl as Tn,cm as Mr,cn as Do,co as zr,cp as Fr,cq as Br,cr as Oo,cs as Ro,ct as $r,cu as Ur,cv as $t,cw as St,cx as Lo,cy as Mo,cz as zo,cA as Fo,cB as Bo,cC as ge,cD as En,cE as Gr,cF as Hr,cG as $o,cH as Kr,cI as Ns,cJ as Uo,cK as Go,cL as Ho,cM as Jt,cN as Ks,cO as xs,cP as it,cQ as Ko,cR as Wo,cS as wn,cT as bs,cU as Yo,cV as ys,cW as vt,cX as Vo,cY as qo,cZ as zn,c_ as Zo,c$ as Xo,d0 as Wr,d1 as Qo,d2 as as,d3 as Yr,d4 as Jo,d5 as Fn,d6 as ei,d7 as Vr,d8 as zs,d9 as me,da as ke,db as js,dc as es,dd as Ws,de as ti,df as si,dg as ni,dh as ri,di as ai,dj as oi,dk as ii,dl as li,dm as ci,dn as di,dp as qr,dq as ui,dr as mi}from"./main-8c846e1d.js";function Bn(a,r,s){const{completionTime:n=1/0,factionScoreContribution:i,lastSolveTime:c=1/0,numSolves:u,speedrunInfo:{totalTime:p,numTimes:f},teamId:h}=a;return[-(r?i:0),-(s?f:0),s?p:0,n,-u,c,isNaN(+h)?0:+h]}function hs(a,r,s,n){const i=ee(c=>c.globalState.teams);return _.useMemo(()=>{const c=((n??!1)||B.isPosthunt)&&Object.keys(B.teamsSnapshot).length>0?B.teamsSnapshot:i;return Object.values(c).filter(u=>u.isHidden&&!(s??!1)?!1:a!==null?u.faction===a&&u.factionScoreContribution>0:r?u.speedrunInfo.numTimes>0:!0).sort((u,p)=>{const f=Bn(u,a!==null,r),h=Bn(p,a!==null,r);for(let g=0;g<f.length;g++)if(f[g]!==h[g])return f[g]-h[g];return u.displayName.localeCompare(p.displayName)})},[i,a,r,s,n])}function Zr({headerText:a}){return e.jsx($,{text:"Not all subpuzzles count toward the total time.",children:e.jsxs(W,{children:[a," üõà"]})})}const $n=()=>{const a=ee(S=>S.globalState.teamAdminData),r=Wt(S=>S.getServerInterfaceController)(),s=r===null?null:r.getTeamId(),{setNeedAdmin:n,setNeedTeamList:i}=Te(),c=Ds()??!1,u=U(),{mode:p}=Ge(),f=p&&Object.values(ct).includes(p),h=p==="speedrun",g=f?p:null,t=hs(g,h,!1,!0),[o]=he();if(_.useEffect(()=>{c&&n(!0)},[c,n]),_.useEffect(()=>{i(!0)},[i]),u===null)return e.jsx(Oe,{size:48});const{masteries:l,factionScores:d}=u,m=B.isPublicAccess||l[xt].isEnabled,v=B.isPublicAccess||l[Yt].isEnabled;if(f&&!m||h&&!v||p&&!f&&!h)return e.jsx(Ea,{to:"/teams",replace:!0});const x={hourCycle:"h23",timeZoneName:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},b=(S,w)=>cn[dn(S)].color(w),y=[];(m||v)&&y.push(e.jsx($e,{to:{pathname:"/teams",search:o.toString()},replace:!0,children:e.jsx("h2",{className:f||h?"":"highlight",children:"Solves"})},"solves")),v&&y.push(e.jsx($e,{to:{pathname:"/teams/speedrun",search:o.toString()},replace:!0,children:e.jsx("h2",{className:h?"highlight":"",children:"Speed"})},"speed")),m&&y.push(...Object.values(ct).sort((S,w)=>d[w]-d[S]).map(S=>e.jsx($e,{to:{pathname:S===g?"/teams":`/teams/${S}`,search:o.toString()},className:"teams-faction",replace:!0,children:e.jsx("h2",{className:S===g?"highlight":"",style:{backgroundColor:b(S,600)},children:e.jsx(Ue,{faction:S})})},S)));const j=t.map((S,w)=>{const{numSolves:P,completionTime:E,factionScoreContribution:C,speedrunInfo:{numTimes:R,totalTime:M}}=S,L=(()=>f?C:h?Ut(M):E?new Date(E).toLocaleString([],x):null)();return e.jsxs("tr",{className:`${s!==null&&S.teamId===s?"current-team":""}`,children:[e.jsxs("td",{children:[E===void 0?null:e.jsx(W,{tag:"span",children:"‚úàÔ∏è "}),w+1]}),e.jsxs("td",{children:[e.jsx(Vt,{teamData:S}),(()=>{if(!c||B.isImpersonate)return null;const D=a[S.teamId];return D===void 0?null:e.jsxs(e.Fragment,{children:[" ","(",e.jsx("a",{href:`${B.djangoBaseUrl}impersonate/${D.userId}`,children:"impersonate"}),")"]})})()]}),e.jsx("td",{children:h?R:P}),e.jsx("td",{children:L})]},S.teamId)}),T={backgroundColor:g?b(g,900):void 0};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"top-more-actions"}),e.jsx("h1",{children:"Team Scoreboard"}),e.jsxs("main",{children:[y.length===0?null:e.jsx("div",{className:"teams-faction-display",children:y}),e.jsxs("table",{className:"list-table",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"10%"}}),e.jsx("col",{style:{width:"60%"}}),e.jsx("col",{style:{width:"10%"}}),e.jsx("col",{style:{width:"20%"}})]}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:T,children:"Rank"}),e.jsx("th",{style:T,children:"Team"}),e.jsx("th",{style:T,children:"Solves"}),e.jsx("th",{style:T,children:g?e.jsxs(e.Fragment,{children:[d[g]," ",e.jsx(Ue,{faction:g})]}):h?e.jsx(Zr,{headerText:"Total time"}):"Finish time"})]}),j]})]})]})]})};function hi({teamData:a}){const r=U(),s=Wt(b=>b.getServerInterfaceController)(),[n,i]=_.useState(null);if(r===null||s===null)return e.jsx(Oe,{inline:!0});const{faction:c,factionScoreContributions:u,masteries:p}=r;if(!p[xt].isEnabled)return null;const f=a.teamId===r.teamId,h=f?n??c:a.faction,g=f?h===null?0:u[h]:a.factionScoreContribution,t=wa(g),o=Ca[t]??null,l=(b,y)=>cn[dn(b)].color(y),d=Object.values(ct).map(b=>{const y=h===b;return e.jsxs("h2",{className:`select-faction-faction${y?" highlight":""}${f?" selectable":""}`,onClick:f?()=>i(b===h?null:b):void 0,style:{backgroundColor:l(b,600)},children:[e.jsx(Ue,{faction:b}),wt(b)]},b)}),m=(()=>{if(h===null)return e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You can align with a faction. When you do, any points you earn from battle also get added to your faction's points. The more points you earn for your faction, the higher your faction rank, and the higher your rank, the more icons appear next to your team name!"}),e.jsx("p",{children:"(You can change your faction any time you have the Spark of Inspiration mastery activated, but points you gain for one faction don't carry over to another.)"})]});switch(h){case ct.BOARS:return e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Dryads? Dinos? RUBBISH! All those BACKWARDS TOP-DWELLERS do is SIT on their BUMS all day and take up precious CAVE-SPACE instead of PUTTING 'em LAND to WORK! Now down here, we do things RIGHT! Geyser pumps at every corner, hydroboarnics UP to the CEILING, AUTOMATION EVERYWHERE because we KNOW what MATTERS and that's EFFICIENCY! And BOARRIES!"}),e.jsx("p",{children:"So what's there to CHOOSE? STEAM 'em PUMPS, CRANK 'em GEARS, DEFEND our BOARDER from those dastardly BEES because the CAVE needs BOAR and BOAR needs YOU!"})]});case ct.COWS:return e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"The Cow Faction has little need for outsiders, of course, but in times like these we're willing to make some exceptions. See, word has come by that a sinister force threatens the safety of this cave. Naturally, this cave must be protected, yet on whom else but us Cows would this duty befall?"}),e.jsx("p",{children:"Obviously, the other paltry inhabitants of this cave remain ignorant of this threat. Not that they would make much of a difference, clearly, but they do like to get in our way. Aid us, and perhaps you might be worth enough to join us for cheese-tasting someday."}),e.jsx("p",{style:{textAlign:"right"},children:"‚Äî Signed, Grand Secretariat of the Bovine Folk, Head Production Manager of the Western and Southern Creameries, Founder of the Diplomatic Association of Pasture Enlargement and Other Cave-Related Matters, Director of the Critically Acclaimed Moovie ‚ÄúHerd: A Cattle Story‚Äù and Ambassador to the Royal Cow Academy, Butterton Moo."})]});case ct.BEES:return e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Hey, thanks for buzzzzing by! Here at the hive, we're all about the A Bee Cs and the 1 2 Trees! Yes, T, R, E, E, S! You won't beelieve how much H, O, N, E, Y drips off the trees every day, it's a struggle buggle to collect 'em all! Anyway, I gotta zip off, there's just so much H, O, N, E, Y to collect! Hope to seeya around!"}),e.jsx("p",{children:"What, flowers? Oh, you'll wanna ask the D, R, Y, A, Ds for that. We don't care much for flowers around here!"})]});case ct.DINOSAURS:return e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"I'll have you know that this cave ain't what it used to be! Back in the day, when we still called the shots, things made a mite more sense. We'd divvy up the Foods 'mongst the Factions, and, if you can picture it, we had more Pie to go around than you could shake a stick at!"}),e.jsx("p",{children:"But those days have gone the way of the dodo, and now all them young bucks know how to do is bicker and squabble, and them cows, oh my stars! Struttin' round like it ain't nobody's business, not a lick of respect for us Dinosaurs who busted our tails to build this place up. If you fancy yourselves any better, join us and help get this cave back up to its former glory!"})]});case ct.DRYADS:return e.jsxs(e.Fragment,{children:[e.jsx(W,{tag:"p",children:"...shrieks, cries... ...corruption spreads... üçÇ ...the flowers see... üåº ...the trees whisper..."}),e.jsx(W,{tag:"p",children:"...an ancient evil... ...a last stand... üåµ ...death, destruction... ...our children, slaves... ü•Ä"}),e.jsx(W,{tag:"p",children:"...must... ...resist... üå∫ ...help accepted..."})]})}})(),v=(()=>f?h!==null&&h!==c?e.jsxs("a",{className:"btn",href:"#",onClick:b=>{s.sendReq({type:G.SET_FACTION,faction:h}),b.preventDefault()},children:["Align with the ",wt(h)]}):c===null?"You‚Äôre not aligned with a faction yet. Select a faction to learn more!":`You are currently aligned with the ${wt(c)}.`:h===null?"This team is not aligned with a faction yet.":`This team is currently aligned with the ${wt(h)}.`)(),x=(()=>h===null||g===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Score"}),g," ",e.jsx(Ue,{faction:h})]}),e.jsxs("div",{children:[e.jsx("b",{children:"Rank"}),t===0?"None":e.jsx(Na,{faction:h,factionRank:t})]}),e.jsxs("div",{children:[e.jsx("b",{children:"Next rank"}),o===null?"(MAX!)":e.jsxs(e.Fragment,{children:[o," ",e.jsx(Ue,{faction:h})]})]})]}))();return e.jsxs("div",{className:"select-faction-display",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Faction"}),d]}),e.jsxs("div",{children:[e.jsxs("div",{className:"select-faction-actions",children:[e.jsx("div",{children:v}),x]}),e.jsx("div",{className:"select-faction-blurb",style:{backgroundColor:h===null?"var(--tray-bg-color)":l(h,900)},children:m})]})]})}function fi(){var y;const{djangoBaseUrl:a}=B,r=ee(j=>j.globalState.teams),s=B.isPosthunt&&Object.keys(B.teamsSnapshot).length>0?B.teamsSnapshot:r,{setNeedTeamList:n}=Te(),i=U(),{teamName:c}=Ge(),u=Object.values(s).find(j=>j.displayName==c)??Object.values(r).find(j=>j.displayName==c)??null,p=(u==null?void 0:u.teamId)??null,f=Aa(p),h=Ee(),[g]=he(),t=Wt(j=>j.getServerInterfaceController)(),o=Object.keys(r).length>0,l=ie(j=>j.showSubpuzzles),d=ie(j=>j.setShowSubpuzzles);if(_.useEffect(()=>{n(!0)},[n]),_.useEffect(()=>{if(!B.isPosthunt&&t!==null&&p!==null)return t.addSubscribeEffect({type:Pt.TEAM_MEMBERS,teamId:p})},[t,p]),_.useEffect(()=>{o&&u===null&&(Ia.toastr.error(`Team ‚Äú${c}‚Äù not found.`),h({pathname:"../teams",search:g.toString()}))},[o,u,c,h,g]),!o)return e.jsx(We,{});if(u===null)return null;const m={hourCycle:"h23",timeZoneName:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},v=j=>{j=Math.max(Math.floor(j/1e3),0);const T=Math.floor(j/(60*60));j-=T*60*60;const S=Math.floor(j/60);return j-=S*60,T>0?`${T}h${S}m`:S>0?`${S}m${j}s`:`${j}s`},x=(()=>{if(!i||i.teamId!==u.teamId)return null;const{puzzles:j,battleGroups:T,masteries:S}=i,w=S[Yt].isEnabled,P=(C,R,M,L,D)=>{const I=j[C].unlockTime??0,X=j[C].solveTime??0,Y=j[C].hasAnswer??!1,q=[L?"team-solves-subpuzzle":[],w&&D?"team-solves-unused":[]],ce=(()=>{if(M===0)return null;const J=v(M);return D?`(${J})`:J})();return e.jsxs("tr",{className:q.flat().join(" "),children:[e.jsx("td",{children:e.jsx(cs,{battleGroupName:C,hasAnswer:Y,children:R})}),w?e.jsx("td",{children:ce}):null,e.jsx("td",{children:new Date(I).toLocaleString([],m)}),e.jsx("td",{children:v(X-I)}),e.jsx("td",{children:new Date(X).toLocaleString([],m)})]},C)},E=Object.keys(T).filter(C=>!T[C].isCutscene).filter(C=>{var R;return(R=j[C])==null?void 0:R.solveTime}).sort((C,R)=>(j[C].solveTime??0)-(j[R].solveTime??0)).flatMap(C=>{const R=[Ae].includes(C)?[]:Object.values(j).filter(D=>D.battleGroupName===C&&D.puzName!==C).sort(({order:D},{order:I})=>D-I);let M=0;R.length===0&&(M=j[C].speedrunTime??0);const L=R.map(({puzName:D,battleGroupName:I,speedrunTime:X,solveTime:Y},q)=>{if(Y===void 0)return null;const ce=Pa(D,I,!1);return ce&&(M+=X??0),l?P(D,`#${q+1}`,X??0,!0,!ce):null});return L.unshift(P(C,T[C].displayName,M)),L});return E.length===0?null:e.jsxs("table",{className:"list-table team-solves-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{children:[e.jsx("h2",{children:"Solves"}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",onChange:C=>d(C.target.checked),checked:l})," ","Show subpuzzles"]})]}),w?e.jsx("th",{children:e.jsx(Zr,{headerText:"Best time"})}):null,e.jsx("th",{children:"Unlock time"}),e.jsx("th",{children:"Time to solve"}),e.jsx("th",{children:"Solve time"})]})}),e.jsx("tbody",{children:E})]})})(),b=!B.isPosthunt&&i&&i.teamId===u.teamId?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`${a}edit-team`,className:"btn",children:"Edit team members"})," ",e.jsx("a",{href:`${a}password-change`,className:"btn",children:"Change password"})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"top-more-actions",children:b}),e.jsx("h1",{children:e.jsx(Vt,{teamData:u,noLink:!0})}),e.jsxs("main",{style:{display:"flex",gap:"2.5em",flexDirection:"column"},children:[f===null?e.jsx(Oe,{inline:!0}):(y=f.members)==null?void 0:y.join(", "),e.jsx(hi,{teamData:u}),x]})]})}const pi="/static/game/assets/error-efcffc28.png";function gi(){const a=Da(),r=Oa(a)&&a.status===404;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px",alignItems:"center",justifyContent:"center",position:"fixed",inset:"0"},children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:`
.errorthing { animation: errorthing 5s ease-in-out infinite; }

@keyframes errorthing {
0% { filter: sepia(0.25) saturate(0); }
10% { filter: sepia(0.75) saturate(0.25); }
25% { filter: sepia(0.25) saturate(0.75); }
50% { filter: sepia(0) saturate(0.5); }
100% { filter: sepia(0.25) saturate(0); }
}
        `}}),e.jsx("h1",{children:r?"Page not found":"Something went wrong"}),e.jsx("a",{href:`${B.djangoBaseUrl}puzzles`,children:e.jsx("img",{src:pi,className:"errorthing"})}),e.jsx("h4",{style:{border:"none"},children:"You are in a maze of twisty little passages, all alike."}),r?e.jsx("div",{children:"(This is not a puzzle. Click above to go back.)"}):e.jsxs("div",{children:["(This is not a puzzle. Try refreshing, or"," ",e.jsx("a",{href:"mailto:contact@galacticpuzzlehunt.com",children:"contact us"}),".)"]})]})}const Un=a=>{const r={};for(const s of a)r[s]===void 0&&(r[s]=0),r[s]++;return r},fs=()=>B.devKnobs,vi=(a,r)=>{const s={[a]:[]};new Date().getTime();const n=B.deck===null?void 0:{id:"__urlparams_deck",displayName:"deck from url params",cards:Un(B.deck)},i=B.oppDeck===null?void 0:{id:"__urlparams_oppdeck",displayName:"deck from url params",cards:Un(B.oppDeck)};B.masteries!==null&&s[a].push({placements:{},connectedAnswers:[],masteriesListOverride:[...B.masteries]}),B.oppMasteries!==null&&s[a].push({placements:{},connectedAnswers:[],masteriesListOverride:[...B.oppMasteries]});const{role:c,puzName:u}=r,p=fr(u,Ra(u)),f=La(u),h=f[1],g=new Ma(h,f,{},{},p);return g.hasAI(),g.isAllCardsAvailable()||g.getDeckOverride(je.P1),g.isAllCardsAvailable()||g.getDeckOverride(je.P2),{readyForBattlePuzName:B.skipBattlePrep?u:void 0,role:c,devKnobs:fs(),decks:{[je.P1]:c!==void 0&&c===Gt.P2?i:n,[je.P2]:c!==void 0&&c===Gt.P2?n:i},masteryTrees:{[je.P1]:"default",[je.P2]:"default"}}};function Fs(a){const[r,s]=_.useState(window.innerWidth),[n,i]=_.useState(window.innerHeight),c=_.useRef(null);_.useEffect(()=>{if(c.current===null)return;const m=()=>{s(window.innerWidth),i(window.innerHeight)},v=new ResizeObserver(m);return v.observe(c.current),m(),()=>v.disconnect()});const{puzName:u,mapYOffset:p=0}=a,f=at(),h=pr(),g=u??f??h,t=U();if(t===null)return null;const{puzzles:o,battleGroups:l}=t,d=(()=>{if(g===null)return null;const{battleGroupName:m}=o[g]??{},{mapPos:v}=l[m]??{};return v===void 0?null:x=>{const b=v.y+p-20,y=b+100*n/r,j=50,T=Math.floor(b/j);return gr(x).slice(T,Math.ceil(y/j)).map((S,w)=>e.jsx(At,{className:"layer",src:S,style:{position:"absolute",top:(T+w)*j-b+"vw"}},w))}})();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"battle-bg",style:{background:"black"}}),d===null?e.jsx("div",{className:"battle-bg",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}):e.jsxs("div",{className:"battle-bg",ref:c,children:[d("2-cave-full"),d("islands")]})]})}function sn(){return sn=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(a[n]=s[n])}return a},sn.apply(this,arguments)}function Gn(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function nn(a,r){return nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},nn(a,r)}function xi(a,r){a.prototype=Object.create(r.prototype),a.prototype.constructor=a,nn(a,r)}var Hn=Number.isNaN||function(r){return typeof r=="number"&&r!==r};function bi(a,r){return!!(a===r||Hn(a)&&Hn(r))}function yi(a,r){if(a.length!==r.length)return!1;for(var s=0;s<a.length;s++)if(!bi(a[s],r[s]))return!1;return!0}function Ys(a,r){r===void 0&&(r=yi);var s,n=[],i,c=!1;function u(){for(var p=[],f=0;f<arguments.length;f++)p[f]=arguments[f];return c&&s===this&&r(p,n)||(i=a.apply(this,p),c=!0,s=this,n=p),i}return u}var ji=typeof performance=="object"&&typeof performance.now=="function",Kn=ji?function(){return performance.now()}:function(){return Date.now()};function Wn(a){cancelAnimationFrame(a.id)}function _i(a,r){var s=Kn();function n(){Kn()-s>=r?a.call(null):i.id=requestAnimationFrame(n)}var i={id:requestAnimationFrame(n)};return i}var Vs=-1;function Yn(a){if(a===void 0&&(a=!1),Vs===-1||a){var r=document.createElement("div"),s=r.style;s.width="50px",s.height="50px",s.overflow="scroll",document.body.appendChild(r),Vs=r.offsetWidth-r.clientWidth,document.body.removeChild(r)}return Vs}var Lt=null;function Vn(a){if(a===void 0&&(a=!1),Lt===null||a){var r=document.createElement("div"),s=r.style;s.width="50px",s.height="50px",s.overflow="scroll",s.direction="rtl";var n=document.createElement("div"),i=n.style;return i.width="100px",i.height="100px",r.appendChild(n),document.body.appendChild(r),r.scrollLeft>0?Lt="positive-descending":(r.scrollLeft=1,r.scrollLeft===0?Lt="negative":Lt="positive-ascending"),document.body.removeChild(r),Lt}return Lt}var Si=150,ki=function(r,s){return r};function Ti(a){var r,s=a.getItemOffset,n=a.getEstimatedTotalSize,i=a.getItemSize,c=a.getOffsetForIndexAndAlignment,u=a.getStartIndexForOffset,p=a.getStopIndexForStartIndex,f=a.initInstanceProps,h=a.shouldResetStyleCacheOnItemSizeChange,g=a.validateProps;return r=function(t){xi(o,t);function o(d){var m;return m=t.call(this,d)||this,m._instanceProps=f(m.props,Gn(m)),m._outerRef=void 0,m._resetIsScrollingTimeoutId=null,m.state={instance:Gn(m),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof m.props.initialScrollOffset=="number"?m.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},m._callOnItemsRendered=void 0,m._callOnItemsRendered=Ys(function(v,x,b,y){return m.props.onItemsRendered({overscanStartIndex:v,overscanStopIndex:x,visibleStartIndex:b,visibleStopIndex:y})}),m._callOnScroll=void 0,m._callOnScroll=Ys(function(v,x,b){return m.props.onScroll({scrollDirection:v,scrollOffset:x,scrollUpdateWasRequested:b})}),m._getItemStyle=void 0,m._getItemStyle=function(v){var x=m.props,b=x.direction,y=x.itemSize,j=x.layout,T=m._getItemStyleCache(h&&y,h&&j,h&&b),S;if(T.hasOwnProperty(v))S=T[v];else{var w=s(m.props,v,m._instanceProps),P=i(m.props,v,m._instanceProps),E=b==="horizontal"||j==="horizontal",C=b==="rtl",R=E?w:0;T[v]=S={position:"absolute",left:C?void 0:R,right:C?R:void 0,top:E?0:w,height:E?"100%":P,width:E?P:"100%"}}return S},m._getItemStyleCache=void 0,m._getItemStyleCache=Ys(function(v,x,b){return{}}),m._onScrollHorizontal=function(v){var x=v.currentTarget,b=x.clientWidth,y=x.scrollLeft,j=x.scrollWidth;m.setState(function(T){if(T.scrollOffset===y)return null;var S=m.props.direction,w=y;if(S==="rtl")switch(Vn()){case"negative":w=-y;break;case"positive-descending":w=j-b-y;break}return w=Math.max(0,Math.min(w,j-b)),{isScrolling:!0,scrollDirection:T.scrollOffset<y?"forward":"backward",scrollOffset:w,scrollUpdateWasRequested:!1}},m._resetIsScrollingDebounced)},m._onScrollVertical=function(v){var x=v.currentTarget,b=x.clientHeight,y=x.scrollHeight,j=x.scrollTop;m.setState(function(T){if(T.scrollOffset===j)return null;var S=Math.max(0,Math.min(j,y-b));return{isScrolling:!0,scrollDirection:T.scrollOffset<S?"forward":"backward",scrollOffset:S,scrollUpdateWasRequested:!1}},m._resetIsScrollingDebounced)},m._outerRefSetter=function(v){var x=m.props.outerRef;m._outerRef=v,typeof x=="function"?x(v):x!=null&&typeof x=="object"&&x.hasOwnProperty("current")&&(x.current=v)},m._resetIsScrollingDebounced=function(){m._resetIsScrollingTimeoutId!==null&&Wn(m._resetIsScrollingTimeoutId),m._resetIsScrollingTimeoutId=_i(m._resetIsScrolling,Si)},m._resetIsScrolling=function(){m._resetIsScrollingTimeoutId=null,m.setState({isScrolling:!1},function(){m._getItemStyleCache(-1,null)})},m}o.getDerivedStateFromProps=function(m,v){return Ei(m,v),g(m),null};var l=o.prototype;return l.scrollTo=function(m){m=Math.max(0,m),this.setState(function(v){return v.scrollOffset===m?null:{scrollDirection:v.scrollOffset<m?"forward":"backward",scrollOffset:m,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},l.scrollToItem=function(m,v){v===void 0&&(v="auto");var x=this.props,b=x.itemCount,y=x.layout,j=this.state.scrollOffset;m=Math.max(0,Math.min(m,b-1));var T=0;if(this._outerRef){var S=this._outerRef;y==="vertical"?T=S.scrollWidth>S.clientWidth?Yn():0:T=S.scrollHeight>S.clientHeight?Yn():0}this.scrollTo(c(this.props,m,v,j,this._instanceProps,T))},l.componentDidMount=function(){var m=this.props,v=m.direction,x=m.initialScrollOffset,b=m.layout;if(typeof x=="number"&&this._outerRef!=null){var y=this._outerRef;v==="horizontal"||b==="horizontal"?y.scrollLeft=x:y.scrollTop=x}this._callPropsCallbacks()},l.componentDidUpdate=function(){var m=this.props,v=m.direction,x=m.layout,b=this.state,y=b.scrollOffset,j=b.scrollUpdateWasRequested;if(j&&this._outerRef!=null){var T=this._outerRef;if(v==="horizontal"||x==="horizontal")if(v==="rtl")switch(Vn()){case"negative":T.scrollLeft=-y;break;case"positive-ascending":T.scrollLeft=y;break;default:var S=T.clientWidth,w=T.scrollWidth;T.scrollLeft=w-S-y;break}else T.scrollLeft=y;else T.scrollTop=y}this._callPropsCallbacks()},l.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&Wn(this._resetIsScrollingTimeoutId)},l.render=function(){var m=this.props,v=m.children,x=m.className,b=m.direction,y=m.height,j=m.innerRef,T=m.innerElementType,S=m.innerTagName,w=m.itemCount,P=m.itemData,E=m.itemKey,C=E===void 0?ki:E,R=m.layout,M=m.outerElementType,L=m.outerTagName,D=m.style,I=m.useIsScrolling,X=m.width,Y=this.state.isScrolling,q=b==="horizontal"||R==="horizontal",ce=q?this._onScrollHorizontal:this._onScrollVertical,J=this._getRangeToRender(),F=J[0],fe=J[1],se=[];if(w>0)for(var ne=F;ne<=fe;ne++)se.push(_.createElement(v,{data:P,key:C(ne,P),index:ne,isScrolling:I?Y:void 0,style:this._getItemStyle(ne)}));var pe=n(this.props,this._instanceProps);return _.createElement(M||L||"div",{className:x,onScroll:ce,ref:this._outerRefSetter,style:sn({position:"relative",height:y,width:X,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:b},D)},_.createElement(T||S||"div",{children:se,ref:j,style:{height:q?"100%":pe,pointerEvents:Y?"none":void 0,width:q?pe:"100%"}}))},l._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var m=this.props.itemCount;if(m>0){var v=this._getRangeToRender(),x=v[0],b=v[1],y=v[2],j=v[3];this._callOnItemsRendered(x,b,y,j)}}if(typeof this.props.onScroll=="function"){var T=this.state,S=T.scrollDirection,w=T.scrollOffset,P=T.scrollUpdateWasRequested;this._callOnScroll(S,w,P)}},l._getRangeToRender=function(){var m=this.props,v=m.itemCount,x=m.overscanCount,b=this.state,y=b.isScrolling,j=b.scrollDirection,T=b.scrollOffset;if(v===0)return[0,0,0,0];var S=u(this.props,T,this._instanceProps),w=p(this.props,S,T,this._instanceProps),P=!y||j==="backward"?Math.max(1,x):1,E=!y||j==="forward"?Math.max(1,x):1;return[Math.max(0,S-P),Math.max(0,Math.min(v-1,w+E)),S,w]},o}(_.PureComponent),r.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},r}var Ei=function(r,s){r.children,r.direction,r.height,r.layout,r.innerTagName,r.outerTagName,r.width,s.instance},wi=Ti({getItemOffset:function(r,s){var n=r.itemSize;return s*n},getItemSize:function(r,s){var n=r.itemSize;return n},getEstimatedTotalSize:function(r){var s=r.itemCount,n=r.itemSize;return n*s},getOffsetForIndexAndAlignment:function(r,s,n,i,c,u){var p=r.direction,f=r.height,h=r.itemCount,g=r.itemSize,t=r.layout,o=r.width,l=p==="horizontal"||t==="horizontal",d=l?o:f,m=Math.max(0,h*g-d),v=Math.min(m,s*g),x=Math.max(0,s*g-d+g+u);switch(n==="smart"&&(i>=x-d&&i<=v+d?n="auto":n="center"),n){case"start":return v;case"end":return x;case"center":{var b=Math.round(x+(v-x)/2);return b<Math.ceil(d/2)?0:b>m+Math.floor(d/2)?m:b}case"auto":default:return i>=x&&i<=v?i:i<x?x:v}},getStartIndexForOffset:function(r,s){var n=r.itemCount,i=r.itemSize;return Math.max(0,Math.min(n-1,Math.floor(s/i)))},getStopIndexForStartIndex:function(r,s,n){var i=r.direction,c=r.height,u=r.itemCount,p=r.itemSize,f=r.layout,h=r.width,g=i==="horizontal"||f==="horizontal",t=s*p,o=g?h:c,l=Math.ceil((o+n-t)/p);return Math.max(0,Math.min(u-1,s+l-1))},initInstanceProps:function(r){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(r){r.itemSize}});const Xr=(a,{teamId:r,hasPvP:s,isPvPGameActive:n},i,c)=>a===r?"self":s??!1?n??!1?"game_active":i?"blocked":c?"blocked_by":null:"no_pvp";function Ni(a){const{teamData:r,incomingRequest:s,outgoingRequest:n,isBlocked:i,isBlockedBy:c,style:u}=a,{teamId:p}=r,[f,h]=_.useState(0),[g,t]=_.useState(null),[o,l]=_.useState(null),d=te(),m=mt(),v=Pe(),x=qt(v),b=x===null?null:x===Ke.ACTIVE,y=m===null?null:Xr(m,r,i,c),j=ht(je.P1);if(_.useEffect(()=>{let M=null;const L=()=>{const I=new Date().getTime()/1e3;return(Math.floor(I+1)-I)*1e3},D=()=>{const I=new Date().getTime();s!==void 0&&s.expiryTime>I?(t(s),l(null),h(s.expiryTime-I)):n!==void 0&&n.expiryTime>I?(t(null),l(n),h(n.expiryTime-I)):(t(null),l(null),h(0)),M=window.setTimeout(D,L())};return D(),()=>{M!==null&&clearTimeout(M)}},[l,t,h,n,s]),b===null||j===null)return null;const{selectedDeckSlot:T,isSelectedDeckValid:S=!1}=j,w=(()=>T===null?"You have no deck selected.":S?null:"Your deck is invalid.")(),P=(()=>o!==null?"Cancel":g!==null?"Accept":"Challenge")(),E=(()=>{if(y===null)return null;switch(y){case"self":return"Yourself";case"no_pvp":return"PvP not enabled";case"game_active":return"Battle in progress";case"blocked":return"Blocked";case"blocked_by":return"Blocked by them"}})(),C=Math.floor(f/1e3/60),R=Math.floor(f/1e3)%60;return e.jsxs("div",{className:`pvp-lobby-team${i||c?" blocked":""}`,style:u,children:[e.jsxs("div",{className:"pvp-lobby-team-label",children:[e.jsx("div",{className:"pvp-lobby-team-name",children:e.jsx(Vt,{teamData:r,invalid:y!==null})}),E===null?null:e.jsxs("div",{className:"pvp-lobby-invalid-reason",children:["(",E,")"]}),f===0?null:e.jsxs("div",{className:"pvp-lobby-countdown",children:[C.toString().padStart(2,"0"),":",R.toString().padStart(2,"0")]})]}),e.jsx("div",{children:e.jsx($,{text:w!==null?w:void 0,children:e.jsx("button",{className:"pvp-lobby-btn-challenge",disabled:y!==null||b||w!==null,onClick:()=>{o!==null?d.sendReq({type:G.PVP_CANCEL_REQUEST,targetTeamId:p}):g!==null?d.sendReq({type:G.PVP_ACCEPT_REQUEST,targetTeamId:p,devKnobs:fs()}):d.sendReq({type:G.PVP_MAKE_REQUEST,targetTeamId:p,autoAccept:B.pvpAutoAccept?!0:void 0})},children:P})})}),e.jsx("div",{children:e.jsx("button",{disabled:m===null||m===p,className:"pvp-lobby-btn-block",onClick:()=>{d.sendReq({type:G.PVP_SET_IS_BLOCKED,targetTeamId:p,isBlocked:!i})},children:i?"Unblock":"Block"})})]})}function ts(a){const{tab:r,refTimeNow:s}=a,n=ie(h=>h.pvpLobbyTab),i=ie(h=>h.setPvPLobbyTab),{incomingRequests:c={}}=vr()??{},u=Object.values(c).filter(({expiryTime:h})=>s&&h>s).length>0,p=(()=>{switch(r){case ve.ALL:return"üëã";case ve.OUTGOING:return"üì§";case ve.INCOMING:return"üì•";case ve.BLOCKED:return"üö´";case ve.RING:return"ü§º"}})(),f=(()=>{switch(r){case ve.ALL:return"Show all teams.";case ve.OUTGOING:return"Show teams you‚Äôve sent challenges to.";case ve.INCOMING:return"Show teams who‚Äôve sent challenges to you.";case ve.BLOCKED:return"Show teams you‚Äôve blocked. Blocked teams can‚Äôt send you challenges.";case ve.RING:return"Show teams who are in the ring. Entering the ring sends a challenge to every team in it."}})();return e.jsx($,{text:f,children:e.jsx("button",{className:`pvp-lobby-menu-btn${n===r?" highlight":""}${r===ve.INCOMING&&u?" extra-highlight":""}`,onClick:()=>{i(r)},children:e.jsx(W,{children:p})})})}function Ci(){const a=te(),r=mt(),s=U(),n=vr(),i=Te(E=>E.setNeedTeamList),c=ee(E=>E.globalState.teams),u=ee(E=>E.globalState.pvp),p=ie(E=>E.pvpLobbyTab),f=ie(E=>E.setPvPLobbyTab),h=ie(E=>E.hideInvalid),g=ie(E=>E.setHideInvalid),[t,o]=_.useState([]),[l,d]=_.useState(new Date().getTime()),[m,v]=_.useState(""),x=hs(null,!1,!0);if(_.useEffect(()=>{i(!0)},[i]),_.useEffect(()=>{if(r!==null)return a.addSubscribeEffect({type:Pt.TEAM_PVP,teamId:r})},[a,r]),_.useEffect(()=>a.addSubscribeEffect({type:Pt.PVP}),[a]),_.useEffect(()=>{if(n===null||u===null||c===null)return;const{outgoingRequests:E,incomingRequests:C,blockedTeams:R,blockedByTeams:M}=n,{ring:L}=u;o((()=>{switch(p){case ve.ALL:return x.filter(({isHidden:I})=>!I);case ve.OUTGOING:return x.filter(({teamId:I})=>E[I]!==void 0&&E[I].expiryTime>l);case ve.INCOMING:return x.filter(({teamId:I})=>C[I]!==void 0&&C[I].expiryTime>l);case ve.BLOCKED:return x.filter(({teamId:I})=>R[I]??!1);case ve.RING:return L.map(I=>c[I])}})().filter(I=>I.displayName.toLowerCase().includes(m)?h?r!==null&&Xr(r,I,R[I.teamId]??!1,M[I.teamId]??!1)===null:!0:!1));const D=[...Object.values(C),...Object.values(E)].filter(({expiryTime:I})=>I>l);if(D.length>0){const I=Math.min(...D.map(({expiryTime:Y})=>Y)),X=window.setTimeout(()=>{d(new Date().getTime())},I-l);return()=>{window.clearTimeout(X)}}},[p,h,r,l,n,u,c,x,m]),r===null||u===null||s===null||n===null||c===null)return e.jsx(We,{inline:!0});const{outgoingRequests:b,incomingRequests:y,blockedTeams:j,blockedByTeams:T}=n,{ring:S}=u,w=S.includes(r),P=s.masteries[xr].isEnabled;return e.jsx(e.Fragment,{children:P?e.jsxs("div",{className:"pvp-lobby-root",children:[e.jsxs("div",{className:"pvp-lobby-menu",children:[e.jsxs("div",{className:"pvp-lobby-menu-top",children:[e.jsx(ts,{tab:ve.ALL}),e.jsx(ts,{tab:ve.OUTGOING}),e.jsx(ts,{tab:ve.INCOMING,refTimeNow:l}),e.jsx(ts,{tab:ve.BLOCKED}),e.jsx(ts,{tab:ve.RING}),e.jsx($,{text:"Hide teams you can't challenge.",children:e.jsxs("label",{className:"pvp-hide-invalid",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:()=>{g(!h)}})," ","Hide invalid"]})})]}),e.jsxs("div",{className:"pvp-lobby-menu-bottom",children:[e.jsx($,{text:w?"Resend a challenge to everyone in the ring.":"Enter the ring, and send a challenge to everyone in it.",children:e.jsx("button",{className:"pvp-lobby-menu-btn",onClick:()=>{a.sendReq({type:G.PVP_ENTER_RING}),f(ve.RING)},children:e.jsx(W,{children:w?"‚è©ü§º":"‚ñ∂Ô∏èü§º"})})}),e.jsx($,{text:"Leave the ring. You'll stop getting challenged by teams entering the ring.",children:e.jsx("button",{className:"pvp-lobby-menu-btn",disabled:!w,onClick:()=>{a.sendReq({type:G.PVP_LEAVE_RING})},children:e.jsx(W,{children:"‚èπÔ∏èü§º"})})})]})]}),e.jsx(wi,{height:500,itemCount:t.length,itemSize:38,width:"100%",children:({index:E,style:C})=>{const R=t[E],{teamId:M}=R,L=j[M]??!1,D=T[M]??!1;return e.jsx(Ni,{teamData:R,outgoingRequest:b[M],incomingRequest:y[M],isBlocked:L,isBlockedBy:D,style:{...C,background:E%2===0?L||D?"#644":"#444":L||D?"#422":"#222"}},M)}}),e.jsxs("div",{className:"pvp-team-search",children:[e.jsx(W,{children:"üîç"})," ",e.jsx("input",{placeholder:"Search for a team...",onChange:E=>v(E.target.value.toLowerCase().trim())})]})]}):e.jsxs("div",{className:"pvp-disabled",children:[e.jsx("h4",{children:"PvP is disabled!"}),"Your team will be unable to participate until you activate it (but you can continue a match if you already have one going)."]})})}const Ai=({content:a,onClick:r,disabled:s})=>{const[n,i]=_.useState(!0);return _.useEffect(()=>{setTimeout(()=>i(!1),300)},[]),e.jsxs("div",{className:"cutscene-dialog-option",onClick:n||s?void 0:r,style:n||s?{cursor:"wait"}:{},children:[e.jsx("div",{children:a}),e.jsx("div",{children:"‚ñ∂"})]})},Bs=a=>{const{dialogue:r,speaker:s,preventScroll:n=!1,dialogOptionsConfig:i}=a,c=ae(t=>t.sendStep),u=U(),p=Zt();if(u===null)return null;const{cardUnlocks:f}=u,h=un(Object.keys(f),0),g=(()=>{if(s===null)return null;switch(s){case De.NARRATOR:case De.ENEMY:case De.KERO_DOS:return null;case De.KERO:return"kero.png";case De.ANGRY_KERO:return"angry-kero.png";case De.DINO:return"generic-dino.png";case De.CAPTAIN_PI:return"captain-pi.png"}})();return e.jsxs("div",{className:"cutscene-dialog-box",children:[s===De.KERO_DOS?e.jsx(mn,{className:"cutscene-speaker",keroLayers:h}):s===null||g===null?null:e.jsx("div",{className:"cutscene-speaker",children:e.jsx(At,{className:[De.CAPTAIN_PI].includes(s)?"cutscene-speaker-img-limit-width":"cutscene-speaker-img-limit-height",src:br(g)})}),e.jsxs("div",{className:"cutscene-dialog-main",children:[e.jsx(yr,{options:{...jr,overflow:{y:n?"visible":"scroll"}},defer:!0,className:"cutscene-dialogue",style:n?{overflowY:"initial"}:void 0,children:r===void 0?null:e.jsx(V,{text:r,opts:{ignoreKeywords:!0,lineGap:"0"}})}),i!==void 0?e.jsx("div",{className:"cutscene-dialog-options",children:i.dialogOptions.map((t,o)=>e.jsx(Ai,{onClick:()=>{c==null||c({type:dt.ADVANCE_KEYFRAME,keyframeId:i.keyframeId,dialogOptionIndex:o})},content:t,disabled:p},t))}):null]})]})},Nn=a=>{const{keyframe:r}=a;ae(g=>g.sendStep);const n=Ye().isGameActive(),{id:i,speaker:c=null,dialogue:u,showNext:p=!1,dialogOptions:f=["..."]}=r,h=["tutorial6-start-no-deck","post-final-battle-start"].includes(i);return e.jsx(Bs,{dialogue:u,speaker:c,preventScroll:h,dialogOptionsConfig:p&&n?{keyframeId:i,dialogOptions:f}:void 0})},Ii=a=>{const r=new Promise(s=>{const n=()=>{const i=document.body.scrollHeight-window.innerHeight-10;(Math.abs(window.scrollY-a)<=10||a>i&&window.scrollY>i)&&(window.removeEventListener("scroll",n),s())};n(),window.addEventListener("scroll",n,{passive:!0})});return window.scrollTo({top:a,behavior:"smooth"}),r},Qr=(a,r)=>{const{hasAnswer:s=!1}=a,{battleGroupName:n,isCutscene:i=!1,isLegendary:c=!1}=r;return _r(s,n,i,c)};function Jr(){const a=U(),r=Dt();if(r===null||a===null)return null;const{preBattleDialogue:s}=r;if(s===void 0)return null;const i=s.trim().split(`
`).map((c,u)=>{const p=c.startsWith("kero:"),f=c.startsWith("dino:"),h=c.startsWith("captain pi:"),g=(()=>p||f||h?c.slice(c.indexOf(":")+1).trim():c)();return e.jsx("div",{className:"prep-dialogue-line",style:{alignSelf:p||h?"flex-end":"flex-start"},children:e.jsx(Bs,{dialogue:g,speaker:p?De.KERO_DOS:f?De.DINO:h?De.CAPTAIN_PI:De.NARRATOR})},u)});return e.jsx("div",{className:"prep-dialogue",children:i})}function Pi(){const a=Pe(),r=U(),s=ds(),n=fn(),i=Dt(),c=Sr(),u=Ot(),p=te(),[f]=he(),h=Ee(),g=_.useMemo(()=>{const l=[];if(r===null)return l;const{puzzles:d,battleGroups:m}=r,v={};for(const x of Object.values(d).sort((b,y)=>b.order-y.order)){const{puzName:b,battleGroupName:y,hasAnswer:j=!1}=x,T=m[y],S=Qr(x,T);if(!za(j??!1,b,y,T.numPuzzles))continue;const w=v[y]??0;v[y]=w+1,w===0&&l.push({puzName:b,battleGroup:T,icon:S})}return l},[r]);if(r===null||s===null)return null;u==null||u.selectedPuzName;const{roomStatus:t}=r.puzzles[a],o=t===Ke.ACTIVE;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"prep-instancer-room-selection",children:(n??[]).map(({puzName:l},d)=>e.jsxs("button",{className:`prep-puz-selection-row-btn${a===l?" highlight":""}`,onClick:()=>h({pathname:`../prep/${l}`,search:f.toString()},{replace:!0}),children:["Room ",d+1]},d))}),e.jsxs("select",{id:"prep-instancer-select",value:(c==null?void 0:c[0].puzName)??"",disabled:o,onChange:l=>{const d=l.target.value;d!==""&&a!==null&&p.sendReq({type:G.SELECT_PUZZLE,hostPuzName:a,selectedPuzName:d})},children:[e.jsx("option",{disabled:!0,hidden:!0,value:""},""),g.map(({puzName:l,battleGroup:d,icon:m})=>e.jsx("option",{value:l,children:`${m} ${d.displayName}`},l))]}),u===null?e.jsx(Oe,{size:48,inline:!0}):e.jsxs(e.Fragment,{children:[e.jsx(zt,{battleGroupName:(i===null?s:i).battleGroupName}),e.jsx(Jr,{})]})]})}function Di(a){const s=Pe()===xe,n=U(),i=ds(),c=Dt(),u=K(v=>v.setIsInstancerModalOpen),p=K(v=>v.setIsPvPModalOpen),f=us()??!1,h=Ot();if(i===null||n===null)return e.jsx(Oe,{size:48,inline:!0});const{battleGroupName:g,displayName:t}=i,{puzzles:o}=n,l=o[g].solveTime!==void 0,d={hour12:!0,timeZoneName:"short",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},m=Object.values((h==null?void 0:h.errata)??{}).sort((v,x)=>v.timestamp-x.timestamp).map(v=>e.jsxs("div",{children:[v.published?null:e.jsxs("strong",{children:["[",e.jsx("a",{href:`${B.djangoBaseUrl}admin/puzzles/erratum/${v.erratumId}/change/`,children:"UNPUBLISHED"}),"]"]})," ","On ",new Date(v.timestamp).toLocaleString([],d),","," ",e.jsx("span",{dangerouslySetInnerHTML:{__html:v.text}})]},v.erratumId));return s?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"prep-header",children:[t,e.jsx($,{text:"Click for more info",children:e.jsx("div",{className:"prep-help-btn",onClick:()=>{p(!0)},children:e.jsx(W,{children:"üõà"})})})]}),e.jsx(Ci,{})]}):e.jsxs("div",{className:`prep-left${f?" prep-left-instancer":""}`,style:{alignSelf:s?"start":void 0,maxHeight:s?"100vh":void 0},children:[e.jsxs("h2",{className:"prep-header",children:[t,f?e.jsx($,{text:"Click for more info",children:e.jsx("div",{className:"prep-help-btn",onClick:()=>{u(!0)},children:e.jsx(W,{children:"üõà"})})}):null,l?e.jsxs("div",{className:"solved-title-marker",children:[hn(i),"!"]}):null]}),m.length?e.jsx("div",{className:"puzzle-erratum",children:m}):null,e.jsx("div",{className:"prep-main",children:e.jsx(e.Fragment,{children:f?e.jsx(Pi,{}):c!==null?e.jsxs(e.Fragment,{children:[e.jsx(zt,{battleGroupName:c.battleGroupName}),e.jsx(Jr,{})]}):null})})]})}function Oi(){return e.jsxs("div",{children:["The Instancer is a web of parallel timelines maintained by a group of spiders known as the Overworked Web Operatives! It comes with three rooms that you can use to create additional instances of battles or cutscenes at any time. These instances behave exactly like their ",e.jsx("q",{children:"real"})," ","counterparts ‚Äî and if you win in an instance, you win in real life!"]})}function Ri(){return e.jsxs("div",{className:"prep-pvp-modal-content",children:[e.jsx("p",{children:"The PvP Arena is a place where you can challenge other teams to battle!"}),e.jsx("b",{children:"Challenging teams:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"To challenge a team, select a deck, then find the team in the list and click Challenge. You can challenge any team that has the PvP mastery, isn‚Äôt already in a PvP battle, and hasn‚Äôt blocked you."}),e.jsxs("li",{children:["To accept a challenge, select a deck, find the team that sent you the challenge in the incoming challenges tab (the tab labeled"," ",e.jsx(W,{tag:"span",children:"üì•"}),"), then click Accept. You have one minute to accept a challenge before it expires."]}),e.jsxs("li",{children:["To find teams to challenge, check out the ring (the tab labeled"," ",e.jsx(W,{tag:"span",children:"ü§º"}),"). You can enter the ring by clicking"," ",e.jsx(W,{tag:"span",children:"‚ñ∂Ô∏èü§º"}),". If you‚Äôve selected a deck, this also sends a challenge to every team in the ring."]})]}),e.jsx("b",{children:"Battle changes:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You get 5√ó more faction points."}),e.jsx("li",{children:"Legendary cards aren‚Äôt allowed."}),e.jsxs("li",{children:["The first player starts with ",e.jsx(V,{text:"{?}"})," on their first turn, rather than ",e.jsx(V,{text:"{???}"}),"."]}),e.jsx("li",{children:"Each player has a 3-minute time limit for each turn, shown next to the board by their team name. If a player runs out of time, their opponent can claim a win on time."})]})]})}const ss=24;function Ps(){const a=U(),r=ee(m=>m.globalState.factionHistory),{setNeedFactionHistory:s}=Te();_.useEffect(()=>{s(!0)},[s]);const[n,i]=_.useState(null);if(a===null)return null;const{faction:c,factionScores:u,masteries:p}=a;if(!p[xt].isEnabled||c===null)return null;const f=Object.entries(u).sort(([m,v],[x,b])=>b-v),h=Math.floor(Date.now()/1e3/60/60)-ss,g=Object.fromEntries(Object.values(ct).map(m=>[m,[]]));for(const[m,v]of Object.entries(r).sort()){const[x,b]=m.split(".");g[x].push({time:+b-h,score:v})}let t=1;const l=f.map(([m])=>{const v=[];let x=0;for(const{time:b,score:y}of[...g[m],{time:1/0,score:0}]){for(;v.length<b&&v.length<=ss;)v.push(x);x+=y}return t=Math.max(t,x),{faction:m,line:v}}).map(({faction:m,line:v})=>e.jsx("path",{onMouseEnter:()=>i(m),onMouseLeave:()=>i(null),fill:"none",stroke:cn[dn(m)].color(400),style:{strokeDasharray:m===n?"1 1":void 0},d:v.map((x,b)=>`${b?"L":"M"} ${b} ${(1-x/(t*1.2))*ss*.75}`).join(" "),children:e.jsx("title",{children:wt(m)})},m)),d=f.map(([m,v])=>e.jsxs("div",{className:`faction-score-totals-row${m===c?" highlight":""}`,onMouseEnter:()=>i(m),onMouseLeave:()=>i(null),style:{backgroundColor:m===n?"rgba(255,255,255,0.5)":void 0},children:[e.jsx(Ue,{faction:m}),e.jsx("div",{className:"faction-score-totals-score",children:v})]},m));return e.jsxs("div",{className:"faction-score-totals-display",children:[e.jsx("div",{children:e.jsx("h4",{children:"Global faction scores"})}),e.jsxs("div",{className:"faction-score-totals-main",children:[e.jsx("svg",{className:"faction-score-totals-graph",viewBox:`0 0 ${ss} ${ss*.75}`,preserveAspectRatio:"none",children:l}),e.jsx("div",{className:"faction-score-totals-list",children:d})]})]})}function rn({puzName:a}){var o;const r=te(),s=mt(),n=U(),i=Fa(a);if(_.useEffect(()=>{if(s!==null&&a!==null)return r.addSubscribeEffect({type:Pt.TEAM_SPEEDRUN_LEADERBOARD_SUMMARY,teamId:s,puzName:a})},[r,s,a]),n===null||i===null||a===null)return null;const{masteries:c}=n,{speedrunLeaderboardSummary:u,speedrunRank:p}=i,f=(o=n.puzzles[a])==null?void 0:o.speedrunTime;if(!c[Yt].isEnabled||u===void 0||u.length<=0||p===void 0||f===void 0)return null;const h=(l,d)=>e.jsxs("div",{className:"prep-speedrun-record",children:[e.jsx("div",{className:"prep-speedrun-rank-cell",children:l}),e.jsx("div",{className:"prep-speedrun-name-cell",children:e.jsx(Vt,{teamData:d.teamData})}),e.jsx("div",{children:Ut(d.speedrunTime)})]},d.teamData.teamId),g=u.slice(0,ps).map((l,d)=>h(d+1,l)),t=p<ps?null:e.jsxs(e.Fragment,{children:[p>ps?e.jsx("div",{children:"‚ãÆ"}):null,h(p+1,{teamData:Ba(n),speedrunTime:f})]});return e.jsxs("div",{className:"prep-speedrun",children:[e.jsx("div",{children:e.jsx("h4",{children:"Top runs"})}),g,p>=ps?t:null]})}const $s=_.createContext({allowEmpty:!1,className:"tabs",emptyContent:null,index:-1,setIndex:()=>{},items:[]});function ea(a){const{emptyContent:r,className:s="tabs",index:n,setIndex:i,items:c,children:u,...p}=a,[f,h]=_.useState(r?-1:0),g=n!==void 0&&i!==void 0,t=g?n:f,o=_.useCallback(l=>{(g?i:h)(l)},[g,i]);return e.jsx($s.Provider,{value:{allowEmpty:!!r,className:s,emptyContent:r??null,index:t,setIndex:o,items:c},children:e.jsx("div",{className:`${s}-tabbed`,...p,children:u})})}function ta(a){const{className:r}=_.useContext($s);return e.jsx("div",{...a,className:`${r}-tabs tabs-tabs ${a.className}`})}function sa({makeProps:a,overridden:r}){const{allowEmpty:s,className:n,index:i,setIndex:c,items:u}=_.useContext($s),p=_.useCallback(f=>{const h=(g,t)=>{const o=!r&&t===f;return e.jsx($,{text:g.tooltip,directRef:l=>_.createElement("button",{...a==null?void 0:a(t),key:g.label,className:`${n}-tab tabs-tab ${o?"active":"inactive"}`,onClick:()=>c(o?-1:t),disabled:g.isDisabled||(s?!1:o),...l},e.jsx(W,{children:g.label}))},g.label)};return e.jsx(e.Fragment,{children:u.map(h)})},[s,n,u,a,c,r]);return e.jsx(e.Fragment,{children:p(i)})}function na(){const{emptyContent:a,index:r,items:s}=_.useContext($s),n=0<=r&&r<s.length?s[r].content:a;return e.jsx(e.Fragment,{children:n})}function Li(a){return e.jsxs(ea,{...a,children:[e.jsx(ta,{children:e.jsx(sa,{})}),e.jsx("div",{className:`${a.className}-content`,children:e.jsx(na,{})})]})}const st={Buttons:sa,ButtonList:ta,Container:ea,Content:na,Tabbed:Li};function Mi(a){const{player:r}=a,s=te(),n=Ee(),i=Pe(),c=at(),u=i===xe,p=bt(C=>C.isSpectating),f=U(),h=Dt(),g=qt(i),t=ht(r),[o]=he(),[l,d]=_.useState(!1);if(h===null||f===null)return null;const{selectedDeckFailedChecks:m,isDeckLocked:v}=t,{isCutscene:x=!1}=h,{puzzles:b}=f,y=c!==null&&b[c].solveTime!==void 0,j=!x&&!u,T=()=>{i!==null&&n({pathname:`../${x?"cutscene":"battle"}/${i}`,search:o.toString()})},S=()=>{i!==null&&n({pathname:`../${x?"cutscene":"battle"}/${i}/start`,search:o.toString()})},w=()=>{i!==null&&s.sendReq({type:G.RESIGN,player:r,puzName:i})},P=()=>s.sendReq({type:G.PVP_UNLOCK_DECK}),E=[];if(g===Ke.ACTIVE&&(E.push([`Join your teammates in the ${x?"cutscene":"battle"}!`,T,`Join ${x?"cutscene":"battle"}`]),u||E.push([`End the ${x?"cutscene":"battle"}.`,()=>d(!0),"End"])),g!==Ke.ACTIVE){if(u&&v&&E.push(["Unlock your deck. This cancels any outgoing requests.",P,"Unlock deck"]),!u&&!p){const C=As(m),R=c===null?"Select a battle/cutscene.":C?`${C} Pick a valid deck.`:y?`You‚Äôve already completed this ${x?"cutscene":"battle"}, but you may ${x?"watch":"play"} it again.`:`${x?"Watch the cutscene!":"Start the battle!"}`,M=`${y?"Replay":x?"Watch":"Start"} ${x?"cutscene":"battle"}!`;E.push([R,C?void 0:S,M])}x&&E.push(["",void 0,"End"])}if(j)switch(g){case Ke.INACTIVE:{E.push(["View the final field.",T,"View"]);break}case Ke.NONE:{E.push(["",void 0,"End"]);break}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"prep-battle-control",children:[c===Os&&y?e.jsx($,{text:"Skip to end.",directRef:C=>e.jsx("a",{href:`${B.djangoBaseUrl}victory`,...C,children:e.jsx("button",{children:e.jsx(W,{style:{fontSize:"2em"},children:"ü•ßÔ∏è"})})})}):null,E.map(([C,R,M])=>e.jsx($,{text:C,directRef:L=>e.jsx("button",{onClick:R,disabled:!R,...L,children:M})},M))]}),e.jsxs(Rs,{title:"Are you sure?",isOpen:l,onClose:()=>d(!1),onConfirm:w,confirmLabel:"End",children:["Are you sure you want to end this ",x?"cutscene":"battle","?"]})]})}function zi(){const{djangoBaseUrl:a}=B,r=Pe(),s=r===xe,n=Dt(),i=U(),c=qt(r),u=pn();if(i===null||n===null||u===null)return null;const{battleGroupName:p,isCutscene:f=!1}=n,{puzzles:h,masteries:g,hintsInfo:t}=i,{numHintsUsed:o,numHintsTotal:l}=t,d=l-o,m=h[p].solveTime!==void 0,v=h[Ae]!==void 0,x=g[xt].isEnabled!==void 0,b=(()=>{const y=[x?"faction":void 0,"deck",v?"masteries":void 0].filter(j=>!!j);return y.length>1&&(y[y.length-1]=`and ${y[y.length-1]}`),y.join(y.length>2?", ":" ")})();return e.jsxs("div",{className:"battle-status",children:[e.jsx("div",{className:"battle-status-message",children:!f&&c===Ke.ACTIVE?e.jsx($,{text:`The ${b} for the battle are locked. Changes to them won't affect the current battle.`,children:e.jsx(W,{children:"‚ö†Ô∏è Battle is ongoing!"})}):null}),e.jsxs("div",{className:"battle-status-buttons",children:[!f&&!s&&(B.isPosthunt||u)?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`${a}solution/${p}`,children:e.jsx("button",{children:"Solution"})}),e.jsx("a",{href:`${a}stats/${p}`,children:e.jsx("button",{children:"Stats"})})]}):null,!B.isPosthunt&&!f&&m?e.jsx("a",{href:`${a}solve/${p}`,children:e.jsx("button",{children:"Leave feedback"})}):null,l&&!f&&!s&&!m?e.jsx("a",{href:`${a}hints/${p}`,children:e.jsxs("button",{children:[d?"Get a hint":"View hints"," (",d,e.jsx(W,{tag:"span",children:"üí°"}),")"]})}):null]})]})}function ra(a){const{name:r,size:s,isEditingPriority:n,resetIsEditingPriority:i}=a,c=te(),u=ze(L=>L.cardsDB),p=U(),f=Ls(),h=Ms(f),{name:g}=$a()??{name:null},t=kr(),o=gn(),l=ie(L=>L.showDeckbuildingAnimation),d=_.useRef(null),m=(L,D,I)=>L>=I.left&&L<=I.right&&D>=I.top&&D<=I.bottom,v=g===r,x=()=>v?o():t(je.P1,r),b=10,y=.4;function j(L,D,I){if(D.length!==I.length)throw new Error("Input and output arrays must have the same length");if(L<=D[0])return I[0];if(L>=D[D.length-1])return I[I.length-1];let X=0;for(;L>D[X+1];)X++;const Y=X+1,q=D[X],ce=D[Y],J=I[X],F=I[Y];return J+(L-q)/(ce-q)*(F-J)}if(_.useEffect(()=>{if(!d.current||s!==Me.LARGE)return;const L=d.current,D=()=>{L.style.backgroundImage="",L.style.transform="rotateX(0deg) rotateY(0deg)"};if(D(),!l||v){D();return}const I=X=>{const Y=L.getBoundingClientRect(),q=X.clientX,ce=X.clientY;if(!m(q,ce,Y)){D();return}const J=-(ce-Y.top-Y.height/2)/b,F=(q-Y.left-Y.width/2)/b,fe=J+F,se=j(fe,[-5,5],[-100,200]),ne=j(se,[-100,49,50,51,200],[0,y,0,y,0]),pe=se-50,_e=se-30,de=se-10,Re=se+10,we=se+30,A=se+50,z=`linear-gradient(55deg, transparent, rgba(255, 100, 100, ${ne}) ${pe}%, rgba(255, 255, 100, ${ne}) ${_e}%, rgba(100, 255, 100, ${ne}) ${de}%, rgba(100, 255, 255, ${ne}) ${se}%, rgba(100, 100, 255, ${ne}) ${Re}%, rgba(255, 100, 255, ${ne}) ${we}%, rgba(255, 100, 100, ${ne}) ${A}%, transparent)`;L.style.backgroundImage=Ga(r)?z:"",L.style.transform=`rotateX(${J}deg) rotateY(${F}deg)`};return document.addEventListener("mousemove",I),()=>{document.removeEventListener("mousemove",I)}},[l,r,s,v]),p===null||h===null)return e.jsx(Oe,{size:48,inline:!0});const T=new Set(Object.keys(p.cardUnlocks)),S=Ua(h,r),w={cards:{[r]:S+1}},P={cards:{[r]:S-1}},E=()=>{c.sendReq({type:G.DECKBUILDING_STEP,slot:f,deckUpd:w})},C=()=>{c.sendReq({type:G.DECKBUILDING_STEP,slot:f,deckUpd:P})},R=()=>{c.sendReq({type:G.DECKBUILDING_STEP,slot:f,deckUpd:{priorityCard:r}}),i==null||i()},M=()=>n?e.jsx("button",{onClick:R,children:"Choose"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:!An(P,h,T,u),onClick:C,children:"‚óÄ"}),e.jsxs("div",{className:"deck-card-quantity-value",children:[S,"√ó"]}),e.jsx("button",{disabled:!An(w,h,T,u),onClick:E,children:"‚ñ∂"})]});return e.jsxs("div",{className:"deck-card-display",children:[e.jsx("div",{className:"deck-card-quantity",children:M()}),e.jsx("div",{className:"deck-card-motion",ref:d,children:e.jsx("div",{className:"deck-card",onClick:x,children:e.jsx(nt,{highlighted:v,size:s,cardName:r,disableScroll:!v})})})]})}function qn(a){switch(a.color){case lt.RED:return 0;case lt.YELLOW:return 1;case lt.GREEN:return 2;case lt.PURPLE:return 3;case lt.WHITE:return 4;case lt.BLACK:return 5;case lt.WHITEBLACK:return 6;default:return 7}}function aa(a,r){return a.name.localeCompare(r.name)}function oa(a,r){const s=a.cost.length,n=r.cost.length;return s!==n?s-n:aa(a,r)}function Fi(a,r){const s=qn(a),n=qn(r);return s!==n?s-n:oa(a,r)}function Bi(){const a=ie(d=>d.showDeckbuildingAnimation),r=ie(d=>d.setShowDeckbuildingAnimation),s=ie(d=>d.cardSize),n=ie(d=>d.setCardSize),i=ie(d=>d.collectionSort),c=ie(d=>d.setCollectionSort),[u,p]=_.useState("all"),f=ze(d=>d.cardsDB),h=U(),g=ot();if(h===null)return e.jsx(Oe,{size:128,inline:!0});const t=new Set(Object.keys(h.cardUnlocks)),o=!!Object.values(h.cardUnlocks).find(({cardName:d})=>g.isLegendary(d)),l=i===Qt.ALPHABETICAL?aa:i===Qt.COLOR?Fi:oa;return e.jsxs("div",{className:"collection-display",children:[e.jsx("div",{className:"collection-header",children:e.jsxs("div",{className:"collection-options",children:[e.jsxs("label",{htmlFor:"sort-filter",children:["Filter:"," ",e.jsxs("select",{name:"sort-filter",value:u,onChange:d=>p(d.target.value),children:[e.jsx("option",{value:"all",children:"All"}),o?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"legendaries",children:"Legendaries"}),e.jsx("option",{value:"non-legendaries",children:"Non-legendaries"})]}):null,e.jsx("option",{value:"R",children:"Boars"}),e.jsx("option",{value:"Y",children:"Bees"}),e.jsx("option",{value:"G",children:"Dinosaurs"}),e.jsx("option",{value:"P",children:"Dryads"}),e.jsx("option",{value:"W/B",children:"Cows"})]})]}),e.jsxs("label",{htmlFor:"sort-select",children:["Sort:"," ",e.jsxs("select",{name:"sort-select",value:i,onChange:d=>c(d.target.value),children:[e.jsx("option",{value:Qt.ALPHABETICAL,children:"Alphabetical"}),e.jsx("option",{value:Qt.COST,children:"Cost"}),e.jsx("option",{value:Qt.COLOR,children:"Faction"})]})]}),e.jsxs("label",{htmlFor:"size-select",children:["Size:"," ",e.jsxs("select",{name:"size-select",value:s,onChange:d=>n(d.target.value),children:[e.jsx("option",{value:Me.LARGE,children:"Large"}),e.jsx("option",{value:Me.NORMAL,children:"Medium"}),e.jsx("option",{value:Me.SMALL_FIELD,children:"Small"})]})]}),e.jsxs("label",{htmlFor:"toggle-animate",children:["Animate:"," ",e.jsx("input",{type:"checkbox",name:"toggle-animate",checked:a,onChange:()=>r(!a)})]})]})}),e.jsx("div",{className:`collection-cards ${s}`,children:Tr.filter(d=>Ha(d.name,t,f)).filter(d=>u==="all"||u==="legendaries"&&g.isLegendary(d)||u==="non-legendaries"&&!g.isLegendary(d)||u===d.color||u==="W/B"&&(d.color===lt.WHITE||d.color===lt.BLACK)).sort(l).map(({name:d})=>e.jsx(ra,{name:d,size:s},d))})]})}function $i(){const a=Ls(),r=Ms(a),s=ot(),n=U();if(!r||!n)return null;const i=Ka(r),c=s.getMaxNumCards(),{cardUnlocks:u}=n,f=Object.values(u).filter(({cardName:l})=>s.isLegendary(l)).length>0,h=Wa(r),g=s.getMaxNumLegendaries(),t=new Set;s.validateDeck(t,je.P1,r);const o=[Ie.DECK_TOO_SMALL,Ie.DECK_TOO_LARGE,Ie.DECK_TOO_MANY_LEGENDARIES].filter(l=>t.has(l)).map(l=>{switch(l){case Ie.DECK_TOO_SMALL:return"Too few cards.";case Ie.DECK_TOO_LARGE:return"Too many cards.";case Ie.DECK_TOO_MANY_LEGENDARIES:return"Too many Legendaries."}throw new Error("unrecognized deckbuilding failed check")}).join(`
`);return e.jsxs("div",{className:"deck-stats",children:[e.jsxs("div",{children:[e.jsxs("span",{className:i===0||i>c?"deck-sidebar-text-invalid":i===c?"deck-sidebar-text-full":void 0,children:[e.jsx("b",{children:i})," / ",c]})," ","cards"]}),f?e.jsxs("div",{children:[e.jsxs("span",{className:h>g?"deck-sidebar-text-invalid":h===g?"deck-sidebar-text-full":void 0,children:[e.jsx("b",{children:h})," / ",g]})," ","unique Legendary cards"]}):null,o?e.jsx($,{className:"failed-checks",text:o,children:e.jsx(W,{children:"‚ùå"})}):null]})}function ia(a){const{priorityCard:r,isEditingPriority:s=!1,startEditingPriority:n,resetPriorityCard:i}=a;return e.jsxs("div",{className:`deck-priority-display ${n?"can-edit":""}`,children:[e.jsxs($,{text:"The Priority Card is moved to the top of the draw pile at the start of each battle.",style:{height:"unset",gridColumn:"2 / 3"},children:[e.jsx("b",{children:"Priority Card:"}),!r&&!s?" None.":null]}),!r&&!s&&n?e.jsx("button",{onClick:n,style:{gridColumn:"2 / 3"},children:"Choose Priority Card"}):null,!r&&s?e.jsx("button",{onClick:i,style:{gridColumn:"2 / 3"},children:"Cancel"}):null,r&&!s?e.jsxs(e.Fragment,{children:[n?e.jsx("div",{className:"deck-card-quantity",style:{gridColumn:"1 / 2"},children:e.jsx("button",{onClick:n,children:"Change"})}):null,e.jsx("div",{className:"deck-card",style:{gridColumn:"2 / 3"},children:e.jsx(nt,{size:Me.SMALL,cardName:r})})]}):null,r&&s?e.jsx("button",{onClick:i,style:{gridColumn:"2 /3"},children:"Remove Priority Card"}):null]})}function Ui(){const[a,r]=_.useState(!1),s=te(),n=Ls(),i=U(),c=Ms(n),{lockedDeckSelection:u=null}=Ot()??{};if(i===null||c===null)return e.jsx(Oe,{size:48,inline:!0});const{masteries:p}=i,f=p[Qs].isEnabled,h=()=>{s.sendReq({type:G.DECKBUILDING_STEP,slot:n,deckUpd:{deletePriorityCard:!0}}),r(!1)};return e.jsxs("div",{className:"deck-display",children:[e.jsxs("div",{className:"deck-display-header",children:[e.jsxs("h2",{children:["Deck"," ",u!==null&&u.slot===n?e.jsx($,{text:"This deck is locked; changes below won't affect the ongoing battle.",children:e.jsx(W,{children:"üîí"})}):null]}),e.jsx("button",{onClick:()=>{s.sendReq({type:G.DECKBUILDING_STEP,slot:n,deckUpd:{clear:!0}})},children:"Clear deck"})]}),f?e.jsx(ia,{priorityCard:c.priorityCard,isEditingPriority:a,startEditingPriority:()=>r(!0),resetPriorityCard:h}):null,e.jsx("div",{className:"deck-cards",children:Object.keys(c.cards).sort().map(g=>e.jsx(ra,{name:g,size:Me.SMALL,isEditingPriority:a,resetIsEditingPriority:()=>r(!1)},g))}),e.jsx($i,{})]})}function la(){const a=vn(),r=Ye(),s=yt();if(!a)return e.jsx(nt,{size:Me.LARGE,faceDown:!1});const{cardName:n,permanentId:i}=a,c=i===void 0?null:r.getPermanentIfExists(i);return e.jsx(nt,{isOwner:c!==null&&c.owner===s,size:Me.LARGE,cardName:n,permanent:c??void 0,disableHoverZoom:!0})}const Gi=xn((a,r)=>({displayNameInput:null,setDisplayNameInput:s=>{a({displayNameInput:s})}}));function Hi(){var g,t,o,l;const a=vn(),r=U(),s=e.jsx("div",{children:"¬†"});if(!a||!r)return s;const{cardName:n}=a,{battleGroups:i,cardUnlocks:c,puzzles:u}=r,p=(g=c[n])==null?void 0:g.puzName;if(!p||((t=u[p])==null?void 0:t.solveTime)===void 0)return s;const f=(o=u[p])==null?void 0:o.battleGroupName;if(!f)return s;const h=(l=i[f])==null?void 0:l.displayName;return h?e.jsxs("div",{className:"card-source",children:["from"," ",e.jsx(cs,{battleGroupName:f,hasAnswer:u[p].hasAnswer??!1,children:h})]}):s}function Ki(){const{displayNameInput:a,setDisplayNameInput:r}=Gi(),s=Ee(),n=Ls(),i=Ms(n),c=te(),[u]=he(),p=ot(),f=Pe(),h=f===xe,g=qt(f),[t,o]=_.useState(!1),l=g===null?!1:g===Ke.ACTIVE,{selectedDeckSlot:d=null}=ht(je.P1),m=bt(j=>j.isSpectating),v=i===null?null:i.displayName,x=()=>{s({pathname:`../battle/${f}/start/${n}`,search:u.toString()})};if(_.useEffect(()=>{v!==null&&r(v)},[v,r]),i===null)return null;const b=new Set;p.validateDeck(b,je.P1,i);const y=[Ie.DECK_TOO_SMALL,Ie.DECK_TOO_LARGE,Ie.DECK_TOO_MANY_LEGENDARIES].filter(j=>b.has(j)).map(j=>{switch(j){case Ie.DECK_TOO_SMALL:return"Too few cards.";case Ie.DECK_TOO_LARGE:return"Too many cards.";case Ie.DECK_TOO_MANY_LEGENDARIES:return"Too many Legendaries."}throw new Error("unrecognized deckbuilding failed check")}).join(`
`);return e.jsxs("div",{className:"deck-sidebar",children:[e.jsx(la,{}),e.jsx(Hi,{}),e.jsxs("div",{className:"deck-sidebar-buttons",children:[a===null?null:e.jsx("input",{className:"deck-sidebar-input",type:"text",value:a,onChange:j=>{r(j.target.value)},onBlur:()=>{a!==i.displayName&&c.sendReq({type:G.DECKBUILDING_STEP,slot:n,deckUpd:{displayName:a}})}}),e.jsx($e,{to:{pathname:`../prep/${f}`,search:u.toString()},children:e.jsx("button",{children:"Back"})}),l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"battle-status",children:e.jsx(W,{children:"‚ö†Ô∏è Battle is ongoing!"})}),e.jsx($e,{to:{pathname:`../battle/${f}`,search:u.toString()},children:e.jsx("button",{className:"battle-button",children:"Join battle"})}),h||m?null:e.jsx($,{text:y,children:e.jsx("button",{onClick:()=>o(!0),disabled:b.size>0,children:"Restart with this deck"})})]}):h||m?null:e.jsx($,{text:y,children:e.jsx("button",{className:"battle-button",onClick:()=>x(),disabled:b.size>0,children:"Start battle!"})})]}),e.jsx(ca,{player:je.P1,disabledExcept:null,highlightedDeckSlot:n,secondaryHighlightedDeckSlot:d,lockedDeckSlot:null,context:"collection"}),e.jsx(Rs,{title:"Are you sure?",isOpen:t,onClose:()=>o(!1),onConfirm:()=>{s({pathname:`../battle/${f}/restart/${n}`,search:u.toString()})},confirmLabel:"Restart",children:"This will end the current battle."})]})}function Wi(a){const{deck:r,slot:s,player:n,isLocked:i,isDisabled:c,secondaryHighlight:u,highlight:p,context:f}=a,[h]=he(),g=ot(),t=Ee(),o=Pe(),l=at(),d=o===xe,m=te(),v=K(S=>S.setHoveredDeck),x=_.useMemo(()=>Object.keys(r.cards).length===0,[r]),b=_.useMemo(()=>{const S=new Set;g.validateDeck(S,n,r);const w=As(S);return d&&w===As(new Set([Ie.DECK_TOO_MANY_LEGENDARIES]))?"Legendary cards aren‚Äôt allowed in PvP.":w},[r,g,d,n]),y=_.useCallback(()=>{if(o===null)return null;m.sendReq({type:G.SELECT_DECK_FOR_BATTLE,puzName:o,slot:s})},[o,m,s]),j=`deck-list-deck
    ${p?"highlight":u?"secondary-highlight":""}
    ${x?"empty":""}
    ${b?"invalid":""}`,T=_.useCallback(()=>{v(null),t({pathname:`../deck/${s}/${o}`,search:h.toString()})},[t,o,h,v,s]);return l===null?null:e.jsxs("div",{className:j,onMouseEnter:()=>v(r),onMouseLeave:()=>v(null),children:[e.jsx("button",{className:"deck-list-deck-btn",disabled:c,onClick:f=="prep"?y:T,children:r.displayName}),i?e.jsx($,{text:"Deck is locked; changes won't affect the current battle.",children:e.jsx("button",{className:"no-click",disabled:!0,children:e.jsx(W,{children:"üîí"})})}):null,!b||x?null:e.jsx($,{text:b,children:e.jsx("button",{className:"no-click",disabled:!0,children:e.jsx(W,{children:"‚ùå"})})}),x?e.jsx($,{text:"Deck is empty.",children:e.jsx("button",{className:"no-click",disabled:!0,children:e.jsx(W,{children:"üì≠"})})}):null,f!="prep"?null:e.jsx($,{text:"Edit deck.",children:e.jsx("button",{className:"deck-list-deck-edit",onClick:T,children:e.jsx(W,{children:"‚úèÔ∏è"})})})]})}function Yi(a){const{player:r,showPriorityCard:s}=a,{selectedDeck:n=null}=ht(r)??{},c=K(u=>u.hoveredDeck)??n;return e.jsx("div",{className:"prep-cards",children:c===null?"No deck selected.":e.jsxs(e.Fragment,{children:[s?e.jsx(ia,{priorityCard:c==null?void 0:c.priorityCard}):null,[...Object.keys(c.cards)].sort().map(u=>e.jsxs("div",{className:"prep-card-display",children:[e.jsxs("div",{className:"prep-card-display-quantity",children:[c.cards[u],"√ó"]}),e.jsx(nt,{size:Me.SMALL,cardName:u})]},u))]})})}function ca(a){const{player:r,disabledExcept:s,highlightedDeckSlot:n,secondaryHighlightedDeckSlot:i,lockedDeckSlot:c,context:u}=a,{decks:p}=ht(r)??{};return e.jsx("div",{className:"deck-list",children:p?p.map((f,h)=>{const g=f??Ya(h);return e.jsx(Wi,{player:r,deck:g,slot:h,isDisabled:s!==null&&s!==h,isLocked:c!==null&&c===h,highlight:n!==null&&n===h,secondaryHighlight:i!==null&&i===h,context:u},h)}):"Decks loading..."})}function Zn(a){const{role:r,player:s}=a,n=at(),i=U(),c=Ot(),{canSelectDeck:u=!1,selectedDeckSlot:p=null,isDeckLocked:f=!1}=ht(s)??{},h=Pe(),g=qt(h),{activeGame:t}=c??{},o=t?t.enabledMasteries[Qs]??!1:(i==null?void 0:i.masteries[Qs].isEnabled)??!1;return n===null||!u?null:e.jsxs(e.Fragment,{children:[e.jsx(Yi,{player:s,canSelectDeck:u,showPriorityCard:o}),e.jsx(ca,{player:s,disabledExcept:f?p:g===Ke.ACTIVE&&n===Va?-1:null,highlightedDeckSlot:p,secondaryHighlightedDeckSlot:null,lockedDeckSlot:f?p:null,context:"prep"})]})}function Xn(){const a=Er();if(!a||a.length===0)return null;const r=a.map(s=>e.jsx($,{placement:"right",into:!0,noWrap:!0,text:e.jsx(nt,{cardName:s,size:Me.LARGE,canZoom:!1}),children:e.jsx(nt,{cardName:s,size:Me.SMALL,canZoom:!1})},s));return e.jsxs("div",{className:"friends-found",children:[e.jsx("h4",{children:"Friends found"}),e.jsx("div",{className:"friends-found-cards",children:r})]})}function Qn(){var f;const a=U(),{activeGame:r}=Ot()??{},{faction:s,masteries:n}=a??{},i=((f=n==null?void 0:n[xt])==null?void 0:f.isEnabled)??!1,[c]=he();if(!i)return null;const u=(r==null?void 0:r.faction)??s,p=r?e.jsx($,{className:"faction-lock",text:"Faction is locked; changes won't affect the current battle.",children:e.jsx(W,{children:"üîí"})}):null;return e.jsxs(e.Fragment,{children:[u?e.jsxs("div",{className:"faction-display",children:[p,e.jsx("b",{children:"Faction:"})," ",e.jsx(Ue,{faction:u})," ",wt(u)," ",e.jsx(Ue,{faction:u})]}):e.jsxs("div",{className:"no-faction-display",children:[p," ",e.jsx(W,{children:"‚ö†Ô∏è"})," You don‚Äôt have a faction yet!"]}),e.jsx($e,{className:"change-faction-btn",to:{pathname:`/team/${encodeURIComponent(encodeURIComponent((a==null?void 0:a.displayName)??""))}`,search:c.toString()},children:e.jsx("button",{className:"secondary",children:u===null?"Choose a faction":"Change faction"})})]})}function da(a){const{enabledMasteries:r}=a,s=K(o=>o.selectedMasteryId),n=K(o=>o.setSelectedMasteryId),i=K(o=>o.hoveredMasteryId),c=K(o=>o.setHoveredMasteryId),u=U();if(_.useEffect(()=>()=>{n(null),c(null)},[n,c]),u===null)return null;const{masteries:p}=u,f=Object.values(p).sort(({x:o,y:l},{x:d,y:m})=>l*Tt+o-(m*Et+d)).map(({masteryId:o,isEnabled:l})=>{const d=s!==null&&o===s;return e.jsx("div",{className:`select-mastery-button-highlight-wrapper${d?" highlight":""}`,children:e.jsx("div",{className:`select-mastery-button-wrapper${(r?r[o]:l)?" mastery-enabled":""}`,children:e.jsx("div",{className:`select-mastery-button ${d?"selected":""}`,onClick:()=>{n(d?null:o)},onMouseEnter:()=>{c(o)},onMouseLeave:()=>{c(null)},children:e.jsx(W,{children:"üÉè"})})})},o)}),h=i??s;h!==null&&p[h].isEnabled;const g=h===null?"":p[h].displayName??"???",t=h===null?"":p[h].effectText??"???";return e.jsxs("div",{className:"mastery-explorer",children:[e.jsxs("div",{className:`mastery-details${h===null?" blank":""}`,children:[e.jsx("div",{className:"mastery-title",children:g}),e.jsx("div",{className:"mastery-text",children:e.jsx(V,{text:t,opts:{ignoreKeywords:!0}})})]}),e.jsx("div",{className:"select-mastery-buttons",children:f})]})}function Jn(){const a=Pe(),r=Ee(),[s]=he(),n=U(),{activeGame:i}=Ot()??{},{puzzles:c}=n??{},u=(c==null?void 0:c[Ae])!==void 0,p=()=>r({pathname:`../mastery/${a}`,search:s.toString()});if(!u)return null;const f=i?e.jsx($,{text:"Masteries are locked; changes won't affect the current battle.",directRef:h=>e.jsx("div",{...h,className:"masteries-lock",children:e.jsx(W,{children:"üîí"})})}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"prep-masteries",children:[e.jsx(da,{enabledMasteries:i==null?void 0:i.enabledMasteries}),f]}),e.jsx("button",{className:"prep-masteries-btn secondary",onClick:p,children:"Select masteries"})]})}function Vi(a){const{puzData:r,puzIndex:s}=a,n=Pe(),i=at(),c=us()??!1,u=Ee(),[p]=he(),f=te(),h=U(),{puzName:g,solveTime:t,roomStatus:o,isNew:l}=r??{},d=i===(r==null?void 0:r.puzName),m=t!==void 0,v=`prep-puz-selection-btn ${d?"highlight":""} ${m?"solve-highlight":""}`,x=c&&h!==null&&h.puzzles[n].roomStatus===Ke.ACTIVE,b=c?()=>{x||f.sendReq({type:G.SELECT_PUZZLE,hostPuzName:n,selectedPuzName:r.puzName})}:()=>u({pathname:`../prep/${g}`,search:p.toString()},{replace:!0}),{text:y,disabled:j=!1,label:T}=(()=>g===void 0?{text:"Locked.",disabled:!0,label:`${s}üîí`}:(c?x&&g===i:o===Ke.ACTIVE)?{text:"Battle in progress.",label:`${s}‚öîÔ∏è`,disabled:x}:l?{text:"New battle!",label:`${s}‚ú®`,disabled:x}:m?{text:"Done!",label:`${s}`,disabled:x}:{text:void 0,label:`${s}`,disabled:x})();return e.jsx("div",{className:"prep-puz-selection-btn-wrapper",children:e.jsx($,{text:y,children:e.jsx("button",{className:v,disabled:j,onClick:b,children:e.jsx(W,{className:"prep-puz-selection-btn-content",children:T})})})})}function qi(){const a=U(),r=Dt(),s=Sr(),n=at(),{battleGroupName:i=null,numPuzzles:c=1}=r??{},u=i!==null&&i===bn,p=_.useMemo(()=>u?Gs:[c],[u,c]),f=s===null?null:s.findIndex(m=>m.puzName===n),[h,g]=_.useState(0);if(_.useEffect(()=>{if(f===null||i===null||f===null)return;let m=0,v=0;for(;f>=v+p[m];)v+=p[m],m++;g(m)},[f,i,g,p]),a===null||r===null||s===null||c===1)return null;const t=p.slice(0,h).reduce((m,v)=>m+v,0),l=s.concat(Array(c).fill(void 0)).slice(t,t+p[h]).map((m,v)=>e.jsx(Vi,{puzData:m,puzIndex:t+v+1},t+v)),d=u?h>=3?void 0:s.length<=Gs.slice(0,h+1).reduce((m,v)=>m+v,0)?`Solve ${qa[h]} of ${Gs[h]} to unlock the next phase.`:void 0:void 0;return e.jsxs("div",{className:"prep-puz-selection",children:[h>0?e.jsx("button",{className:"prep-puz-selection-row-btn",onClick:()=>g(h-1),children:"¬´"}):null,e.jsx("div",{className:"prep-puz-selection-row",children:l}),h<p.length-1?e.jsx($,{text:d,directRef:m=>e.jsx("button",{className:"prep-puz-selection-row-btn",onClick:()=>g(h+1),...m,children:"¬ª"})}):null]})}const Zi=()=>{const[a,r]=_.useState(window.innerHeight),[s,n]=_.useState(window.innerWidth);return _.useEffect(()=>{const i=()=>{r(window.innerHeight),n(window.innerWidth)};return i(),window.addEventListener("resize",i,{passive:!0}),()=>window.removeEventListener("resize",i)}),{height:a,width:s}};function Xi(a){var j,T,S;const{role:r,player:s}=a;ot();const n=at(),i=Dt(),{isCutscene:c=!1}=i??{},u=U(),{faction:p,masteries:f,puzzles:h}=u??{},g=Er(),t=((j=f==null?void 0:f[xt])==null?void 0:j.isEnabled)??!1,o=((T=f==null?void 0:f[Yt])==null?void 0:T.isEnabled)??!1,l=t&&p!==null||o&&n!==null&&((S=(h??{})[n])==null?void 0:S.solveTime)!==void 0||g!==null&&g.length>0,{canSelectDeck:d=!1}=ht(s),{height:m}=Zi(),v=w=>w>880,[x,b]=_.useState(v(m)?-1:0);_.useEffect(()=>{v(m)?x!==-1&&b(-1):x===-1&&b(0)},[x,m]);const y=[{label:"Battle",content:e.jsxs(e.Fragment,{children:[e.jsx(Qn,{}),e.jsx(Zn,{role:r,player:s}),e.jsx(Jn,{})]})},{label:"Stats",content:e.jsxs(e.Fragment,{children:[e.jsx(Ps,{}),e.jsx(rn,{puzName:n}),e.jsx(Xn,{})]})}];return e.jsxs("div",{className:"prep-right",children:[e.jsx(qi,{}),!c&&x!==-1&&l?e.jsx(st.Tabbed,{className:"prep",index:x,setIndex:w=>b(w),style:{minHeight:d?"calc(12 * var(--deck-row-height) + 5.25em)":"12em"},items:y}):e.jsxs("div",{className:"prep-tabbed prep-content",style:{minHeight:d?"calc(12 * var(--deck-row-height) + 5.25em)":"12em"},children:[c?null:e.jsx(Qn,{}),e.jsx(Zn,{role:r,player:s}),c?null:e.jsx(Jn,{}),c?null:e.jsx(Ps,{}),c?null:e.jsx(rn,{puzName:n}),e.jsx(Xn,{})]}),e.jsx(zi,{}),e.jsx(Mi,{player:s})]})}function Qi(){var Re,we;const[a,r]=_.useState(!1),s=B.role??Gt.P1,n=s===Gt.P2?je.P2:je.P1,i=Te(A=>A.setSubscribedTeamBattle),c=ee(A=>A.globalState.subscribedTeamBattle),u=Wt(A=>A.getServerInterfaceController)(),p=mt(),f=Pe(),h=f===xe,g=at(),t=K(A=>A.setHoveredMasteryId),o=K(A=>A.setSelectedMasteryId),l=ze(A=>A.cardsDB),d=U(),m=Te(A=>A.setSubscribedTeamDecksTeamId),v=Te(A=>A.setNeedAdmin),x=Ee(),[b]=he(),y=ot(),j=ds(),T=us()??!1,S=K(A=>A.isInstancerModalOpen),w=K(A=>A.setIsInstancerModalOpen),P=ie(A=>A.hasClosedInstancerModal),E=ie(A=>A.setHasClosedInstancerModal),C=ie(A=>A.lastInstancerRoom),R=ie(A=>A.setLastInstancerRoom),M=K(A=>A.isPvPModalOpen),L=K(A=>A.setIsPvPModalOpen),D=ie(A=>A.hasClosedPvPModal),I=ie(A=>A.setHasClosedPvPModal),X=bt(A=>A.isSpectating),Y=ee(A=>A.globalState.puzzles),q=((Re=Y[f])==null?void 0:Re.battleGroupName)??null,ce=fn(),J=j===null?null:(j.numPuzzles??1)>1&&f===q,F=B.isPosthunt?d===null||c===null||Object.keys(Y).length===0?null:g!==null&&Y[g]!==void 0&&d.puzzles[g]===void 0&&d.puzzles[Y[g].battleGroupName]!==void 0:!1,fe=Object.keys(Y).length!==0&&d!==null&&(q===null||d.puzzles[q]===void 0||d.puzzles[q].hasAnswer),se=yn();_.useEffect(()=>{B.isPosthunt&&v(!0)},[v]),_.useEffect(()=>(P||w(T),()=>{w(!1)}),[T,P,w]),_.useEffect(()=>(D||L(h),()=>{L(!1)}),[D,L,h]),_.useEffect(()=>{T&&f!==null&&f!==rt&&R(f)},[T,f,R]);const ne=(()=>{if(d===null||fe)return null;const{puzzles:A}=d;if(F!==null&&F){if(g===null)throw new Error("selectedPuzName should be non-null if isStageLocked is set");return Y[g].battleGroupName}if(J===null||!J||ce===null)return null;if(ce.length<=0)throw new Error("expect puzzles in battle group if battle is known");if(q!==null&&q===rt&&C!==null)return C;const z=ce.filter(({puzName:N})=>A[N].solveTime===void 0);return(z.length>0?z[0]:ce[0]).puzName})(),pe=_.useCallback(()=>{x({pathname:`../battle/${f}`,search:b.toString()})},[f,b,x]);if(_.useEffect(()=>{if(fe&&(wr.error(`Invalid battle "${f}".`),x({pathname:"../map",search:b.toString()},{replace:!0})),ne!==null){x({pathname:`../prep/${ne}`,search:b.toString()},{replace:!0});return}},[fe,x,f,ne,b]),_.useEffect(()=>{if(u!==null&&p!==null&&!(se===null||!se))return u.addAuthEffect(()=>{let A=!1;return(async()=>{const z=vi(p,{puzName:f,role:s}),N=await u.autoPrepAsync(z);a||!N||A||z.readyForBattlePuzName!==void 0&&pe()})(),()=>{A=!0}})},[u,p,f,s,a,pe,se]),_.useEffect(()=>{p!==null&&m(p)},[p,m]),_.useEffect(()=>{if(u!==null&&!(se===null||!se)&&!X&&g!==null)return u.addAuthEffect(()=>{u.sendReq({type:G.VIEW_PUZZLE,puzName:g})})},[g,se,u,X]),_.useEffect(()=>{p!==null&&f!==null&&(se===null||!se||i({teamId:p,puzName:f}))},[i,p,f,se]),_.useEffect(()=>(r(!1),()=>r(!0)),[]),B.isPublicAccess){const{djangoBaseUrl:A}=B;return e.jsxs("div",{className:"below-nav public-access-not-supported",children:[e.jsx("h2",{children:j==null?void 0:j.displayName}),e.jsx("div",{className:"public-access-not-supported-message",children:"Battles and cutscenes are not yet supported in public access. You may still access solutions and stats pages. Please create or use an existing account to gain access to puzzle content."}),!((j==null?void 0:j.isCutscene)??!1)&&!h&&!T?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"public-access-not-supported-buttons",children:[e.jsx("a",{href:`${A}solution/${q}`,children:e.jsx("button",{children:"Solution"})}),e.jsx("a",{href:`${A}stats/${q}`,children:e.jsx("button",{children:"Stats"})})]})}):e.jsx(e.Fragment,{})]})}if(B.isPosthunt&&h)return e.jsxs("div",{className:"below-nav public-access-not-supported",children:[e.jsx("h2",{children:j==null?void 0:j.displayName}),e.jsx("div",{className:"public-access-not-supported-message",children:"Unfortunately, the PvP arena is not supported at this time. The PvP arena does not have any impact on hunt progress, and is not required to solve any puzzles."})]});if(u===null||d===null||c===null||j===null||!se||p===null)return e.jsx(We,{});const{puzzles:_e,cardUnlocks:de}=d;return((we=_e[c.puzName])==null?void 0:we.battleGroupName)!==j.battleGroupName?e.jsx(We,{}):e.jsxs(e.Fragment,{children:[e.jsx(Fs,{}),e.jsx("div",{className:"below-nav",children:e.jsxs("div",{className:`prep-root${h?" prep-root-pvp":""}${S?" unfocused":""}`,onClickCapture:A=>{if(A.target instanceof HTMLElement){const z=A.target.parentElement,N=z==null?void 0:z.parentElement;if(N&&N.classList.contains("select-mastery-button")&&N.classList.contains("selected")){o(null),t(null),A.stopPropagation();return}if(z&&z.classList.contains("mastery-details"))return;o(null)}},children:[e.jsx("div",{className:"prep-left-wrapper",children:e.jsx(Di,{role:s,player:n})}),e.jsx("div",{className:"prep-right-wrapper",children:g===jt&&Object.keys(de).filter(A=>y.isLegendary(A)).length<Js?e.jsxs("div",{className:"prep-final-battle-notice",children:[e.jsx("div",{children:"During the hunt, this battle would not unlock until all legendaries have been unlocked. As a postsolver, you may use the button below to unlock all legendaries and proceed with this battle."}),e.jsx("div",{children:"We recommend watching the ‚ÄúEntering the Water‚Äù cutscene before attempting this battle."}),e.jsx("button",{onClick:()=>{u.sendReq({type:G.ADMIN_MODIFY,teams:{[p]:{overrideCardUnlocked:Object.fromEntries(Is(l).filter(A=>y.isLegendary(A)).map(A=>[A,!0]))}}})},children:"Unlock all legendaries"})]}):e.jsx(Xi,{role:s,player:n})})]})}),e.jsx(Ht,{title:"The Instancer",isOpen:S,children:e.jsxs("div",{className:"prep-instancer-modal-notice",children:[e.jsx(Oi,{}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{w(!1),E()},children:"Okay!"})})]})}),e.jsx(Ht,{title:"PvP Arena",isOpen:M,children:e.jsxs("div",{className:"prep-pvp-modal-notice",children:[e.jsx(Ri,{}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{L(!1),I()},children:"Okay!"})})]})})]})}const Us=xn(a=>({userLog:"",addToUserLog:r=>a(s=>({userLog:s.userLog+`
`+r})),clearLog:()=>a({userLog:""})}));const le={TUSK1:"tusk1",TUSK2:"tusk2",ANTLERS:"antlers",WINGS:"wing",BLACK_LEG1:"blackLeg1",BLACK_LEG2:"blackLeg2",BLACK_LEG3:"blackLeg3",BLACK_LEG4:"blackLeg4",BLACK_LEG5:"blackLeg5",UDDERS:"udders",WHITE_LEG1:"whiteLeg1",WHITE_LEG2:"whiteLeg2",WHITE_LEG3:"whiteLeg3",WHITE_LEG4:"whiteLeg4",DINO_TAIL:"dinoTail"},kt="/static/kerodos/",er=[{name:"bodysingle.png"}],Qe=[{name:"body1.png"},{name:"body2.png"},{name:"body3.png"},{name:"body4.png"},{name:"body5.png"},{name:"body6.png"},{name:"body7.png"},{name:"body8.png"},{name:"body9.png"},{name:"body10.png"}],Ji=[{name:"head1.png",zIncr:1},{name:"w.png",zIncr:0,isW:!0},{name:"tusk1.png",zIncr:0,tag:le.TUSK1},{name:"tusk2.png",zIncr:0,tag:le.TUSK2},{name:"head2.png",zIncr:1},{name:"head3.png",zIncr:1},{name:"u.png",zIncr:0,isU:!0},{name:"head4.png",zIncr:1},{name:"head5.png",zIncr:1},{name:"head6.png",zIncr:1},{name:"antler1.png",zIncr:0,tag:le.ANTLERS},{name:"antler2.png",zIncr:0,tag:le.ANTLERS},{name:"head7.png",zIncr:1},{name:"head8.png",zIncr:1},{name:"head9.png",zIncr:1},{name:"head10.png",zIncr:1}],el=[{name:"body1.png"},{name:"body2.png"},{name:"body3.png"},{name:"body4.png"},{name:"body5.png"},{name:"leftwing1.png",zIncr:0},{name:"rightwing1.png",zIncr:0}],tl=[{name:"leftwing2.png",zIncr:0},{name:"rightwing2.png",zIncr:0},{name:"body6.png"},{name:"body7.png"},{name:"body8.png"},{name:"body9.png"},{name:"body10.png"}],sl=[{name:"udders.png",zIncr:0}],ns=[{name:"leg1.png",zIncr:0}],_s=[{name:"leg2.png",zIncr:0}],nl=[{name:"tail1.png",zIncr:1},{name:"tail2.png",zIncr:1},{name:"tail3.png",zIncr:1},{name:"tail4.png",zIncr:1},{name:"tail5.png",zIncr:1},{name:"tail6.png",zIncr:1}],Ss=60,tr=1/500,rl=360,al=120,ol=-111,il=200;class ll{constructor(){Le(this,"hasInited",!1);Le(this,"internalTime",0);Le(this,"lastFrameTime",0);Le(this,"recoilCounter",0);Le(this,"z",0);Le(this,"isSadFishy",!1);Le(this,"isDed",!1);Le(this,"mustStopLoop",!1);Le(this,"parent");Le(this,"imgElement");Le(this,"fishyElement");Le(this,"pendingAnimationFrame");Le(this,"phase",0);Le(this,"parts",[]);Le(this,"partsLeft",Object.values(le))}init(r,s,n=1){this.hasInited||(this.phase=n,this.hasInited=!0,this.parent=r,this.fishyElement=s,this.z=0,this.addPart(Ji,"head"),n<=4&&(this.addPart(Qe,le.BLACK_LEG1),this.addPart(ns,le.BLACK_LEG1),this.addPart(_s,le.WHITE_LEG1),this.addPart(Qe,le.WHITE_LEG1)),n<=5&&this.addPart(el,le.WINGS),this.addPart(er,"body"),n<=5&&this.addPart(tl,le.WINGS),n<=4&&(this.addPart(Qe,le.BLACK_LEG2),this.addPart(ns,le.BLACK_LEG2),this.addPart(_s,le.WHITE_LEG2),this.addPart(Qe,le.WHITE_LEG2),this.addPart(Qe,le.UDDERS),this.addPart(sl,le.UDDERS),this.addPart(Qe,le.UDDERS),this.addPart(Qe,le.BLACK_LEG3),this.addPart(ns,le.BLACK_LEG3),this.addPart(_s,le.WHITE_LEG3),this.addPart(Qe,le.WHITE_LEG3),this.addPart(Qe,le.BLACK_LEG4),this.addPart(ns,le.BLACK_LEG4),this.addPart(_s,le.WHITE_LEG4),this.addPart(Qe,le.WHITE_LEG4),this.addPart(Qe,le.BLACK_LEG5),this.addPart(ns,le.BLACK_LEG5)),n<=1&&this.addDinoTail(),this.addPart(nl,"fishTail"),this.internalTime=Date.now(),this.pendingAnimationFrame=requestAnimationFrame(()=>this.loop()),n>=6&&(this.partsLeft=[],this.turnIntoSadFishy()),n>=7&&this.turnIntoDedFishy())}calculatePosition(r){const s=this.piecewiseFn(this.recoilCounter),n=Math.cos((this.internalTime-(r+s)*1e3/Ss)*tr/2+Math.PI/4)*rl+ol,i=Math.cos((this.internalTime-(r+s)*1e3/Ss)*tr)*al+il;return{x:n,y:i}}reInit(r){if(this.hasInited=!1,this.pendingAnimationFrame&&cancelAnimationFrame(this.pendingAnimationFrame),this.imgElement=void 0,this.internalTime=0,this.lastFrameTime=0,this.recoilCounter=0,this.z=0,this.isSadFishy=!1,this.isDed=!1,this.mustStopLoop=!1,this.parts=[],this.partsLeft=Object.values(le),this.parent&&this.fishyElement){for(;this.parent.lastChild;)this.parent.removeChild(this.parent.lastChild);for(;this.fishyElement.lastChild;)this.fishyElement.removeChild(this.fishyElement.lastChild);this.init(this.parent,this.fishyElement,r)}}addPart(r,s,n=1){if(this.parent)for(const i of r){const c=document.createElement("img");i.zIncr!==void 0?(this.z+=i.zIncr,c.zIncr=i.zIncr):this.z+=2,c.z=this.z,c.classList.add("kerodos-anim-kero-part"),c.style.zIndex=`${-this.parts.length}`,n!=1&&(c.style.transform=`scale(${n})`),c.src=kt+i.name,this.parent.appendChild(c),i.tag?c.deleteTag=i.tag:c.deleteTag=s;const u=i.isU??!1,p=i.isW??!1;u?c.id="kerodos-anim-u":p&&(c.id="kerodos-anim-w"),u||p?c.classList.add("kerodos-anim-come-in-hot"):c.classList.add("kerodos-anim-slow-fade-in"),this.parts.push(c)}}addDinoTail(){for(let r=1;r>0;r-=.025)this.addPart(er,le.DINO_TAIL,r)}recoilFn(r){return 30*(Math.sin(r/20-Math.PI*3/8)-r/(20*Math.PI)-Math.sin(-Math.PI*3/8))}piecewiseFn(r){return r<49?this.recoilFn(r):r<69?this.recoilFn(49.5):r<100?this.recoilFn(r-20):0}loop(){var s;if(this.pendingAnimationFrame=void 0,!((s=this.parent)!=null&&s.isConnected))return;this.mustStopLoop||(this.pendingAnimationFrame=requestAnimationFrame(()=>this.loop()));const r=Date.now();if(!(r-this.lastFrameTime<1e3/Ss)){this.lastFrameTime=r,this.recoilCounter>0?(this.recoilCounter--,this.recoilCounter==0&&this.endRecoil()):this.internalTime+=1e3/Ss;for(let n=0;n<this.parts.length;n++){this.parts[n].fadeCounter&&(this.parts[n].fadeCounter=(this.parts[n].fadeCounter??0)-1,this.parts[n].style.opacity=`${(this.parts[n].fadeCounter??0)/100}`,this.parts[n].fadeCounter==0&&this.parts[n].remove()),this.parts[n].zCounter&&(this.parts[n].z=(this.parts[n].z??0)-(this.parts[n].zDecrement??0)/(this.parts[n].zCounter??1),this.parts[n].zDecrement=(this.parts[n].zDecrement??0)-(this.parts[n].zDecrement??0)/(this.parts[n].zCounter??1),this.parts[n].zCounter=(this.parts[n].zCounter??1)-1);const i=Math.max(0,Math.round(this.parts[n].z??0)),c=this.calculatePosition(i);this.parts[n].style.left=`${c.x}px`,this.parts[n].style.top=`${c.y}px`}}}startRecoil(){this.recoilCounter=100;const r=document.getElementById("kerodos-anim-u"),s=document.getElementById("kerodos-anim-w");r&&(r.src=kt+"hurt-u.png"),s&&(s.src=kt+"hurt-w.png")}endRecoil(){const r=document.getElementById("kerodos-anim-u"),s=document.getElementById("kerodos-anim-w");r&&(r.src=kt+"u.png"),s&&(s.src=kt+"w.png")}turnIntoSadFishy(){this.isSadFishy=!0;for(let r=0;r<this.parts.length;r++)this.parts[r].fadeEnable!=!0&&(this.parts[r].fadeEnable=!0,this.parts[r].fadeCounter=100);this.imgElement=document.createElement("img"),this.imgElement.classList.add("kerodos-anim-kero-part"),this.imgElement.classList.add("kerodos-anim-fade-in"),this.imgElement.src=kt+"sadfishy.gif",this.fishyElement&&this.fishyElement.appendChild(this.imgElement)}turnIntoDedFishy(){!this.isSadFishy||this.isDed||(this.isDed=!0,this.imgElement&&(this.imgElement.src=kt+"ded.png",this.imgElement.classList.remove("kerodos-anim-fade-in"),this.imgElement.classList.add("kerodos-anim-fade-out")))}deletePart(r){this.startRecoil();let s=0;for(let n=0;n<this.parts.length;n++){if(this.parts[n].deleteTag!=r||this.parts[n].fadeEnable==!0)continue;let i=2;this.parts[n].zIncr!==void 0&&(i=this.parts[n].zIncr),this.parts[n].fadeEnable=!0,this.parts[n].style.rotate=`${Math.floor(Math.random()*360)}deg`,this.parts[n].classList.remove("kerodos-anim-slow-fade-in"),this.parts[n].src.includes("body")?(this.parts[n].classList.add("kerodos-anim-splody"),this.parts[n].style.animationDelay=`${s++*50}ms`):this.parts[n].classList.add("kerodos-anim-spinny"),this.parts[n].fadeCounter=100;for(let c=n;c<this.parts.length;c++)this.parts[c].zDecrement=(this.parts[c].zDecrement||0)+(i??0),this.parts[c].zCounter=100}}updateState(r){const{parts:s,phase:n}=r;if(n<this.phase){this.reInit(n);return}if(this.phase=n,this.isSadFishy&&s.size==0){this.turnIntoDedFishy();return}for(let i=0;i<this.partsLeft.length;i++)s.has(this.partsLeft[i])||(this.deletePart(this.partsLeft[i]),this.partsLeft.splice(i,1),i--),this.partsLeft.length==0&&this.turnIntoSadFishy()}}const cl=()=>{var c;const a=ae(u=>u.gameState),r=U(),s=((c=a.sharedExtraState)==null?void 0:c.keroPhase)??0,n=_.useMemo(()=>Za(s),[s]),i=_.useRef(new ll);return _.useEffect(()=>{i.current.init(document.getElementById("kerodos-anim"),document.getElementById("kerodos-fishy"))},[]),_.useEffect(()=>{i.current.updateState(n)},[n]),r===null?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"kerodos-fishy"}),e.jsx("div",{id:"kerodos-anim-bg",children:e.jsx("div",{id:"kerodos-anim-clip",children:e.jsx("div",{id:"kerodos-anim"})})})]})},dl=_.memo(cl);const ul=()=>{const a=ae(g=>g.gameState),r=ie(g=>g.animKeroDos),s=Xa();if(s===null)return null;const{keyframe:n}=a,{id:i,dialogue:c,speaker:u,hideBattler:p=!1}=n??{},f=u!==void 0&&[De.ENEMY,De.NARRATOR].includes(u)&&c,h=s===jt;return e.jsx("div",{className:`enemy-battler${f?" talking":""}`,children:p&&n!==void 0?e.jsx(Nn,{keyframe:n}):e.jsx("div",{className:"enemy-battler-image-wrapper",id:Kt.element(It.AI_BATTLER),children:h&&r?e.jsx(dl,{}):e.jsx(zt,{battleGroupName:s,isInBattle:!0})})})};function ml(){const[a]=he(),r=Pe(),s=te(),n=ae(l=>l.gameState.keyframe),i=U(),c=jn();if(i===null||c===null)return null;const{battleGroups:u,cardUnlocks:p}=i,{isCutscene:f=!1}=u[c],{id:h,image:g}=n??{},t=(()=>{switch(h){case"tutorial1-card":return e.jsx(nt,{size:Me.LARGE,cardName:"new-boarn"})}return null})(),o=un(Object.keys(p),0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"game-cutscene-ui-img-wrapper",children:[g==="kero dos"?e.jsx(mn,{className:"game-cutscene-ui-picture",keroLayers:o}):null,g!==void 0&&g!=="kero dos"&&t===null?e.jsx(At,{className:"game-cutscene-ui-img",pictureClassName:"game-cutscene-ui-picture",src:br(g)}):null,t]}),n!==void 0?e.jsx("div",{id:"game-cutscene-ui-dialog-box",className:"game-cutscene-ui-dialog-box",children:e.jsx(Nn,{keyframe:n})}):null,e.jsxs("div",{className:"game-cutscene-ui-menu",children:[f?e.jsx("button",{onClick:()=>{s.startAIBattleAsync(r,{restart:!0,reuseDeck:!0,devKnobs:fs()})},children:"Restart"}):null,e.jsx($e,{to:{pathname:`../prep/${r}`,search:a.toString()},children:e.jsxs("button",{children:["Exit ",f?"cutscene":"battle"]})})]})]})}function hl(){const a=_.useRef(ye.getState()),r=ye(u=>u.enabled);_.useEffect(()=>ye.subscribe(u=>a.current=u),[]);const s=ye(u=>u.cursorMode===gt.EFFECT_OPT_ONE_CHOICE),n=ye();_.useEffect(()=>{const{enabled:u,fieldCursorLocation:p,handCursorIndex:f,handPlayer:h,subcursorLocation:g,cursorMode:t}=n;if(!u){Ft.getState().resetKeyboardZoomedCard();return}const{inspector:o}=Fe();let l=null;switch(t){case gt.FIELD:l=Hs(p,o);break;case gt.HAND:l=In(h,f,o);break;case gt.FIELD_SELECTED:case gt.EFFECT_OPT_SLOT:case gt.EFFECT_OPT_PERMANENT:l=Hs(g??p,o);break;case gt.HAND_SELECTED:g?l=Hs(g,o):l=In(h,f,o);break;case gt.NOT_VISIBLE:l=null;break;default:return}l===null?Ft.getState().resetKeyboardZoomedCard():Ft.getState().setKeyboardZoomedCard(l.cardName,l.permanentId)},[n]);const i=Zt(),c=ye(u=>u.setLocked);_.useEffect(()=>{c(i)},[i,c]),Se(["w","up"],()=>{ks(a.current,gs.UP)},{enabled:r&&!s,preventDefault:()=>!0},[]),Se(["a","left"],()=>{ks(a.current,gs.LEFT)},{enabled:r&&!s,preventDefault:()=>!0},[]),Se(["s","down"],()=>{ks(a.current,gs.DOWN)},{enabled:r&&!s,preventDefault:()=>!0},[]),Se(["d","right"],()=>{ks(a.current,gs.RIGHT)},{enabled:r&&!s,preventDefault:()=>!0},[]),Se(["esc"],()=>{fl(a.current)},{enabled:r},[]),Se(["enter","space"],()=>{pl(a.current)},{enabled:r&&!s,preventDefault:(u,p)=>(p.keys||[]).join("").toLowerCase()==="space"},[]),Se(["e"],()=>{gl(a.current)},{enabled:r&&!s,ignoreEventWhen:u=>oo("1,2,3,4,5,6,7,8,9,0")},[]),Se(["p"],()=>{vl(a.current)},{enabled:r&&!s},[]),Se(["z"],()=>{xl(a.current)},{enabled:r&&!s},[]),Se(["x"],()=>{bl(a.current)},{enabled:r&&!s},[]),Se(["c"],()=>{yl(a.current)},{enabled:r&&!s},[]),Se(["v"],()=>{jl(a.current)},{enabled:r&&!s},[]),Se(["f"],()=>{_l(a.current)},{enabled:r&&!s},[]),Se(["h"],()=>{Sl(a.current)},{enabled:r&&!s},[]),Se("1,2,3,4,5,6,7,8,9,0",(u,p)=>{let f=Number((p.keys||[])[0]||"");f==0&&(f=10),kl(a.current,f)},{enabled:r&&!s},[]),Se(["/"],()=>{Tl(a.current)},{enabled:r,preventDefault:()=>!0},[]),Se("a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",(u,p)=>{if(!a.current.isResponsive())return;const h=Fe(),{inspector:g,stepMaker:t}=h,o=re.getState().effectOpts,l=re.getState().pendingEffect,d=re.getState().pendingForms[0],m=re.getState().selectedCard,v=m!==null&&m.type===os.PERMANENT?g.getPermanentIfExists(m.permanentId):null;if(!v||!l||!d||d.type!==Bt.ONE_CHOICE)return;const x=((p.keys||[])[0]||"").toLowerCase();if(!x)return;const b=d.choices.find(S=>S.toLowerCase().startsWith(x));if(!b)return;const y={type:Bt.ONE_CHOICE,choice:b};if(!en(y,o,d,v,g))return;const T=re.getState().selectEffectOptAndResetIfDone(y);if(T)He(t.activateAbility(v,l,T),h);else{const S=re.getState().pendingForms;ye.getState().syncToPendingEffectOpt(S[0])}},{enabled:r&&s},[])}function Fe(){const{cardsDB:a}=ze.getState(),{gameState:r,role:s}=ae.getState(),n=Nr(a,r),i=new io(n,void 0,s);return{inspector:n,stepMaker:i,role:s}}function ks(a,r){if(!a.isResponsive())return;const s=Fe(),n=Qa(a,r,s);Ve(a,n,s)}function fl(a){if(!a.isResponsive())return;const r=Fe(),s=Ja(a);Ve(a,s,r)}function pl(a){if(!a.isResponsive())return;const r=Fe(),s=eo(a,r);Ve(a,s,r)}function gl(a){if(!a.isResponsive())return;const r=Fe(),s=to(a,r);Ve(a,s,r)}function vl(a){if(!a.isResponsive())return;const r=Fe(),s=so(a,r);Ve(a,s,r)}function xl(a){if(!a.isResponsive())return;const r=Fe(),s=lo();Ve(a,s,r)}function bl(a){if(!a.isResponsive())return;const r=Fe(),s=co();Ve(a,s,r)}function yl(a){if(!a.isResponsive())return;const r=Fe(),s=uo();Ve(a,s,r)}function jl(a){if(!a.isResponsive())return;const r=Fe(),s=mo();Ve(a,s,r)}function _l(a){if(!a.isResponsive())return;const r=Fe(),s=no(a);Ve(a,s,r)}function Sl(a){if(!a.isResponsive())return;const r=Fe(),s=ro(a,r);Ve(a,s,r)}function kl(a,r){if(!a.isResponsive())return;const s=Fe(),n=ao(a,r-1,s);Ve(a,n,s)}function Tl(a){if(!a.isResponsive())return;const r=Fe(),s=ho();Ve(a,s,r)}function Ve(a,r,s){if(!a.isResponsive())return;a.applyMutations(r.keyboardCursorMutations??{});const{inspector:n,stepMaker:i}=s,c=re.getState().pendingEffect,u=re.getState().selectedCard,p=u!==null&&u.type===os.PERMANENT?n.getPermanentIfExists(u.permanentId):null,f=u!==null&&u.type===os.HAND?u:null;for(const h of r.externalMutations??[])switch(h.type){case Ce.SET_SELECTED_CARD_HAND:{const{player:g,handCardId:t}=h;re.getState().setSelectedCardHand(g,t);break}case Ce.SET_SELECTED_CARD_HAND_ALL_CARDS_AVAIALBLE:{const{player:g,name:t}=h;re.getState().setSelectedCardHandAllCardsAvailable(g,t);break}case Ce.SET_SELECTED_CARD_PERMANENT:{const{permanentId:g}=h;re.getState().setSelectedCardPermanent(g);break}case Ce.RESET_SELECTED_CARD:{re.getState().resetSelectedCard();break}case Ce.PICK_EFFECT_OPT_SLOT:{if(!c||!p)break;const{slot:g}=h,t=re.getState().effectOpts,o=re.getState().pendingForms[0]??null,l={type:Bt.SLOT,slot:g};if(!en(l,t,o,p,n))break;const m=re.getState().selectEffectOptAndResetIfDone(l);if(m)He(i.activateAbility(p,c,m),s);else{const v=re.getState().pendingForms;ye.getState().syncToPendingEffectOpt(v[0])}break}case Ce.PICK_EFFECT_OPT_PERMANENT:{if(!c||!p)break;const{permanentId:g}=h,t=re.getState().effectOpts,o=re.getState().pendingForms[0]??null,l={type:Bt.PERMANENT,permanentId:g};if(!en(l,t,o,p,n))break;const m=re.getState().selectEffectOptAndResetIfDone(l);if(m)He(i.activateAbility(p,c,m),s);else{const v=re.getState().pendingForms;ye.getState().syncToPendingEffectOpt(v[0])}break}case Ce.PICK_EFFECT_OPT_ONE_CHOICE:{if(!c||!p)break;const{choice:g}=h,t=re.getState().selectEffectOptAndResetIfDone({type:Bt.ONE_CHOICE,choice:g});if(t)He(i.activateAbility(p,c,t),s);else{const o=re.getState().pendingForms;ye.getState().syncToPendingEffectOpt(o[0])}break}case Ce.RESET_EFFECT_OPTS:{re.getState().resetEffectOpts();break}case Ce.ATTACK:{if(!p)break;const{defenderId:g}=h,t=n.getPermanentIfExists(g);if(t===null)break;He(i.attack(p,t),s);break}case Ce.MOVE:{if(!p)break;const{slot:g}=h;He(i.move(p,g),s);break}case Ce.SUMMON:{if(!f)break;const{slot:g}=h;He(i.summonOrSpawn({player:f.player,handCardId:f.handCardId,cardName:f.name,slot:g}),s);break}case Ce.END_TURN:{const{player:g}=h;He(i.endTurn(g),s);break}case Ce.DRAW:{const{player:g}=h;He(i.draw(g),s);break}case Ce.SPECIAL:{if(!p)break;const t=n.getSharedEffects(p).specialForms,o=Nt.SPECIAL;t&&t.length>0?(re.getState().startEffect(o,t),ye.getState().syncToPendingEffectOpt(t[0])):He(i.activateAbility(p,o,[]),s);break}case Ce.FLEX:{if(!p)break;const t=n.getSharedEffects(p).flexForms,o=Nt.FLEX;t&&t.length>0?(re.getState().startEffect(o,t),ye.getState().syncToPendingEffectOpt(t[0])):He(i.activateAbility(p,o,[]),s);break}case Ce.CREATE1:{if(!p)break;const g=n.getCreateGemsColors(p);if(!g[0])break;He(i.create(p,g[0]),s);break}case Ce.CREATE2:{if(!p)break;const g=n.getCreateGemsColors(p);if(!g[1])break;He(i.create(p,g[1]),s);break}case Ce.HELP:{const{isHotkeyModalOpen:g,setIsHotkeyModalOpen:t}=K.getState();t(!g);break}}}function He(a,r){const{inspector:s,role:n}=r,{isValid:i}=s.resolveAndValidate(a,n);if(i){const c=ae.getState().sendStep;c==null||c(a)}}function ls(a){const{id:r,children:s,step:n,shortcut:i}=a,c=fo(),{pendingForm:u}=po(),p=ae(M=>M.sendStep),f=ms(),h=Ye(),g=Xt(),t=yt();h.gameState;const o=Zt(),{resolved:l,failedChecks:d}=h.resolveAndValidate(n,f);o&&d.add(Ie.UI_LOCKED),d.delete(Ie.NUM_OPTS);const m=d.size===0,v=go(l),x=vo(l),b=xo(n),y=v.length===0&&x.length===0?null:e.jsx(bo,{gems:new Array().concat(v.map(M=>({color:M,type:Pn.CROSSED}))).concat(x.map(M=>({color:M,type:Pn.SOLID}))),inline:!0}),j=As(d),T=u||Cr(d,n.type),[S,w]=_.useState(n.type===dt.END_TURN);_.useEffect(()=>{setTimeout(()=>w(!1),300)},[]);const P=n.type===dt.END_TURN&&h.isTurnPending(t),E=(()=>{if(!P)return!1;for(const L of h.getAllPermanents())if(h.hasActions(L))return!0;if(h.resolveAndValidate(g.draw(t),f).isValid)return!0;for(const L of h.getHandForUI(t))for(const D of h.getAllSlots())if(h.resolveAndValidate(g.summonOrSpawn({player:t,slot:D,handCardId:L.id,cardName:L.card.name}),f).isValid)return!0;return!1})(),C=n.type===dt.END_TURN&&d.has(Ie.UI_LOCKED)?"":j??(P&&E?"There are still actions you can take!":yo(h,n,l)),R=T?null:e.jsxs("button",{className:`default-step-button${P&&d.size===0&&!E?" important-step-button":""}`,disabled:!m||S,style:S?{cursor:"wait"}:{},children:[b,i?` (${i})`:null,y===null?null:e.jsxs(e.Fragment,{children:[" ",y]})]});return T?e.jsx(e.Fragment,{children:s}):e.jsx("div",{id:r,className:`step-button ${m?"step-valid":"step-preview"}`,onClick:M=>{if(m){if(M.stopPropagation(),!p)return;if(n.type===dt.ACTIVATE_ABILITY){const L=h.getPermanent(n.permanentId),D=h.getSharedEffects(L),I=n.abilityType===Nt.FLEX?D.flexForms:D.specialForms;if(I&&I.length>0){c(n.abilityType,I);return}}p(n)}},children:e.jsx(jo,{payment:v,gain:x,help:C,children:s??R})})}function El(a){var x;const{player:r}=a,s=Ye(),n=Xt(),i=s.gameState[r],c=Ft(b=>b.mouseZoomedCard),u=Ft(b=>b.setMouseZoomedCard),p=Ft(b=>b.resetMouseZoomedCard),f=s.doesPlayerHaveMastery(r,_n),h=n.draw(r),{drawPile:g,topCard:t}=i,o=(()=>t??(g!==void 0&&g.length>0?g[g.length-1]:null))(),l=(o==null?void 0:o.name)!==void 0&&(c==null?void 0:c.cardName)===(o==null?void 0:o.name),d=()=>{o!==null&&o.name!==void 0&&u(o.name)},m=()=>{p()},v=i.drawPileSize??((x=i.drawPile)==null?void 0:x.length)??0;return e.jsxs("div",{className:"hand-deck-info",children:[e.jsx($,{text:o?"Preview top card of draw pile":"Number of cards in draw pile",children:e.jsxs("button",{className:`draw-pile-size ${o?"clickable":""} ${l?"selected":""}`,onClick:()=>l?m():d(),onMouseEnter:d,onMouseLeave:m,children:[e.jsx(Dn,{icon:On.DECK}),v]})}),f&&v>0?e.jsx(ls,{id:Kt.element(It.DRAW),step:h,children:e.jsx("button",{className:`deck-button ${f?"draw":""}`,children:e.jsx(Dn,{icon:On.DRAW})})}):null]})}const wl=10,ua=_.memo(a=>{const{player:r,isAllCardsAvailable:s,cards:n,isSmall:i,isTurnPending:c}=a,u=re(y=>y.selectedCard),p=gn(),f=Ar(),h=_o(),g=kr(),t=ae(y=>y.roomId),o=ye(y=>y.getHandCardWithFocus()),l=Ir(),[d,m]=_.useState(null),v=y=>u!==null&&u.type==os.HAND&&u.player==r&&(u.handCardId!==void 0&&u.handCardId===y.id||u.name!==void 0&&u.name===y.card.name),x=y=>!!o&&o.player===r&&o.index===y,b=y=>j=>{j.stopPropagation(),v(y)?p():s&&y.card.name!==void 0?g(r,y.card.name):h(r,y.id),f()};return _.useEffect(()=>{m(i?"calc(var(--card-normal-width) * 0.3)":`calc(var(--card-normal-width) * (${4+Math.max(n.length-wl,0)*.25} / ${Math.max(n.length-1,4)}))`)},[n.length,m,i]),e.jsx("div",{className:"game-hand-center",style:{flexWrap:i?"wrap":"nowrap"},children:d===null?null:e.jsx(Pr,{children:n.map((y,j)=>{const T=v(y),S=x(j);return e.jsx(Sn.div,{id:Kt.handCard(y),className:`hand-card ${i?"hand-card-small":""} ${T?"selected":""}`,onClick:b(y),animate:{opacity:1,width:d,y:i?0:T?"1em":"2em"},whileHover:{y:0},transition:{duration:l===0?0:.3/l},children:e.jsx(nt,{cardName:y.card.name,size:Me.NORMAL,highlighted:T,keyboardFocused:S,isOwnerTurnPending:c})},`${t??"none"}_${y.id}`)})})})});ua.displayName="HandCardsDisplay";const Nl="E";function sr(a){const{player:r}=a,s=Ye(),n=Xt(),i=s.gameState[r],c=s.isAllCardsAvailable(),u=ze(d=>d.cardsDB),p=ye(d=>d.enabled),f=_.useMemo(()=>{const d=Object.keys(u);return d.sort(),d.map((m,v)=>({id:`${v}`,card:{name:m}}))},[u]),h=ms(),g=c?f:i.hand,t=n.endTurn(r),o=c,l=!So(h,r);return e.jsxs("div",{className:`game-cards-hand ${o?"small-cards":""} ${l?"disable":""}`,children:[e.jsx(El,{player:r}),e.jsx(ua,{player:r,isAllCardsAvailable:c,cards:g,isSmall:o,isTurnPending:s.isTurnPending(r)}),e.jsx("div",{className:"end-turn-button",children:e.jsx(ls,{shortcut:p?Nl:void 0,id:Kt.element(It.END_TURN),step:t},s.gameState.turnNumber)})]})}const ma=a=>{const[r,s]=_.useState(0),[n,i]=_.useState(0);return _.useEffect(()=>{if(!a)return;const c=new ResizeObserver(()=>{s(a.scrollWidth),i(a.scrollHeight)});return c.observe(a),()=>c.disconnect()},[a]),{width:r,height:n}},Ts=10,nr=a=>{const{unmaskSelector:r}=a,[s,n]=_.useState(null),[i,c]=_.useState(null),[u,p]=_.useState(0),[f,h]=_.useState(0);is(r,c),is("#keyframe-mask-img",n);const g=_.useCallback(()=>{if(s===null||i===null)return;const{top:l,left:d}=s.getBoundingClientRect(),{top:m,left:v}=i.getBoundingClientRect();p(v-d),h(m-l)},[s,i,p,h]);_.useEffect(()=>(g(),window.addEventListener("resize",g,{passive:!0}),()=>{window.removeEventListener("resize",g)}),[g]);const{width:t,height:o}=ma(i);return e.jsx("rect",{x:u-Ts,y:f-Ts,width:t+2*Ts,height:o+2*Ts,fill:"black"})},Cl=a=>{const{selector:r,unmaskSelectors:s}=a,[n,i]=_.useState(null),{width:c,height:u}=ma(n);return is("#game-page-root-wrapper",i),e.jsx("div",{className:"keyframe-mask",children:e.jsxs("svg",{id:"keyframe-mask-img",className:"keyframe-mask-img",width:c,height:u,xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("mask",{id:"keyframe-svg-mask-defn",children:[e.jsx("rect",{x:0,y:0,width:c,height:u,fill:"white"}),r?e.jsx(nr,{unmaskSelector:r},r):null,(s??[]).map(p=>e.jsx(nr,{unmaskSelector:p},p))]}),e.jsx("rect",{x:0,y:0,width:c,height:u,fill:"currentColor",mask:"url(#keyframe-svg-mask-defn)"})]})})};const Al=a=>{const{selector:r,placement:s="right",children:n}=a,[i,c]=_.useState(null),[u,p]=_.useState(!1);is(r,c);const{context:f,refs:h,floatingStyles:g,update:t}=Dr({elements:{reference:i??void 0},placement:s,whileElementsMounted:(o,l,d)=>ko(o,l,()=>{d(),p(!0)}),middleware:[Or(5),To(),Eo({mainAxis:!1,crossAxis:!0,limiter:wo()})]});return e.jsx(No,{context:f,modal:!1,children:e.jsx("div",{className:"message-popover",ref:h.setFloating,style:g,children:u?n:null})})};const Il=()=>{const a=ae(E=>E.gameState.keyframe),r=ae(E=>E.sendStep),s=Ye(),n=s.isGameActive(),[i,c]=_.useState(null),{id:u,dialogue:p,speaker:f,selector:h,selectorPermanent:g,selectorSlot:t,placement:o,showNext:l=!1,nextSelector:d,nextSelectorPermanent:m,showMask:v=!1,unmaskSelectors:x,useCutsceneUI:b,hideBattler:y=!1}=a??{},j=(E,C)=>{const R=s.getPermanents({name:E});if(R.length!==1)throw new Error("expect requested selector permanent to exist uniquely");return vs.permanent(R[0],C)},T=(E,C,R)=>{if(R!==void 0)return vs.slot(R);if(C!==void 0)return j(C,E);if(E!==void 0)return E===It.GEMS?vs.gems(je.P1):vs.element(E)},S=T(h,g,t),w=T(d,m)??null,P=_.useCallback(()=>{u!==void 0&&(r==null||r({type:dt.ADVANCE_KEYFRAME,keyframeId:u}))},[r,u]);return is(w,c),_.useEffect(()=>{if(!n||!i)return;const E=i.style.pointerEvents;return i.addEventListener("click",P),i.style.pointerEvents="auto",()=>{i.style.pointerEvents=E,i.removeEventListener("click",P)}},[i,P,n]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"keyframe-container",children:S&&p&&!y&&a!==void 0?e.jsx(Al,{selector:S,placement:o,children:e.jsx(Nn,{keyframe:a})},u):null}),v&&n?e.jsx(Cl,{selector:S,unmaskSelectors:x}):null]})};var ut=(a=>(a.MOVE="move",a.REMOVE="remove",a.CLICK="click",a))(ut||{});const Pl=et.object({type:et.literal("move"),rX:et.number(),rY:et.number()}),Dl=et.object({type:et.literal("remove")}),Ol=et.object({type:et.literal("click"),rX:et.number(),rY:et.number()});et.union([Pl,Dl,Ol]);const rr=()=>document.getElementById("game-page-root")??document.getElementById("mastery-tree-root")??document.body,ha=()=>document.getElementById("game-board")??document.getElementById("mastery-tree-grid")??document.getElementById("game-cutscene-ui-dialog-box"),ar=({x:a,y:r})=>{var c;const s=(c=ha())==null?void 0:c.getBoundingClientRect();if(!s)return{rX:null,rY:null};const n=(a-(s.x+window.scrollX))/s.width,i=(r-(s.y+window.scrollY))/s.height;return{rX:n,rY:i}},Rl=({rX:a,rY:r})=>{var c;const s=(c=ha())==null?void 0:c.getBoundingClientRect();if(!s)return{x:null,y:null};const n=s.width*a+s.x+window.scrollX,i=s.height*r+s.y+window.scrollY;return{x:n,y:i}};function or(a,r=200){let s,n;return function(){const i=arguments,c=this;return s||(s=!0,setTimeout(()=>s=!1,r),n=a.apply(c,i)),n}}const Ll=(a,r)=>{let s=a.length,n=r^s,i=0,c;for(;s>=4;)c=a.charCodeAt(i)&255|(a.charCodeAt(++i)&255)<<8|(a.charCodeAt(++i)&255)<<16|(a.charCodeAt(++i)&255)<<24,c=(c&65535)*1540483477+(((c>>>16)*1540483477&65535)<<16),c^=c>>>24,c=(c&65535)*1540483477+(((c>>>16)*1540483477&65535)<<16),n=(n&65535)*1540483477+(((n>>>16)*1540483477&65535)<<16)^c,s-=4,++i;switch(s){case 3:{n^=(a.charCodeAt(i+2)&255)<<16,n^=(a.charCodeAt(i+1)&255)<<8,n^=a.charCodeAt(i)&255,n=(n&65535)*1540483477+(((n>>>16)*1540483477&65535)<<16);break}case 2:{n^=(a.charCodeAt(i+1)&255)<<8,n^=a.charCodeAt(i)&255,n=(n&65535)*1540483477+(((n>>>16)*1540483477&65535)<<16);break}case 1:{n^=a.charCodeAt(i)&255,n=(n&65535)*1540483477+(((n>>>16)*1540483477&65535)<<16);break}}return n^=n>>>13,n=(n&65535)*1540483477+(((n>>>16)*1540483477&65535)<<16),n^=n>>>15,n>>>0},an=(a,r,s)=>{const n=Ll(a,305441741)%359;return`oklch(${r}% ${s} ${n})`};function Ml({connId:a,x:r,y:s,animated:n=!1}){const i=an(a,75,.12),c=an(a,90,.05),u=_.useMemo(()=>e.jsxs("svg",{width:18,height:20,fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("g",{filter:"url(#filter0_d_103_28)",children:[e.jsx("path",{d:"M2.64616 0.738445C2.56143 0.333479 2.99494 0.0185095 3.35391 0.224235L17.658 8.42208C18.022 8.63067 17.9615 9.17306 17.5606 9.29639L10.618 11.432C10.5105 11.4651 10.418 11.5349 10.3568 11.6292L6.88216 16.9817C6.64914 17.3407 6.0983 17.2377 6.01065 16.8188L2.64616 0.738445Z",fill:i}),e.jsx("path",{d:"M6.48987 16.6677L3.14491 0.680752L17.3684 8.83239L10.471 10.9541C10.2514 11.0217 10.0625 11.1643 9.93741 11.357L6.48987 16.6677Z",stroke:c})]}),e.jsx("defs",{children:e.jsxs("filter",{id:"filter0_d_103_28",x:"0.635422",y:"0.15947",width:"19.2637",height:"21.0409",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e.jsx("feOffset",{dy:"2"}),e.jsx("feGaussianBlur",{stdDeviation:"1"}),e.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"}),e.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_103_28"}),e.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_103_28",result:"shape"})]})})]}),[i,c]);return n?e.jsx(Sn.div,{className:"presence-cursor",animate:{x:r,y:s},transition:{duration:.2},children:u}):e.jsx("div",{className:"presence-cursor",style:{transform:`translateX(${r}px) translateY(${s}px)`},children:u})}function zl({connId:a,x:r,y:s}){const n=an(a,85,.08);return e.jsx(Sn.div,{style:{borderColor:n,transform:`translateX(${r}px) translateY(${s}px)`},className:"presence-cursor-click",initial:{opacity:1,scale:0,x:r,y:s},exit:{opacity:0,scale:1,x:r,y:s},transition:{duration:.4}})}const Fl=()=>{const[a,r]=_.useState({x:0,y:0}),s=te(),n=bt(o=>o.isSpectating),{spectateTeamId:i}=Ge(),c=Ds()===!1&&i===void 0&&!n,u=_.useMemo(()=>or(l=>{c&&s.sendReq({type:G.CURSOR_EVENT,event:l})}),[s,c]),p=_.useMemo(()=>or(l=>{c&&s.sendReq({type:G.CURSOR_EVENT,event:l})}),[s,c]),f=_.useCallback(()=>{u({type:ut.REMOVE})},[u]),h=o=>JSON.parse(JSON.stringify(o))===null,g=_.useCallback(o=>{const{rX:l,rY:d}=ar({x:o.pageX,y:o.pageY});l!==null&&d!==null&&!h(l)&&!h(d)?u({type:ut.MOVE,rX:l,rY:d}):u({type:ut.REMOVE})},[u]),t=_.useCallback(o=>{const{rX:l,rY:d}=ar({x:o.clientX,y:o.clientY});l!==null&&d!==null&&!h(l)&&!h(d)&&p({type:ut.CLICK,rX:l,rY:d})},[p]);return{pos:a,setPos:r,onMouseLeave:f,onMouseMove:g,onClickCapture:t}};let Bl=0;function fa({children:a,cursorGroupName:r,enabled:s,animated:n=!0}){const{onMouseLeave:i,onMouseMove:c,onClickCapture:u}=Fl(),[p,f]=_.useState(!1),[h,g]=_.useState({}),[t,o]=_.useState([]),l=te();return _.useEffect(()=>{if(!p){g({});return}return l.onCursorEvent.addListener(d=>{for(const{connId:m,event:v}of d.events)switch(v.type){case ut.CLICK:case ut.MOVE:{const{rX:x,rY:b}=v,y=Rl({rX:x,rY:b});if(y.x===null&&y.y===null)break;const j=Rn(0,rr().clientWidth-20,y.x),T=Rn(0,rr().clientHeight+20,y.y),S={connId:m,x:j,y:T};if(g(w=>({...w,[m]:S})),v.type===ut.CLICK){const w={...S,id:Bl++};o(P=>[...P,w])}break}case ut.REMOVE:{g(x=>{const{[m]:b,...y}=x;return y});break}}})},[l,p]),_.useEffect(()=>{t.length>0&&o([])},[t]),_.useEffect(()=>{if(s)return l.addAuthEffect(()=>{const d=l.nextEnterRoomReqId++,m=l.onSetCursorGroupAckEvent.addListener(v=>{v===d&&f(!0)});return l.sendReq({type:G.SET_CURSOR_GROUP,cursorGroupName:r,reqId:d}),()=>{m(),f(!1),l.sendReq({type:G.SET_CURSOR_GROUP,cursorGroupName:null,reqId:d})}},Rr.CURSOR)},[s,l,r]),s?e.jsxs("div",{id:"game-presence",onClickCapture:u,onMouseLeave:i,onMouseMove:c,children:[Object.values(h).map(({connId:d,x:m,y:v})=>e.jsx(Ml,{connId:d,x:m,y:v,animated:n},d)),e.jsx(Pr,{children:t.map(({id:d,connId:m,x:v,y:x})=>e.jsx(zl,{connId:m,x:v,y:x},d))}),a]}):e.jsx("div",{id:"game-presence",children:a})}const $l="Z",Ul="X",Gl="C",Hl="V",pa=()=>{const a=kn(),r=Ye(),s=Xt(),n=ms(),i=ye(f=>f.enabled),c=Zt(),u=[];if(a===null)return[];const p=r.getCreateGemsColors(a);for(let f=0;f<p.length;f++){const h=p[f],g=s.create(a,h),t=i?f==0?Gl:f==1?Hl:void 0:void 0;u.push({step:g,button:e.jsx(ls,{id:Kt.element(It.CREATE_GEMS),shortcut:t,step:g},`${dt.CREATE_GEMS}-${h.join("-")}`)})}for(const f of[Nt.FLEX,Nt.SPECIAL]){const h=s.activateAbility(a,f,[]),g=i?f===Nt.FLEX?Ul:$l:void 0;u.push({step:h,button:e.jsx(ls,{id:Kt.element(f===Nt.FLEX?It.FLEX:It.SPECIAL),shortcut:g,step:h},f)})}return u.filter(({step:f})=>{const{failedChecks:h}=r.resolveAndValidate(f,n);return c&&h.add(Ie.UI_LOCKED),h.delete(Ie.NUM_OPTS),!Cr(h,f.type)})};function Kl({fallback:a=null}){const r=re(p=>p.pendingEffect),s=re(p=>p.pendingForms),n=Ar(),i=kn(),c=Ye();Xt(),ye(p=>p.enabled);const u=pa();if(i===null)return null;if(i.id,r!==null){const p=s[0];if(p===void 0)throw new Error("effect opts selection should always have at least one pending form");const f=Co(c,p,r,i.card.name),h=p.choices;return e.jsxs(e.Fragment,{children:[e.jsx(V,{text:f}),h?e.jsx(Wl,{choices:h,permanent:i,pendingEffect:r}):"",e.jsx("button",{onClick:()=>{n()},children:"Cancel"},"cancel")]})}return u.length===0?e.jsx(e.Fragment,{children:a}):e.jsx("div",{className:"card-action-buttons",children:u.map(({button:p})=>p)})}function Wl(a){const{choices:r,permanent:s,pendingEffect:n}=a,i=ae(f=>f.sendStep),c=Xt(),[u,p]=_.useState(r[0]);return e.jsxs(e.Fragment,{children:[e.jsx("select",{value:u,onChange:f=>p(f.target.value),children:r.map(f=>e.jsx("option",{value:f,children:f},f))}),e.jsx("button",{onClick:()=>{u&&i&&i(c.activateAbility(s,n,[{choice:u,type:Bt.ONE_CHOICE}]))},children:"Submit"},"option-select")]})}function Yl(){const{userLog:a}=Us(),[r,s]=_.useState(a),[n,i]=_.useState(!0),c=_.useRef(null);return _.useLayoutEffect(()=>{var p,f,h;const u=(h=(f=(p=c.current)==null?void 0:p.osInstance())==null?void 0:f.elements())==null?void 0:h.viewport;u&&(u.scrollHeight-u.clientHeight-50<=u.scrollTop?i(!0):i(!1)),s(a.trim())},[a]),_.useEffect(()=>{var u,p,f;if(n){const h=(f=(p=(u=c.current)==null?void 0:u.osInstance())==null?void 0:p.elements())==null?void 0:f.viewport;h&&(h.scrollTop=h.scrollHeight-h.clientHeight)}},[n,r]),e.jsx("div",{className:"game-console-wrapper",children:e.jsx(yr,{options:jr,className:"game-console",ref:c,children:r})})}function Vl(){const a=te(),r=ae(y=>y.sendStep),s=Ye(),n=ms(),i=yt(),{selectedDeckSlot:c=null}=ht(i)??{},u=Ot(),[p]=he(),f=Zt(),[h,g]=_.useState(!1),t=ae(y=>y.roomId),{spectateTeamId:o}=Ge(),l=bt(y=>y.isSpectating),{puzName:d}=Ge();if(d===void 0)throw new Error("expect puzName parameter to be defined");const m=(()=>{if(s.isGameActive()){const T=s.getTurnNumber(),S=s.isTurnPending(i);return`Battle in progress. ${`Turn ${Math.floor(T/2)+1}`}. ${S?"It's your turn!":"Opponent's turn."}`}const{winner:y}=s.gameState,{isSolved:j}=s.gameState[i];if(y===void 0)throw new Error("expect winner to be defined when game ends");if(s.getOpponentOf(y),j??!1)return y===i?"You won!":"You lost successfully!";if(s.hasAI())return y===i?"You won, but failed to make any friends.":"You lost.";if(n===Gt.GOD)switch(y){case je.P1:return"Player 1 won.";case je.P2:return"Player 2 won."}return y===i?"You won!":"You lost."})(),v=(()=>{if(!s.areCheckpointsAllowed())return"Saving is not supported for this battle.";const y=(u==null?void 0:u.checkpointSummaries)??{},j=Math.max(0,...Object.keys(y).map(T=>Number(T)))+1;return Array.from(new Array(Ao+1),(T,S)=>{const w=y[S],P=(()=>{if(S===j)return"New save";if(w===void 0)return null;const{turnNumber:E,roomId:C,timestamp:R}=w,M=t!==null&&t!==C;return e.jsx($,{text:`Saved at ${new Date(R).toLocaleString()}`,children:e.jsxs("div",{className:`${M?"save-load-summary-old":""}`,children:[S===0?"Autosave":`Save ${S}`," ",M?"(old)":null,e.jsxs("div",{className:"save-load-turn",children:["Turn ",Math.floor(E/2)+1]})]})})})();return P===null?null:e.jsxs("div",{className:"save-load-row",children:[e.jsx("div",{className:"save-load-status",children:e.jsx(W,{children:P})}),e.jsx($,{text:"Save",children:e.jsx("button",{disabled:S===0||f||s.gameState.phase!==Io.ACTIVE,onClick:()=>{r&&r({type:dt.CREATE_CHECKPOINT,slot:S})},children:e.jsx(W,{children:"üíæ"})})}),e.jsx($,{text:"Load",children:e.jsx("button",{disabled:S===j||f,onClick:()=>{a.sendReq({type:G.RESTORE_CHECKPOINT,puzName:d,slot:S})},children:e.jsx(W,{children:"üì§Ô∏è"})})},t)]},S)})})(),x=s.getTurnNumber()>1&&s.isGameActive()?"Are you sure you want to restart?":null,b=()=>{a.startAIBattleAsync(d,{restart:!0,reuseDeck:!0,devKnobs:fs()})};return e.jsxs(e.Fragment,{children:[o===void 0&&!l?e.jsx("div",{className:"save-load-menu",children:v}):null,e.jsxs("div",{className:"game-menu",children:[e.jsx("div",{className:"game-menu-status",children:m}),d===xe&&o===void 0&&!l?e.jsx("div",{onClick:()=>{a.sendReq({type:G.RESIGN,player:i,puzName:d})},children:e.jsx("button",{disabled:!s.isGameActive(),children:"Forfeit"})}):null,d!==xe&&o===void 0&&!l?e.jsxs(e.Fragment,{children:[c===null?null:e.jsx("div",{children:e.jsx($e,{to:{pathname:`../deck/${c}/${d}`,search:p.toString()},children:e.jsx("button",{children:"Edit deck"})})}),e.jsx("div",{children:e.jsx("button",{disabled:f,onClick:()=>{x?g(!0):b()},children:"Restart"})})]}):null,e.jsx("div",{children:e.jsx($e,{to:{pathname:`../prep/${d}`,search:p.toString()},children:e.jsx("button",{children:"Exit battle"})})})]}),e.jsx(Rs,{title:"Are you sure?",isOpen:h,onClose:()=>g(!1),onConfirm:b,confirmLabel:"Restart",children:x})]})}const ir=a=>`When enabled, you can mouse over keywords in tooltips from ${a} to show another tooltip.`;function ql(){te();const a=ie(b=>b.speed),r=ie(b=>b.setSpeed),s=ie(b=>b.recurseFieldTooltips),n=ie(b=>b.setRecurseFieldTooltips),i=ie(b=>b.recurseActionTooltips),c=ie(b=>b.setRecurseActionTooltips),u=ie(b=>b.animKeroDos),p=ie(b=>b.setAnimKeroDos),f=K(b=>b.setIsHotkeyModalOpen),h=ye(b=>b.enabled),g=tn(b=>b.isEnabled),t=tn(b=>b.setIsEnabled),{puzName:o}=Ge();if(o===void 0)throw new Error("expect puzName parameter to be defined");const l=mt(),{spectateTeamId:d}=Ge(),m=Po(`../spectate/${o}/${d??l}`),x=Ds()??!1?e.jsx("a",{href:m.pathname,target:"_blank",rel:"noreferrer",children:e.jsx("button",{children:"Spectate link"})}):null;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"game-settings",children:[e.jsx($,{text:"Instant speed might improve performance.",directRef:b=>e.jsxs("div",{...b,children:[e.jsx("label",{children:"Animation speed"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{onClick:()=>r(1),disabled:a===1,children:"1√ó"}),e.jsx("button",{onClick:()=>r(2),disabled:a===2,children:"2√ó"}),e.jsx("button",{onClick:()=>r(0),disabled:a===0,children:"Instant"})]})]})}),e.jsxs("div",{className:"game-settings-checkbox",children:[e.jsx("input",{type:"checkbox",id:"hotkeys-checkbox",checked:g,onChange:b=>{const y=b.target.checked;t(y)}})," ",e.jsx("label",{htmlFor:"hotkeys-checkbox",children:"Enable hotkeys"})]}),e.jsx("div",{onClick:()=>f(!0),style:{marginTop:"-0.3em"},children:e.jsxs("button",{children:["Hotkeys Help",h?" (/)":null]})}),e.jsx($,{text:ir("the field"),directRef:b=>e.jsxs("div",{className:"game-settings-checkbox",...b,children:[e.jsx("input",{type:"checkbox",id:"recurse-field-tooltips-checkbox",checked:s,onChange:y=>n(y.target.checked)})," ",e.jsx("label",{htmlFor:"recurse-field-tooltips-checkbox",children:"Nest field tooltips"})]})}),e.jsx($,{text:ir("card action buttons"),directRef:b=>e.jsxs("div",{className:"game-settings-checkbox",...b,children:[e.jsx("input",{type:"checkbox",id:"recurse-action-tooltips-checkbox",checked:i,onChange:y=>c(y.target.checked)})," ",e.jsx("label",{htmlFor:"recurse-action-tooltips-checkbox",children:"Nest action tooltips"})]})}),o===jt?e.jsx($,{text:"Turning off the Kero animation might improve performance.",directRef:b=>e.jsxs("div",{className:"game-settings-checkbox",...b,children:[e.jsx("input",{type:"checkbox",id:"anim-kero-dos-checkbox",checked:u,onChange:y=>p(y.target.checked)})," ",e.jsx("label",{htmlFor:"anim-kero-dos-checkbox",children:"Animate Kero"})]})}):null,x]})})}function Zl(){const a=kn(),r=K(f=>f.leftTabIndex),s=K(f=>f.setLeftTabIndex),n=re(f=>f.resetSelectedCard),i=Lr(),c=yt(),u=Tn(c),p=pa();return e.jsxs(e.Fragment,{children:[e.jsxs(st.Container,{className:"game-board-left",index:r,setIndex:f=>{s(f),n()},items:[{label:"üéÆ",tooltip:"Menu",content:e.jsx(Vl,{})},i?{label:"‚öô",tooltip:"Settings",content:e.jsx(ql,{})}:{label:"üîí",tooltip:"Finish the tutorial to unlock!",content:null,isDisabled:!0},{label:"üìú",tooltip:"Log",content:e.jsx(Yl,{})}],onClick:f=>f.stopPropagation(),children:[e.jsx("div",{className:"game-board-left-content",children:a?e.jsx(Kl,{fallback:e.jsx(st.Content,{})}):e.jsx(st.Content,{})}),e.jsx(st.ButtonList,{className:"game-board-left-buttons",children:e.jsx(st.Buttons,{makeProps:()=>({style:{pointerEvents:"all"}}),overridden:p.length>0})})]}),e.jsxs("div",{className:"player-gems",children:[e.jsx(Ln,{player:u,style:{flexDirection:"column-reverse"}}),Mn[u].dark,e.jsx("div",{style:{writingMode:"vertical-rl",transform:"rotate(180deg)"},children:"Food"}),Mn[c].dark,e.jsx(Ln,{player:c})]})]})}const Xl=Mr/6;function Ql(a){const{keepRunningDuringUpdates:r,isGameActive:s,isOurTimer:n}=a,i=_.useRef(null),c=Pe()===xe,[u,p]=_.useState(!1),f=te(),[h,g]=_.useState(null);_.useEffect(()=>{if(!s){g(null);return}r&&a.startTurnTime!==null&&g({prevTurnsTime:a.prevTurnsTime,startTurnTime:a.startTurnTime})},[r,s,a.prevTurnsTime,a.startTurnTime,g]),_.useEffect(()=>{let o=null;const l=()=>{if(i.current!==null){const{prevTurnsTime:d=a.prevTurnsTime,startTurnTime:m=a.startTurnTime}=h??{},v=m!==null,x=v?new Date().getTime()-m:0,b=(()=>{if(c){const y=Math.max(0,Mr-x);return p(!n&&y<=0),v?y:null}return d+x})();i.current.className=c?`${v?"count-down":""}
             ${b!==null&&b<Xl?"low-time":""}`:"",i.current.textContent=b!==null?Ut(Math.max(0,b)):""}o=requestAnimationFrame(l)};return l(),()=>{o!==null&&cancelAnimationFrame(o)}},[n,c,a.prevTurnsTime,a.startTurnTime,h]);const t=()=>{f.sendReq({type:G.PVP_CLAIM_TIME_VICTORY})};return e.jsxs("div",{className:"speedrun-timer",children:[s||!c?e.jsx("div",{ref:i}):null,u?e.jsx($,{text:"Claim a win because your opponent ran out of time.",directRef:o=>e.jsx("button",{...o,onClick:t,children:"Claim win on time"})}):null]})}function lr(a){const r=Do(),s=U(),n=yt(),i=zr(),c=i===xe,u=Fr(),p=fn(),f=Br(),h=us()??!1,{player:g}=a,t=Ye(),o=t.doesPlayerHaveMastery(g,Yt),{gameState:l}=t,d=l[g],{teamData:m}=d;if(i===null||s===null||u===null||p===null||f===null)return null;const{puzzles:v}=s,{solveTime:x}=v[i],{displayName:b,numPuzzles:y=1,isLegendary:j=!1}=u,T=h?p.findIndex(w=>w.puzName===r):null,S=m===void 0?e.jsxs("div",{children:[e.jsx("b",{children:`${b}${y===1?"":`, Stage ${f+1}`}`}),x===void 0?null:e.jsx("div",{className:"game-puz-complete",children:y===1&&j?"(Befriended)":"(Previously completed)"}),T===null?null:e.jsxs("div",{className:"game-instancer-note",children:["Instancer, Room ",T+1]})]}):(()=>{const{teamId:w,displayName:P,faction:E,factionScoreContribution:C,enabledMasteries:R}=m;return e.jsx(Vt,{teamData:{teamId:w,displayName:P,faction:E,factionScoreContribution:C,hasReputationBoost:R[Oo]??!1?!0:void 0},noLink:!c})})();return e.jsxs("div",{className:"game-team-data",children:[S,o||c?e.jsx(Ql,{prevTurnsTime:d.prevTurnsTime+(t.hasAI()&&g===je.P1?l[je.P2].prevTurnsTime:0),startTurnTime:d.startTurnTime,keepRunningDuringUpdates:t.hasAI(),isGameActive:t.isGameActive(),isOurTimer:g===n}):null]})}function Jl(){const a=ms(),r=vn(),s=r===null?null:r.permanentId??null,n=yt(),i=Tn(n);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"game-board-right",children:[e.jsx(lr,{player:i}),e.jsxs("div",{className:"game-zoomed-card-wrapper",onClick:c=>c.stopPropagation(),children:[e.jsx(la,{}),s!==null&&a===Gt.GOD?e.jsx(ls,{step:{type:dt.REMOVE,permanentId:s}}):null]}),e.jsx(lr,{player:n})]})})}function ec(){const a=K(h=>h.solvedModalState),r=U();if(r===null||a===null)return null;const{factionScoreContributions:s}=r,{puzName:n,teamData:i,stats:c,isWinner:u}=a,p=n===xe,{faction:f}=i;if(f===null)throw new Error("should only show score computation when player is part of faction");return e.jsxs("div",{children:[e.jsxs("div",{className:"score-calc-row",children:[e.jsxs("div",{children:[p?"Win":"Solve"," bonus"]}),e.jsxs("div",{children:["+",St.SOLVE_BONUS]})]}),e.jsxs("div",{className:"score-calc-row",children:[e.jsxs("div",{children:[c.summons," ",c.summons===1?"card":"cards"," played"]}),e.jsxs("div",{children:["+",c.summons*St.SUMMONS_MULTIPLIER]})]}),f!==null?e.jsxs("div",{className:"score-calc-row",children:[e.jsxs("div",{children:[c.factionSummons," ",e.jsx(Ue,{faction:f})," ",c.factionSummons===1?"card":"cards"," played"]}),e.jsxs("div",{children:["+",c.factionSummons*St.FACTION_SUMMONS_MULTIPLIER]})]}):null,e.jsxs("div",{className:"score-calc-row",children:[e.jsxs("div",{children:[c.destroys," ",c.destroys===1?"unit":"units"," destroyed"]}),e.jsxs("div",{children:["+",c.destroys*St.DESTROYS_MULTIPLIER]})]}),e.jsxs("div",{className:"score-calc-row",children:[e.jsxs("div",{children:[c.damageDealt," total damage dealt"]}),e.jsxs("div",{children:["+",Math.min(c.damageDealt,St.DAMAGE_DEALT_CAP)*St.DAMAGE_DEALT_MULTIPLIER]})]}),p?e.jsxs("div",{className:"score-calc-row",children:[e.jsx("div",{children:"PvP bonus"}),e.jsxs("div",{children:["√ó",St.PVP_MULTIPLIER]})]}):null,e.jsx("hr",{className:"score-calc-sep"}),e.jsxs("div",{className:"score-calc-row",children:[e.jsxs("div",{children:[e.jsx(Ue,{faction:f})," points from this battle"]}),e.jsxs("div",{children:["+",Ur(c,p,u)]})]}),e.jsxs("div",{className:"score-calc-row",children:[e.jsxs("div",{children:["Total team ",e.jsx(Ue,{faction:f})," points"]}),e.jsx("div",{children:s[f]})]})]})}function tc(){var Re,we;const a=Ee(),[r]=he(),s=te();us();const n=K(A=>A.solvedModalState),i=K(A=>A.setSolvedModalState),c=U(),u=ze(A=>A.cardsDB),p=pn(),{roomId:f=null,roomPuzName:h=null,roomBattleGroupName:g=null}=n??{},{puzzles:t=null}=c??{},{spectateTeamId:o}=Ge(),l=o!==void 0||h===xe||h!==null&&(t==null?void 0:t[h].solveTime)!==void 0,d=g===null?null:((Re=c==null?void 0:c.battleGroups[g])==null?void 0:Re.numPuzzles)??null,m=Ro(c,g),v=m===null||h===null?null:m.findIndex(A=>A.puzName===h),x=g!==bn&&d!==null&&v!==null&&v!==-1&&v+1<d,b=x?((we=m==null?void 0:m[v+1])==null?void 0:we.puzName)??null:null,y=b!==null&&$r(b,u).getDeckOverride(je.P1)===null,j=b===null||g===null?null:y&&g!==Lo?`/prep/${b}`:`/battle/${b}/start`;if(_.useEffect(()=>{if(f!==null&&j!==null)return s.onNextBattleEvent.addListener(A=>{A===f&&a({pathname:".."+j,search:r.toString()})})},[s,f,r,a,j]),n===null||c===null||t===null||h===null||g===null||p===null)return null;const{puzName:T,cardUnlocks:S,speedrunTime:w,teamData:P,stats:E,isWinner:C,loseReason:R}=n,{cardUnlocks:M}=c,L=c.battleGroups[g],{displayName:D,postBattleDialogue:I}=L,{faction:X,prevBestSpeedrunTime:Y}=P,q=P.enabledMasteries[Yt]??!1,ce=P.enabledMasteries[xt]??!1,J=T===xe,F=Ur(E,J,C),se=ce&&X!==null&&F>0,ne=[...Object.keys(M).filter(A=>M[A].puzName===g),...g===h?[]:Object.keys(M).filter(A=>M[A].puzName===h),...S??[]],pe=t[g].solveTime!==void 0,_e=ne.map(A=>e.jsx(nt,{cardName:A,size:ne.length>3?Me.NORMAL:Me.LARGE,canZoom:!1},A)),de=Y===void 0||w<Y;return e.jsxs(Ht,{className:"game-solved-modal",title:J?`You ${C?"won!":"lost"}`:pe?`${D} ${hn(L)}!`:"Battle complete!",children:[l?e.jsxs(e.Fragment,{children:[R===$t.NORMAL?null:e.jsxs("div",{className:"game-solved-modal-reason",children:["You ",C?"won":"lost"," because"," ",C?"your opponent ":"you ",R===$t.RESIGN?"resigned":R===$t.TIME?"ran out of time":"","."]}),e.jsxs("div",{className:"game-solved-modal-main",children:[ne.length===0?null:e.jsx("div",{className:"game-solved-modal-cards-display",children:e.jsx("div",{className:"game-solved-modal-cards",children:_e})}),q&&!J?e.jsxs("div",{className:"game-solved-modal-speedrun",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Time"}),": ",Ut(w)," ",de?"(New team best!)":null]}),Y===void 0?null:e.jsxs("div",{children:[e.jsx("b",{children:de?"Prev. best":"Team best"}),":"," ",Ut(Y)]})]}),e.jsx(rn,{puzName:h})]}):null,e.jsx("div",{className:`game-solved-modal-score${se?"":" centered"}`,children:se?e.jsxs(e.Fragment,{children:[e.jsx(ec,{}),e.jsx(Ps,{})]}):e.jsxs("div",{children:[e.jsxs("div",{children:[E.summons," ",E.summons===1?"card":"cards"," ","played"]}),e.jsxs("div",{children:[E.destroys," ",E.destroys===1?"unit":"units"," ","destroyed"]}),e.jsxs("div",{children:[E.damageDealt," damage dealt"]})]})})]}),I!==void 0?e.jsx("div",{className:"game-solved-modal-dialogue",children:e.jsx("div",{children:e.jsx(Bs,{speaker:De.KERO_DOS,dialogue:I})})}):null]}):e.jsx("div",{className:"game-solved-modal-main",children:e.jsx(Oe,{inline:!0})}),e.jsxs("div",{className:"game-solved-modal-buttons",children:[e.jsx("button",{onClick:()=>{i(null)},style:{marginRight:"auto"},children:"View board"}),!B.isPosthunt&&pe&&o===void 0?e.jsx("a",{href:`${B.djangoBaseUrl}solve/${g}`,children:e.jsx("button",{children:"Leave feedback"})}):null,!J&&p?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`${B.djangoBaseUrl}solution/${g}`,children:e.jsx("button",{children:"Solution"})}),e.jsx("a",{href:`${B.djangoBaseUrl}stats/${g}`,children:e.jsx("button",{children:"Stats"})})]}):null,x&&o===void 0?e.jsx("a",{href:j===null?"#":`${B.djangoBaseUrl}game${j}`,onClick:A=>{j!==null&&(s.sendReq({type:G.NEXT_BATTLE}),A.preventDefault())},children:e.jsx("button",{className:j===null?"loading":"",disabled:j===null,children:"Next battle"})}):null,e.jsx($e,{to:{pathname:`../prep/${T}`,search:r.toString()},style:{marginLeft:"auto"},children:e.jsx("button",{children:"Exit battle"})})]})]})}const sc=()=>{const[a,r]=_.useState(!1),s=ae(P=>P.roomId),n=ae(P=>P.isEndCutsceneRedirectHandled),i=Ye();ze(P=>P.cardsDB);const c=yt(),u=K(P=>P.isPageReady),p=K(P=>P.setLeftTabIndex),f=K(P=>P.setSolvedModalState),h=Ee(),[g]=he(),t=Pe(),o=zr(),l=jn();Fr(),Br(),Mo();const d=i.hasGameEnded(),{gameState:m}=i,v=m[c],{loseReason:x}=m,{teamData:b,isSolved:y=!1,stats:j}=v,T=i.getEndCutsceneRedirect(),S=i.getEndCutsceneRedirectDjango(),w=d?i.getSpeedrunTime():null;return _.useEffect(()=>{if(u&&l!==null)if(d){if(b===void 0)throw new Error("expect team data to be defined for player perspective");if(y&&(T!==null||S!==null)){if(n)return;if(o!==jt){h({pathname:`../prep/${t}`,search:g.toString()});return}}if(!a){if(r(!0),p(zo.MENU),y){if(w===null)throw new Error("expect speedrun time to be computed");if(s===null)throw new Error("expect roomId to be set");f({roomId:s,puzName:t,roomPuzName:o,roomBattleGroupName:l,cardUnlocks:v.cardUnlocks??[],speedrunTime:w,teamData:b,stats:j,isWinner:!0,loseReason:x})}if(t===xe){if(s===null)throw new Error("expect roomId to be set");f({roomId:s,puzName:t,roomPuzName:o,roomBattleGroupName:l,cardUnlocks:v.cardUnlocks??[],speedrunTime:0,teamData:b,stats:j,isWinner:m.winner===c,loseReason:x})}}}else r(!1)},[u,d,a,r,f,y,v.cardUnlocks,T,S,h,g,b,t,w,j,s,p,o,l,m.winner,c,x,n]),d},nc=(a,r,s,n)=>{const i=te(),c=ae(u=>u.setGameState);_.useEffect(()=>{if(a===null)return;const u=i.addEnterRoomEffect(a,(p,f)=>(async()=>{const{speed:h}=ie.getState(),g=s(p,f),{subscribedTeam:t,subscribedTeamBattle:o}=ee.getState().globalState,l=(o==null?void 0:o.roomPuzName)??null,d=Fo(t,l),m=(d==null?void 0:d.battleGroupName)??null,x=Bo(l,m)?h:1;if(x===0)await g;else{const b=((r==null?void 0:r[p.type])??0)/x,y=new Promise(j=>setTimeout(j,b));await Promise.all([y,g])}f()||i.setClientDoneApplyingUpdate()})(),n);return()=>{u(),c(fr("vanilla",{}))}},[i,a,r,s,c,n])},rc={[ge.MOVE]:200,[ge.SWAP]:200,[ge.DAMAGE_PERMANENT]:200,[ge.REMOVE_PERMANENT]:200},ga=(a,r,s)=>{const{addToUserLog:n}=Us.getState(),{gameState:i,setRoomId:c,setIsEndCutsceneRedirectHandled:u}=ae.getState(),{cardsDB:p}=ze.getState(),f=Nr(p,i),h=Hr(ae.getState().role);switch(a.type){case ge.OVERRIDE_STATE:{const{roomId:g}=a;c(g);const{resetSelectedCard:t,resetEffectOpts:o}=re.getState(),{resetSelectedCard:l,resetEffectOpts:d}=ye.getState(),{resetHoverState:m}=$o.getState();t(),o(),l(),d(),m();break}case ge.ANNOUNCE:{n(a.message);break}case ge.ANNOUNCE_SUMMON_PERMANENT:{n(`${a.player===h?"You play":"Opponent plays"} ${a.cardName}`);break}case ge.ANNOUNCE_MOVE:{n(`${a.player===h?"You move":"Opponent moves"} ${a.cardName}`);break}case ge.ANNOUNCE_ATTACK_CARD:{n(`${a.cardName} attacks ${a.target} for ${a.damage}`);break}case ge.DRAW_CARD:{const g=a.card.name===void 0?"a card":f.getCardDisplayName(a.card);n(`${a.player===h?"You draw":"Opponent draws"} ${g}`);break}case ge.DAMAGE_PERMANENT:{const g=f.getPermanent(a.permanentId),t=f.getCardDisplayName(g);n(a.damage<0?`${-a.damage} damage removed from ${t}`:`${t} suffers ${a.damage} damage`);break}case ge.REMOVE_PERMANENT:{const g=f.getPermanent(a.permanentId),t=f.getCardDisplayName(g);n(`${t} expires`);break}case ge.START_TURN:{const g=a.player===h?"Your":"Opponent's",t=Math.floor(f.getTurnNumber()/2)+1;n(`‚Äî ${g} turn ${t}`);break}case ge.SET_GAME_RESULT:{const{gameState:g}=f,t=g[h],{winner:o,loseReason:l}=a,{teamData:d}=t;if(d===void 0)throw new Error("expect team data to be defined for player perspective");const{isReplay:m}=d,v=f.getEndCutsceneRedirect(),x=f.getEndCutsceneRedirectDjango(),b=(()=>{const y=o===h;switch(l){case $t.NORMAL:return`You ${y?"won":"lost"}.`;case $t.RESIGN:return`You ${y?"won":"lost"} because ${y?"your opponent":"you"} resigned.`;case $t.TIME:return`You ${y?"won":"lost"} because ${y?"your opponent":"you"} ran out of time.`}})();if(b&&n(b),o===h&&(!m||g.puzName===Os)){if(v!==null){r({pathname:".."+v,search:s.toString()}),u(!0);return}if(x!==null){window.location.href=`${B.djangoBaseUrl}${x}`,u(!0);return}}break}}},ac=async(a,r,s,n,i)=>{const{gameState:c,applyUpdate:u,setUpdateLock:p}=ae.getState(),{setIsPageReady:f}=K.getState(),{animateUpdate:h}=Gr.getState();p(!0),ga(n,r,s);try{await h(n,i),n.type===ge.WAIT_ANIMATE&&await new Promise(t=>setTimeout(t,n.waitTime))}catch(t){console.error(t)}if(i())return;const{role:g}=a;if(g===void 0)throw new Error("expect role to be defined once we've been joined to a room");u(n,g),p(!1),f(!0)},oc=async(a,r,s,n,i)=>{const{applyUpdate:c}=ae.getState(),{setIsPageReady:u}=K.getState();for(const p of n){ga(p,r,s);const{role:f}=a;if(f===void 0)throw new Error("expect role to be defined once we've been joined to a room");if(p.type===ge.WAIT_ANIMATE&&(await new Promise(h=>setTimeout(h,p.waitTime)),i()))return;c(p,f)}u(!0)},ic=()=>{const a=te(),r=bt(g=>g.isAdminEnabled),s=Ee(),[n]=he(),i=Pe(),{spectateTeamId:c}=Ge(),u=En(),p=_.useMemo(()=>u!==null&&!u?{puzName:i,role:r?B.role:void 0,spectateTeamId:c}:null,[i,r,c,u]),f=_.useMemo(()=>async(g,t)=>await ac(a,s,n,g,t),[a,s,n]),h=_.useMemo(()=>async(g,t)=>await oc(a,s,n,g,t),[a,s,n]);nc(p,rc,f,h)},lc=()=>{const a=ae(f=>f.setStepLock),r=ae(f=>f.setSendStep),s=Kr(),n=Ee(),[i]=he(),c=Pe(),u=te(),p=ye(f=>f.resetForSuccessfulStep);_.useEffect(()=>u.addAuthEffect(()=>{let f=!1;return r(h=>{(async()=>{s(),a(!0);const g=await u.sendStepAsync(h);if(!f)if(a(!1),g!==null){const{errCode:t}=g;switch(t){case Ns.CANCELED_BY_CLIENT:break;case Ns.INVALID_STEP:{if(B.localMode)throw new Error("unexpected invalid step error");break}default:throw new Error(`unhandled error "${t}"`)}}else p()})()}),()=>{f=!0,r(null)}}),[u,r,s,p,a]),_.useEffect(()=>u.onErrorEvent.addListener(f=>{a(!1),f.errCode===Ns.NO_ROOM&&n({pathname:`../prep/${c}`,search:i.toString()},{replace:!0})}),[u,a,c,n,i])},cc=()=>{const a=re(p=>p.selectedCard),r=re(p=>p.isKeyframeSelected),s=Uo(),n=gn(),i=Ye(),c=ae(p=>p.gameState.keyframe),{id:u}=c??{};_.useEffect(()=>{const p=(()=>{switch(u){case"tutorial1-attack":return{name:"yoshisaur-munchakoopas"};case"tutorial2-attack-2":return{name:"new-boarn"};case"tutorial3-after-summon-new-boarn":return{name:"new-boarn"};case"tutorial3-focus-hog":return{name:"hog"};case"tutorial4-focus-beeowulf-2":return{name:"beeowulf"};case"tutorial4-focus-calf-1":case"tutorial4-focus-calf-2":return{name:"chocolate-calf"};default:return}})();if(p===void 0){r&&!(u!==void 0&&["tutorial2-free-play"].includes(u))&&n();return}if(p===null){n();return}const f=i.getPermanents(p);if(f.length!==1)throw new Error("expect unique permanent when force selecting");const h=f[0].id;a!==null&&a.type===os.PERMANENT&&a.permanentId===h||s(h,!0)},[u,s,i,a,r,n])};function cr(){U();const a=Te(F=>F.setSubscribedTeamBattle),r=ae(F=>F.setStepLock),s=ae(F=>F.setUpdateLock),n=Zt(),i=Go(),c=Kr(),u=Ye(),p=u.isGameActive(),f=te(),h=mt(),g=yt(),t=K(F=>F.isPageReady),o=K(F=>F.setIsPageReady),l=K(F=>F.solvedModalState),d=K(F=>F.setSolvedModalState),m=K(F=>F.isHotkeyModalOpen),v=K(F=>F.setIsHotkeyModalOpen),x=Pe(),b=at(),{spectateTeamId:y}=Ge(),j=Ir(),T=Lr(),S=Us(F=>F.clearLog),w=ye(F=>F.resetState),P=ye(F=>F.setEnabled),E=tn(F=>F.isEnabled),C=ae(F=>F.setIsEndCutsceneRedirectHandled),R=bt(F=>F.isSpectating),M=Ee(),[L]=he(),D=yn(),I=En(),X=ae(F=>F.gameState.keyframe),{hideGame:Y=!1,useCutsceneUI:q=!1,showMask:ce=!1}=X??{};_.useEffect(()=>{I!==null&&I&&M({pathname:`../prep/${x}`,search:L.toString()})},[I,x,M,L]),_.useEffect(()=>()=>{r(!1),s(!1),c(),o(!1),d(null),v(!1),S(),w(),C(!1)},[r,s,c,o,d,v,S,w,C]),_.useEffect(()=>{if(!(I===null||I)&&!R&&b!==null)return f.addAuthEffect(()=>{f.sendReq({type:G.VIEW_PUZZLE,puzName:b})})},[b,f,R,I]),_.useEffect(()=>{h!==null&&(D===null||!D||a({teamId:y??h,puzName:x}))},[a,x,h,y,D]),cc(),lc(),ic();const J=sc();return hl(),_.useEffect(()=>{if(J||!T){P(!1);return}P(E)},[J,T,P,E]),_.useEffect(()=>{f.isFlushToggled=j===0},[f,j]),!t||I===null||I?e.jsx(Oe,{size:128}):e.jsxs(e.Fragment,{children:[e.jsx(Fs,{}),e.jsx(fa,{cursorGroupName:x,enabled:!0,children:e.jsxs("div",{className:`game-and-keyframe${l===null?"":" unfocused"}`,children:[Y?null:e.jsx("div",{className:"below-nav",id:"game-page-root-wrapper",children:e.jsx("div",{id:"game-page-root",className:`game-page-root ${i&&ce?"game-lock":""}`,children:e.jsxs("div",{className:"game-play-area",onClick:()=>{c()},children:[u.hasAI()?e.jsx(ul,{}):e.jsx(sr,{player:Tn(g)}),e.jsxs("div",{className:"game-center-area",children:[e.jsx("div",{className:"game-left-area",children:e.jsx(Zl,{})}),e.jsx(Ho,{}),e.jsx("div",{className:"game-right-area",children:e.jsx(Jl,{})})]}),e.jsx(sr,{player:g})]})})}),e.jsxs("div",{className:n?"game-lock":"",children:[e.jsx(Il,{}),q&&!(!Y&&!p)?e.jsx("div",{className:"below-nav game-cutscene-ui-wrapper",children:e.jsx(ml,{})}):null]})]})}),e.jsxs(Ht,{title:"Hotkey Help",isOpen:m,children:[e.jsxs("div",{className:"hotkey-help-modal-content",children:[e.jsx("kbd",{children:"W"}),e.jsx("kbd",{children:"A"}),e.jsx("kbd",{children:"S"}),e.jsx("kbd",{children:"D"})," / ",e.jsx("kbd",{children:"‚Üë"}),e.jsx("kbd",{children:"‚Üê"}),e.jsx("kbd",{children:"‚Üì"}),e.jsx("kbd",{children:"‚Üí"})," Move cursor",e.jsx("br",{}),e.jsx("kbd",{children:"Space"}),"/",e.jsx("kbd",{children:"Enter"})," Select",e.jsx("br",{}),e.jsx("kbd",{children:"Esc"})," Deselect",e.jsx("br",{}),e.jsx("kbd",{children:"E"})," End turn",e.jsx("br",{}),u.doesPlayerHaveMastery(g,_n)?e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"P"})," Pay 2 Food to draw a card",e.jsx("br",{})]}):null,e.jsx("kbd",{children:"Z"})," Special",e.jsx("br",{}),e.jsx("kbd",{children:"X"})," Flex",e.jsx("br",{}),e.jsx("kbd",{children:"C"})," Create",e.jsx("br",{}),e.jsx("kbd",{children:"V"})," Create2 (if there's a second create option)",e.jsx("br",{}),e.jsx("kbd",{children:"F"})," Focus field",e.jsx("br",{}),e.jsx("kbd",{children:"H"})," Focus hand",e.jsx("br",{}),e.jsx("kbd",{children:"1"}),"-",e.jsx("kbd",{children:"0"})," Select 1st through 10th card in hand",e.jsx("br",{}),e.jsx("kbd",{children:"/"})," Show help"]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{v(!1)},children:"Okay!"})})]}),e.jsx(tc,{})]})}const dc="/static/game/assets/rock-lobster-81b7077a.mp3",uc={cheer:[0,10057.142857142857],notif:[12e3,1235.9637188208624],"notif-bells":[15e3,2001.8820861678003],"notif-cave":[19e3,4002.426303854875],"notif-claps":[25e3,4002.426303854875],"notif-trumpets-1":[31e3,2099.523809523809],"notif-trumpets-2":[35e3,1981.2471655328777],"step-summon":[38e3,615.5782312925169],"step-add-gems":[4e4,877.7551020408155],"step-remove-permanent":[42e3,799.297052154195],"step-move":[44e3,309.7505668934275],"step-damage-permanent":[46e3,448.9795918367321],"step-heal":[48e3,1503.4693877551035],"uwu-1":[51e3,3030.204081632654],"uwu-2":[56e3,3030.204081632654],"uwu-3":[61e3,2991.0204081632655],"uwu-4":[65e3,2031.7460317460245],"uwu-5":[69e3,2972.154195011342],"uwu-6":[73e3,2577.4149659863924],"your-turn":[77e3,1002.063492063499]},on={sprite:uc},dr="/static/game/assets/sfx-547dd733.mp3";var Mt={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(a){(function(){var r=function(){this.init()};r.prototype={init:function(){var t=this||s;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window<"u"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var o=this||s;if(t=parseFloat(t),o.ctx||g(),typeof t<"u"&&t>=0&&t<=1){if(o._volume=t,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(t,s.ctx.currentTime);for(var l=0;l<o._howls.length;l++)if(!o._howls[l]._webAudio)for(var d=o._howls[l]._getSoundIds(),m=0;m<d.length;m++){var v=o._howls[l]._soundById(d[m]);v&&v._node&&(v._node.volume=v._volume*t)}return o}return o._volume},mute:function(t){var o=this||s;o.ctx||g(),o._muted=t,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(t?0:o._volume,s.ctx.currentTime);for(var l=0;l<o._howls.length;l++)if(!o._howls[l]._webAudio)for(var d=o._howls[l]._getSoundIds(),m=0;m<d.length;m++){var v=o._howls[l]._soundById(d[m]);v&&v._node&&(v._node.muted=t?!0:v._muted)}return o},stop:function(){for(var t=this||s,o=0;o<t._howls.length;o++)t._howls[o].stop();return t},unload:function(){for(var t=this||s,o=t._howls.length-1;o>=0;o--)t._howls[o].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close<"u"&&(t.ctx.close(),t.ctx=null,g()),t},codecs:function(t){return(this||s)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||s;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio<"u")try{var o=new Audio;typeof o.oncanplaythrough>"u"&&(t._canPlayEvent="canplay")}catch{t.noAudio=!0}else t.noAudio=!0;try{var o=new Audio;o.muted&&(t.noAudio=!0)}catch{}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||s,o=null;try{o=typeof Audio<"u"?new Audio:null}catch{return t}if(!o||typeof o.canPlayType!="function")return t;var l=o.canPlayType("audio/mpeg;").replace(/^no$/,""),d=t._navigator?t._navigator.userAgent:"",m=d.match(/OPR\/(\d+)/g),v=m&&parseInt(m[0].split("/")[1],10)<33,x=d.indexOf("Safari")!==-1&&d.indexOf("Chrome")===-1,b=d.match(/Version\/(.*?) /),y=x&&b&&parseInt(b[1],10)<15;return t._codecs={mp3:!!(!v&&(l||o.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!l,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!y&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!y&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||s;if(!(t._audioUnlocked||!t.ctx)){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&t.ctx.sampleRate!==44100&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var o=function(l){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var d=new Audio;d._unlocked=!0,t._releaseHtml5Audio(d)}catch{t.noAudio=!0;break}for(var m=0;m<t._howls.length;m++)if(!t._howls[m]._webAudio)for(var v=t._howls[m]._getSoundIds(),x=0;x<v.length;x++){var b=t._howls[m]._soundById(v[x]);b&&b._node&&!b._node._unlocked&&(b._node._unlocked=!0,b._node.load())}t._autoResume();var y=t.ctx.createBufferSource();y.buffer=t._scratchBuffer,y.connect(t.ctx.destination),typeof y.start>"u"?y.noteOn(0):y.start(0),typeof t.ctx.resume=="function"&&t.ctx.resume(),y.onended=function(){y.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var j=0;j<t._howls.length;j++)t._howls[j]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),t}},_obtainHtml5Audio:function(){var t=this||s;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var o=new Audio().play();return o&&typeof Promise<"u"&&(o instanceof Promise||typeof o.then=="function")&&o.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var o=this||s;return t._unlocked&&o._html5AudioPool.push(t),o},_autoSuspend:function(){var t=this;if(!(!t.autoSuspend||!t.ctx||typeof t.ctx.suspend>"u"||!s.usingWebAudio)){for(var o=0;o<t._howls.length;o++)if(t._howls[o]._webAudio){for(var l=0;l<t._howls[o]._sounds.length;l++)if(!t._howls[o]._sounds[l]._paused)return t}return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var d=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(d,d)}},3e4),t}},_autoResume:function(){var t=this;if(!(!t.ctx||typeof t.ctx.resume>"u"||!s.usingWebAudio))return t.state==="running"&&t.ctx.state!=="interrupted"&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):t.state==="suspended"||t.state==="running"&&t.ctx.state==="interrupted"?(t.ctx.resume().then(function(){t.state="running";for(var o=0;o<t._howls.length;o++)t._howls[o]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):t.state==="suspending"&&(t._resumeAfterSuspend=!0),t}};var s=new r,n=function(t){var o=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}o.init(t)};n.prototype={init:function(t){var o=this;return s.ctx||g(),o._autoplay=t.autoplay||!1,o._format=typeof t.format!="string"?t.format:[t.format],o._html5=t.html5||!1,o._muted=t.mute||!1,o._loop=t.loop||!1,o._pool=t.pool||5,o._preload=typeof t.preload=="boolean"||t.preload==="metadata"?t.preload:!0,o._rate=t.rate||1,o._sprite=t.sprite||{},o._src=typeof t.src!="string"?t.src:[t.src],o._volume=t.volume!==void 0?t.volume:1,o._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:t.xhr&&t.xhr.withCredentials?t.xhr.withCredentials:!1},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=t.onend?[{fn:t.onend}]:[],o._onfade=t.onfade?[{fn:t.onfade}]:[],o._onload=t.onload?[{fn:t.onload}]:[],o._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],o._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],o._onpause=t.onpause?[{fn:t.onpause}]:[],o._onplay=t.onplay?[{fn:t.onplay}]:[],o._onstop=t.onstop?[{fn:t.onstop}]:[],o._onmute=t.onmute?[{fn:t.onmute}]:[],o._onvolume=t.onvolume?[{fn:t.onvolume}]:[],o._onrate=t.onrate?[{fn:t.onrate}]:[],o._onseek=t.onseek?[{fn:t.onseek}]:[],o._onunlock=t.onunlock?[{fn:t.onunlock}]:[],o._onresume=[],o._webAudio=s.usingWebAudio&&!o._html5,typeof s.ctx<"u"&&s.ctx&&s.autoUnlock&&s._unlockAudio(),s._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&o._preload!=="none"&&o.load(),o},load:function(){var t=this,o=null;if(s.noAudio){t._emit("loaderror",null,"No audio support.");return}typeof t._src=="string"&&(t._src=[t._src]);for(var l=0;l<t._src.length;l++){var d,m;if(t._format&&t._format[l])d=t._format[l];else{if(m=t._src[l],typeof m!="string"){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}d=/^data:audio\/([^;,]+);/i.exec(m),d||(d=/\.([^.]+)$/.exec(m.split("?",1)[0])),d&&(d=d[1].toLowerCase())}if(d||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),d&&s.codecs(d)){o=t._src[l];break}}if(!o){t._emit("loaderror",null,"No codec support for selected audio sources.");return}return t._src=o,t._state="loading",window.location.protocol==="https:"&&o.slice(0,5)==="http:"&&(t._html5=!0,t._webAudio=!1),new i(t),t._webAudio&&u(t),t},play:function(t,o){var l=this,d=null;if(typeof t=="number")d=t,t=null;else{if(typeof t=="string"&&l._state==="loaded"&&!l._sprite[t])return null;if(typeof t>"u"&&(t="__default",!l._playLock)){for(var m=0,v=0;v<l._sounds.length;v++)l._sounds[v]._paused&&!l._sounds[v]._ended&&(m++,d=l._sounds[v]._id);m===1?t=null:d=null}}var x=d?l._soundById(d):l._inactiveSound();if(!x)return null;if(d&&!t&&(t=x._sprite||"__default"),l._state!=="loaded"){x._sprite=t,x._ended=!1;var b=x._id;return l._queue.push({event:"play",action:function(){l.play(b)}}),b}if(d&&!x._paused)return o||l._loadQueue("play"),x._id;l._webAudio&&s._autoResume();var y=Math.max(0,x._seek>0?x._seek:l._sprite[t][0]/1e3),j=Math.max(0,(l._sprite[t][0]+l._sprite[t][1])/1e3-y),T=j*1e3/Math.abs(x._rate),S=l._sprite[t][0]/1e3,w=(l._sprite[t][0]+l._sprite[t][1])/1e3;x._sprite=t,x._ended=!1;var P=function(){x._paused=!1,x._seek=y,x._start=S,x._stop=w,x._loop=!!(x._loop||l._sprite[t][2])};if(y>=w){l._ended(x);return}var E=x._node;if(l._webAudio){var C=function(){l._playLock=!1,P(),l._refreshBuffer(x);var D=x._muted||l._muted?0:x._volume;E.gain.setValueAtTime(D,s.ctx.currentTime),x._playStart=s.ctx.currentTime,typeof E.bufferSource.start>"u"?x._loop?E.bufferSource.noteGrainOn(0,y,86400):E.bufferSource.noteGrainOn(0,y,j):x._loop?E.bufferSource.start(0,y,86400):E.bufferSource.start(0,y,j),T!==1/0&&(l._endTimers[x._id]=setTimeout(l._ended.bind(l,x),T)),o||setTimeout(function(){l._emit("play",x._id),l._loadQueue()},0)};s.state==="running"&&s.ctx.state!=="interrupted"?C():(l._playLock=!0,l.once("resume",C),l._clearTimer(x._id))}else{var R=function(){E.currentTime=y,E.muted=x._muted||l._muted||s._muted||E.muted,E.volume=x._volume*s.volume(),E.playbackRate=x._rate;try{var D=E.play();if(D&&typeof Promise<"u"&&(D instanceof Promise||typeof D.then=="function")?(l._playLock=!0,P(),D.then(function(){l._playLock=!1,E._unlocked=!0,o?l._loadQueue():l._emit("play",x._id)}).catch(function(){l._playLock=!1,l._emit("playerror",x._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),x._ended=!0,x._paused=!0})):o||(l._playLock=!1,P(),l._emit("play",x._id)),E.playbackRate=x._rate,E.paused){l._emit("playerror",x._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}t!=="__default"||x._loop?l._endTimers[x._id]=setTimeout(l._ended.bind(l,x),T):(l._endTimers[x._id]=function(){l._ended(x),E.removeEventListener("ended",l._endTimers[x._id],!1)},E.addEventListener("ended",l._endTimers[x._id],!1))}catch(I){l._emit("playerror",x._id,I)}};E.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(E.src=l._src,E.load());var M=window&&window.ejecta||!E.readyState&&s._navigator.isCocoonJS;if(E.readyState>=3||M)R();else{l._playLock=!0,l._state="loading";var L=function(){l._state="loaded",R(),E.removeEventListener(s._canPlayEvent,L,!1)};E.addEventListener(s._canPlayEvent,L,!1),l._clearTimer(x._id)}}return x._id},pause:function(t){var o=this;if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"pause",action:function(){o.pause(t)}}),o;for(var l=o._getSoundIds(t),d=0;d<l.length;d++){o._clearTimer(l[d]);var m=o._soundById(l[d]);if(m&&!m._paused&&(m._seek=o.seek(l[d]),m._rateSeek=0,m._paused=!0,o._stopFade(l[d]),m._node))if(o._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),o._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||o._emit("pause",m?m._id:null)}return o},stop:function(t,o){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"stop",action:function(){l.stop(t)}}),l;for(var d=l._getSoundIds(t),m=0;m<d.length;m++){l._clearTimer(d[m]);var v=l._soundById(d[m]);v&&(v._seek=v._start||0,v._rateSeek=0,v._paused=!0,v._ended=!0,l._stopFade(d[m]),v._node&&(l._webAudio?v._node.bufferSource&&(typeof v._node.bufferSource.stop>"u"?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),l._cleanBuffer(v._node)):(!isNaN(v._node.duration)||v._node.duration===1/0)&&(v._node.currentTime=v._start||0,v._node.pause(),v._node.duration===1/0&&l._clearSound(v._node))),o||l._emit("stop",v._id))}return l},mute:function(t,o){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"mute",action:function(){l.mute(t,o)}}),l;if(typeof o>"u")if(typeof t=="boolean")l._muted=t;else return l._muted;for(var d=l._getSoundIds(o),m=0;m<d.length;m++){var v=l._soundById(d[m]);v&&(v._muted=t,v._interval&&l._stopFade(v._id),l._webAudio&&v._node?v._node.gain.setValueAtTime(t?0:v._volume,s.ctx.currentTime):v._node&&(v._node.muted=s._muted?!0:t),l._emit("mute",v._id))}return l},volume:function(){var t=this,o=arguments,l,d;if(o.length===0)return t._volume;if(o.length===1||o.length===2&&typeof o[1]>"u"){var m=t._getSoundIds(),v=m.indexOf(o[0]);v>=0?d=parseInt(o[0],10):l=parseFloat(o[0])}else o.length>=2&&(l=parseFloat(o[0]),d=parseInt(o[1],10));var x;if(typeof l<"u"&&l>=0&&l<=1){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,o)}}),t;typeof d>"u"&&(t._volume=l),d=t._getSoundIds(d);for(var b=0;b<d.length;b++)x=t._soundById(d[b]),x&&(x._volume=l,o[2]||t._stopFade(d[b]),t._webAudio&&x._node&&!x._muted?x._node.gain.setValueAtTime(l,s.ctx.currentTime):x._node&&!x._muted&&(x._node.volume=l*s.volume()),t._emit("volume",x._id))}else return x=d?t._soundById(d):t._sounds[0],x?x._volume:0;return t},fade:function(t,o,l,d){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(t,o,l,d)}}),m;t=Math.min(Math.max(0,parseFloat(t)),1),o=Math.min(Math.max(0,parseFloat(o)),1),l=parseFloat(l),m.volume(t,d);for(var v=m._getSoundIds(d),x=0;x<v.length;x++){var b=m._soundById(v[x]);if(b){if(d||m._stopFade(v[x]),m._webAudio&&!b._muted){var y=s.ctx.currentTime,j=y+l/1e3;b._volume=t,b._node.gain.setValueAtTime(t,y),b._node.gain.linearRampToValueAtTime(o,j)}m._startFadeInterval(b,t,o,l,v[x],typeof d>"u")}}return m},_startFadeInterval:function(t,o,l,d,m,v){var x=this,b=o,y=l-o,j=Math.abs(y/.01),T=Math.max(4,j>0?d/j:d),S=Date.now();t._fadeTo=l,t._interval=setInterval(function(){var w=(Date.now()-S)/d;S=Date.now(),b+=y*w,b=Math.round(b*100)/100,y<0?b=Math.max(l,b):b=Math.min(l,b),x._webAudio?t._volume=b:x.volume(b,t._id,!0),v&&(x._volume=b),(l<o&&b<=l||l>o&&b>=l)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,x.volume(l,t._id),x._emit("fade",t._id))},T)},_stopFade:function(t){var o=this,l=o._soundById(t);return l&&l._interval&&(o._webAudio&&l._node.gain.cancelScheduledValues(s.ctx.currentTime),clearInterval(l._interval),l._interval=null,o.volume(l._fadeTo,t),l._fadeTo=null,o._emit("fade",t)),o},loop:function(){var t=this,o=arguments,l,d,m;if(o.length===0)return t._loop;if(o.length===1)if(typeof o[0]=="boolean")l=o[0],t._loop=l;else return m=t._soundById(parseInt(o[0],10)),m?m._loop:!1;else o.length===2&&(l=o[0],d=parseInt(o[1],10));for(var v=t._getSoundIds(d),x=0;x<v.length;x++)m=t._soundById(v[x]),m&&(m._loop=l,t._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=l,l&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,t.playing(v[x])&&(t.pause(v[x],!0),t.play(v[x],!0)))));return t},rate:function(){var t=this,o=arguments,l,d;if(o.length===0)d=t._sounds[0]._id;else if(o.length===1){var m=t._getSoundIds(),v=m.indexOf(o[0]);v>=0?d=parseInt(o[0],10):l=parseFloat(o[0])}else o.length===2&&(l=parseFloat(o[0]),d=parseInt(o[1],10));var x;if(typeof l=="number"){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,o)}}),t;typeof d>"u"&&(t._rate=l),d=t._getSoundIds(d);for(var b=0;b<d.length;b++)if(x=t._soundById(d[b]),x){t.playing(d[b])&&(x._rateSeek=t.seek(d[b]),x._playStart=t._webAudio?s.ctx.currentTime:x._playStart),x._rate=l,t._webAudio&&x._node&&x._node.bufferSource?x._node.bufferSource.playbackRate.setValueAtTime(l,s.ctx.currentTime):x._node&&(x._node.playbackRate=l);var y=t.seek(d[b]),j=(t._sprite[x._sprite][0]+t._sprite[x._sprite][1])/1e3-y,T=j*1e3/Math.abs(x._rate);(t._endTimers[d[b]]||!x._paused)&&(t._clearTimer(d[b]),t._endTimers[d[b]]=setTimeout(t._ended.bind(t,x),T)),t._emit("rate",x._id)}}else return x=t._soundById(d),x?x._rate:t._rate;return t},seek:function(){var t=this,o=arguments,l,d;if(o.length===0)t._sounds.length&&(d=t._sounds[0]._id);else if(o.length===1){var m=t._getSoundIds(),v=m.indexOf(o[0]);v>=0?d=parseInt(o[0],10):t._sounds.length&&(d=t._sounds[0]._id,l=parseFloat(o[0]))}else o.length===2&&(l=parseFloat(o[0]),d=parseInt(o[1],10));if(typeof d>"u")return 0;if(typeof l=="number"&&(t._state!=="loaded"||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,o)}}),t;var x=t._soundById(d);if(x)if(typeof l=="number"&&l>=0){var b=t.playing(d);b&&t.pause(d,!0),x._seek=l,x._ended=!1,t._clearTimer(d),!t._webAudio&&x._node&&!isNaN(x._node.duration)&&(x._node.currentTime=l);var y=function(){b&&t.play(d,!0),t._emit("seek",d)};if(b&&!t._webAudio){var j=function(){t._playLock?setTimeout(j,0):y()};setTimeout(j,0)}else y()}else if(t._webAudio){var T=t.playing(d)?s.ctx.currentTime-x._playStart:0,S=x._rateSeek?x._rateSeek-x._seek:0;return x._seek+(S+T*Math.abs(x._rate))}else return x._node.currentTime;return t},playing:function(t){var o=this;if(typeof t=="number"){var l=o._soundById(t);return l?!l._paused:!1}for(var d=0;d<o._sounds.length;d++)if(!o._sounds[d]._paused)return!0;return!1},duration:function(t){var o=this,l=o._duration,d=o._soundById(t);return d&&(l=o._sprite[d._sprite][1]/1e3),l},state:function(){return this._state},unload:function(){for(var t=this,o=t._sounds,l=0;l<o.length;l++)o[l]._paused||t.stop(o[l]._id),t._webAudio||(t._clearSound(o[l]._node),o[l]._node.removeEventListener("error",o[l]._errorFn,!1),o[l]._node.removeEventListener(s._canPlayEvent,o[l]._loadFn,!1),o[l]._node.removeEventListener("ended",o[l]._endFn,!1),s._releaseHtml5Audio(o[l]._node)),delete o[l]._node,t._clearTimer(o[l]._id);var d=s._howls.indexOf(t);d>=0&&s._howls.splice(d,1);var m=!0;for(l=0;l<s._howls.length;l++)if(s._howls[l]._src===t._src||t._src.indexOf(s._howls[l]._src)>=0){m=!1;break}return c&&m&&delete c[t._src],s.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,o,l,d){var m=this,v=m["_on"+t];return typeof o=="function"&&v.push(d?{id:l,fn:o,once:d}:{id:l,fn:o}),m},off:function(t,o,l){var d=this,m=d["_on"+t],v=0;if(typeof o=="number"&&(l=o,o=null),o||l)for(v=0;v<m.length;v++){var x=l===m[v].id;if(o===m[v].fn&&x||!o&&x){m.splice(v,1);break}}else if(t)d["_on"+t]=[];else{var b=Object.keys(d);for(v=0;v<b.length;v++)b[v].indexOf("_on")===0&&Array.isArray(d[b[v]])&&(d[b[v]]=[])}return d},once:function(t,o,l){var d=this;return d.on(t,o,l,1),d},_emit:function(t,o,l){for(var d=this,m=d["_on"+t],v=m.length-1;v>=0;v--)(!m[v].id||m[v].id===o||t==="load")&&(setTimeout((function(x){x.call(this,o,l)}).bind(d,m[v].fn),0),m[v].once&&d.off(t,m[v].fn,m[v].id));return d._loadQueue(t),d},_loadQueue:function(t){var o=this;if(o._queue.length>0){var l=o._queue[0];l.event===t&&(o._queue.shift(),o._loadQueue()),t||l.action()}return o},_ended:function(t){var o=this,l=t._sprite;if(!o._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(o._ended.bind(o,t),100),o;var d=!!(t._loop||o._sprite[l][2]);if(o._emit("end",t._id),!o._webAudio&&d&&o.stop(t._id,!0).play(t._id),o._webAudio&&d){o._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=s.ctx.currentTime;var m=(t._stop-t._start)*1e3/Math.abs(t._rate);o._endTimers[t._id]=setTimeout(o._ended.bind(o,t),m)}return o._webAudio&&!d&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,o._clearTimer(t._id),o._cleanBuffer(t._node),s._autoSuspend()),!o._webAudio&&!d&&o.stop(t._id,!0),o},_clearTimer:function(t){var o=this;if(o._endTimers[t]){if(typeof o._endTimers[t]!="function")clearTimeout(o._endTimers[t]);else{var l=o._soundById(t);l&&l._node&&l._node.removeEventListener("ended",o._endTimers[t],!1)}delete o._endTimers[t]}return o},_soundById:function(t){for(var o=this,l=0;l<o._sounds.length;l++)if(t===o._sounds[l]._id)return o._sounds[l];return null},_inactiveSound:function(){var t=this;t._drain();for(var o=0;o<t._sounds.length;o++)if(t._sounds[o]._ended)return t._sounds[o].reset();return new i(t)},_drain:function(){var t=this,o=t._pool,l=0,d=0;if(!(t._sounds.length<o)){for(d=0;d<t._sounds.length;d++)t._sounds[d]._ended&&l++;for(d=t._sounds.length-1;d>=0;d--){if(l<=o)return;t._sounds[d]._ended&&(t._webAudio&&t._sounds[d]._node&&t._sounds[d]._node.disconnect(0),t._sounds.splice(d,1),l--)}}},_getSoundIds:function(t){var o=this;if(typeof t>"u"){for(var l=[],d=0;d<o._sounds.length;d++)l.push(o._sounds[d]._id);return l}else return[t]},_refreshBuffer:function(t){var o=this;return t._node.bufferSource=s.ctx.createBufferSource(),t._node.bufferSource.buffer=c[o._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,s.ctx.currentTime),o},_cleanBuffer:function(t){var o=this,l=s._navigator&&s._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return o;if(s._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),l))try{t.bufferSource.buffer=s._scratchBuffer}catch{}return t.bufferSource=null,o},_clearSound:function(t){var o=/MSIE |Trident\//.test(s._navigator&&s._navigator.userAgent);o||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(t){this._parent=t,this.init()};i.prototype={init:function(){var t=this,o=t._parent;return t._muted=o._muted,t._loop=o._loop,t._volume=o._volume,t._rate=o._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++s._counter,o._sounds.push(t),t.create(),t},create:function(){var t=this,o=t._parent,l=s._muted||t._muted||t._parent._muted?0:t._volume;return o._webAudio?(t._node=typeof s.ctx.createGain>"u"?s.ctx.createGainNode():s.ctx.createGain(),t._node.gain.setValueAtTime(l,s.ctx.currentTime),t._node.paused=!0,t._node.connect(s.masterGain)):s.noAudio||(t._node=s._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(s._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=o._src,t._node.preload=o._preload===!0?"auto":o._preload,t._node.volume=l*s.volume(),t._node.load()),t},reset:function(){var t=this,o=t._parent;return t._muted=o._muted,t._loop=o._loop,t._volume=o._volume,t._rate=o._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++s._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,o=t._parent;o._duration=Math.ceil(t._node.duration*10)/10,Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue()),t._node.removeEventListener(s._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,o=t._parent;o._duration===1/0&&(o._duration=Math.ceil(t._node.duration*10)/10,o._sprite.__default[1]===1/0&&(o._sprite.__default[1]=o._duration*1e3),o._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var c={},u=function(t){var o=t._src;if(c[o]){t._duration=c[o].duration,h(t);return}if(/^data:[^;]+;base64,/.test(o)){for(var l=atob(o.split(",")[1]),d=new Uint8Array(l.length),m=0;m<l.length;++m)d[m]=l.charCodeAt(m);f(d.buffer,t)}else{var v=new XMLHttpRequest;v.open(t._xhr.method,o,!0),v.withCredentials=t._xhr.withCredentials,v.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(x){v.setRequestHeader(x,t._xhr.headers[x])}),v.onload=function(){var x=(v.status+"")[0];if(x!=="0"&&x!=="2"&&x!=="3"){t._emit("loaderror",null,"Failed loading audio file with status: "+v.status+".");return}f(v.response,t)},v.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete c[o],t.load())},p(v)}},p=function(t){try{t.send()}catch{t.onerror()}},f=function(t,o){var l=function(){o._emit("loaderror",null,"Decoding audio data failed.")},d=function(m){m&&o._sounds.length>0?(c[o._src]=m,h(o,m)):l()};typeof Promise<"u"&&s.ctx.decodeAudioData.length===1?s.ctx.decodeAudioData(t).then(d).catch(l):s.ctx.decodeAudioData(t,d,l)},h=function(t,o){o&&!t._duration&&(t._duration=o.duration),Object.keys(t._sprite).length===0&&(t._sprite={__default:[0,t._duration*1e3]}),t._state!=="loaded"&&(t._state="loaded",t._emit("load"),t._loadQueue())},g=function(){if(s.usingWebAudio){try{typeof AudioContext<"u"?s.ctx=new AudioContext:typeof webkitAudioContext<"u"?s.ctx=new webkitAudioContext:s.usingWebAudio=!1}catch{s.usingWebAudio=!1}s.ctx||(s.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(s._navigator&&s._navigator.platform),o=s._navigator&&s._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),l=o?parseInt(o[1],10):null;if(t&&l&&l<9){var d=/safari/.test(s._navigator&&s._navigator.userAgent.toLowerCase());s._navigator&&!d&&(s.usingWebAudio=!1)}s.usingWebAudio&&(s.masterGain=typeof s.ctx.createGain>"u"?s.ctx.createGainNode():s.ctx.createGain(),s.masterGain.gain.setValueAtTime(s._muted?0:s._volume,s.ctx.currentTime),s.masterGain.connect(s.ctx.destination)),s._setup()}};a.Howler=s,a.Howl=n,typeof Jt<"u"?(Jt.HowlerGlobal=r,Jt.Howler=s,Jt.Howl=n,Jt.Sound=i):typeof window<"u"&&(window.HowlerGlobal=r,window.Howler=s,window.Howl=n,window.Sound=i)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(s){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var i=n._howls.length-1;i>=0;i--)n._howls[i].stereo(s);return n},HowlerGlobal.prototype.pos=function(s,n,i){var c=this;if(!c.ctx||!c.ctx.listener)return c;if(n=typeof n!="number"?c._pos[1]:n,i=typeof i!="number"?c._pos[2]:i,typeof s=="number")c._pos=[s,n,i],typeof c.ctx.listener.positionX<"u"?(c.ctx.listener.positionX.setTargetAtTime(c._pos[0],Howler.ctx.currentTime,.1),c.ctx.listener.positionY.setTargetAtTime(c._pos[1],Howler.ctx.currentTime,.1),c.ctx.listener.positionZ.setTargetAtTime(c._pos[2],Howler.ctx.currentTime,.1)):c.ctx.listener.setPosition(c._pos[0],c._pos[1],c._pos[2]);else return c._pos;return c},HowlerGlobal.prototype.orientation=function(s,n,i,c,u,p){var f=this;if(!f.ctx||!f.ctx.listener)return f;var h=f._orientation;if(n=typeof n!="number"?h[1]:n,i=typeof i!="number"?h[2]:i,c=typeof c!="number"?h[3]:c,u=typeof u!="number"?h[4]:u,p=typeof p!="number"?h[5]:p,typeof s=="number")f._orientation=[s,n,i,c,u,p],typeof f.ctx.listener.forwardX<"u"?(f.ctx.listener.forwardX.setTargetAtTime(s,Howler.ctx.currentTime,.1),f.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),f.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),f.ctx.listener.upX.setTargetAtTime(c,Howler.ctx.currentTime,.1),f.ctx.listener.upY.setTargetAtTime(u,Howler.ctx.currentTime,.1),f.ctx.listener.upZ.setTargetAtTime(p,Howler.ctx.currentTime,.1)):f.ctx.listener.setOrientation(s,n,i,c,u,p);else return h;return f},Howl.prototype.init=function(s){return function(n){var i=this;return i._orientation=n.orientation||[1,0,0],i._stereo=n.stereo||null,i._pos=n.pos||null,i._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},i._onstereo=n.onstereo?[{fn:n.onstereo}]:[],i._onpos=n.onpos?[{fn:n.onpos}]:[],i._onorientation=n.onorientation?[{fn:n.onorientation}]:[],s.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(s,n){var i=this;if(!i._webAudio)return i;if(i._state!=="loaded")return i._queue.push({event:"stereo",action:function(){i.stereo(s,n)}}),i;var c=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof s=="number")i._stereo=s,i._pos=[s,0,0];else return i._stereo;for(var u=i._getSoundIds(n),p=0;p<u.length;p++){var f=i._soundById(u[p]);if(f)if(typeof s=="number")f._stereo=s,f._pos=[s,0,0],f._node&&(f._pannerAttr.panningModel="equalpower",(!f._panner||!f._panner.pan)&&r(f,c),c==="spatial"?typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(s,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):f._panner.setPosition(s,0,0):f._panner.pan.setValueAtTime(s,Howler.ctx.currentTime)),i._emit("stereo",f._id);else return f._stereo}return i},Howl.prototype.pos=function(s,n,i,c){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"pos",action:function(){u.pos(s,n,i,c)}}),u;if(n=typeof n!="number"?0:n,i=typeof i!="number"?-.5:i,typeof c>"u")if(typeof s=="number")u._pos=[s,n,i];else return u._pos;for(var p=u._getSoundIds(c),f=0;f<p.length;f++){var h=u._soundById(p[f]);if(h)if(typeof s=="number")h._pos=[s,n,i],h._node&&((!h._panner||h._panner.pan)&&r(h,"spatial"),typeof h._panner.positionX<"u"?(h._panner.positionX.setValueAtTime(s,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):h._panner.setPosition(s,n,i)),u._emit("pos",h._id);else return h._pos}return u},Howl.prototype.orientation=function(s,n,i,c){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"orientation",action:function(){u.orientation(s,n,i,c)}}),u;if(n=typeof n!="number"?u._orientation[1]:n,i=typeof i!="number"?u._orientation[2]:i,typeof c>"u")if(typeof s=="number")u._orientation=[s,n,i];else return u._orientation;for(var p=u._getSoundIds(c),f=0;f<p.length;f++){var h=u._soundById(p[f]);if(h)if(typeof s=="number")h._orientation=[s,n,i],h._node&&(h._panner||(h._pos||(h._pos=u._pos||[0,0,-.5]),r(h,"spatial")),typeof h._panner.orientationX<"u"?(h._panner.orientationX.setValueAtTime(s,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):h._panner.setOrientation(s,n,i)),u._emit("orientation",h._id);else return h._orientation}return u},Howl.prototype.pannerAttr=function(){var s=this,n=arguments,i,c,u;if(!s._webAudio)return s;if(n.length===0)return s._pannerAttr;if(n.length===1)if(typeof n[0]=="object")i=n[0],typeof c>"u"&&(i.pannerAttr||(i.pannerAttr={coneInnerAngle:i.coneInnerAngle,coneOuterAngle:i.coneOuterAngle,coneOuterGain:i.coneOuterGain,distanceModel:i.distanceModel,maxDistance:i.maxDistance,refDistance:i.refDistance,rolloffFactor:i.rolloffFactor,panningModel:i.panningModel}),s._pannerAttr={coneInnerAngle:typeof i.pannerAttr.coneInnerAngle<"u"?i.pannerAttr.coneInnerAngle:s._coneInnerAngle,coneOuterAngle:typeof i.pannerAttr.coneOuterAngle<"u"?i.pannerAttr.coneOuterAngle:s._coneOuterAngle,coneOuterGain:typeof i.pannerAttr.coneOuterGain<"u"?i.pannerAttr.coneOuterGain:s._coneOuterGain,distanceModel:typeof i.pannerAttr.distanceModel<"u"?i.pannerAttr.distanceModel:s._distanceModel,maxDistance:typeof i.pannerAttr.maxDistance<"u"?i.pannerAttr.maxDistance:s._maxDistance,refDistance:typeof i.pannerAttr.refDistance<"u"?i.pannerAttr.refDistance:s._refDistance,rolloffFactor:typeof i.pannerAttr.rolloffFactor<"u"?i.pannerAttr.rolloffFactor:s._rolloffFactor,panningModel:typeof i.pannerAttr.panningModel<"u"?i.pannerAttr.panningModel:s._panningModel});else return u=s._soundById(parseInt(n[0],10)),u?u._pannerAttr:s._pannerAttr;else n.length===2&&(i=n[0],c=parseInt(n[1],10));for(var p=s._getSoundIds(c),f=0;f<p.length;f++)if(u=s._soundById(p[f]),u){var h=u._pannerAttr;h={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:h.coneOuterAngle,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:h.coneOuterGain,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:h.distanceModel,maxDistance:typeof i.maxDistance<"u"?i.maxDistance:h.maxDistance,refDistance:typeof i.refDistance<"u"?i.refDistance:h.refDistance,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:h.rolloffFactor,panningModel:typeof i.panningModel<"u"?i.panningModel:h.panningModel};var g=u._panner;g||(u._pos||(u._pos=s._pos||[0,0,-.5]),r(u,"spatial"),g=u._panner),g.coneInnerAngle=h.coneInnerAngle,g.coneOuterAngle=h.coneOuterAngle,g.coneOuterGain=h.coneOuterGain,g.distanceModel=h.distanceModel,g.maxDistance=h.maxDistance,g.refDistance=h.refDistance,g.rolloffFactor=h.rolloffFactor,g.panningModel=h.panningModel}return s},Sound.prototype.init=function(s){return function(){var n=this,i=n._parent;n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,s.call(this),n._stereo?i.stereo(n._stereo):n._pos&&i.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(s){return function(){var n=this,i=n._parent;return n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,n._stereo?i.stereo(n._stereo):n._pos?i.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,i._refreshBuffer(n)),s.call(this)}}(Sound.prototype.reset);var r=function(s,n){n=n||"spatial",n==="spatial"?(s._panner=Howler.ctx.createPanner(),s._panner.coneInnerAngle=s._pannerAttr.coneInnerAngle,s._panner.coneOuterAngle=s._pannerAttr.coneOuterAngle,s._panner.coneOuterGain=s._pannerAttr.coneOuterGain,s._panner.distanceModel=s._pannerAttr.distanceModel,s._panner.maxDistance=s._pannerAttr.maxDistance,s._panner.refDistance=s._pannerAttr.refDistance,s._panner.rolloffFactor=s._pannerAttr.rolloffFactor,s._panner.panningModel=s._pannerAttr.panningModel,typeof s._panner.positionX<"u"?(s._panner.positionX.setValueAtTime(s._pos[0],Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(s._pos[1],Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(s._pos[2],Howler.ctx.currentTime)):s._panner.setPosition(s._pos[0],s._pos[1],s._pos[2]),typeof s._panner.orientationX<"u"?(s._panner.orientationX.setValueAtTime(s._orientation[0],Howler.ctx.currentTime),s._panner.orientationY.setValueAtTime(s._orientation[1],Howler.ctx.currentTime),s._panner.orientationZ.setValueAtTime(s._orientation[2],Howler.ctx.currentTime)):s._panner.setOrientation(s._orientation[0],s._orientation[1],s._orientation[2])):(s._panner=Howler.ctx.createStereoPanner(),s._panner.pan.setValueAtTime(s._stereo,Howler.ctx.currentTime)),s._panner.connect(s._node),s._paused||s._parent.pause(s._id,!0).play(s._id,!0)}})()})(Mt);const Be=Object.fromEntries(Object.keys(on.sprite).map(a=>[a.toUpperCase(),a])),mc=()=>{const a=jn(),r=Ks(p=>p.volume),s=Ks(p=>p.isMuted),n=Ks(p=>p.layers),i=Gr(p=>p.register),c=ee(p=>p.setPlayAudioNotif),u=_.useRef({[xs.BGM]:null,[xs.SFX]:null,[xs.NOTIF]:null});_.useEffect(()=>{Mt.Howler.volume(r/100)},[r]),_.useEffect(()=>{Mt.Howler.mute(s)},[s]),_.useEffect(()=>{Object.values(xs).forEach(p=>{var f,h;(f=u.current[p])==null||f.volume(n[p].volume/100),(h=u.current[p])==null||h.mute(n[p].isMuted)})},[n]),_.useEffect(()=>{if(a===null||a!==jt)return;u.current.bgm=new Mt.Howl({src:[dc],html5:!0,loop:!0,volume:n.bgm.volume/100,mute:n.bgm.isMuted});const p=u.current.bgm,f=()=>{p.play(),document.body.removeEventListener("click",f)};return document.body.addEventListener("click",f),()=>{document.body.removeEventListener("click",f),p.unload()}},[a]),_.useEffect(()=>{u.current.sfx=new Mt.Howl({src:[dr],sprite:on.sprite,volume:n.sfx.volume/100,mute:n.sfx.isMuted});const p=u.current.sfx,f=Hr(ae.getState().role),h=i(async g=>{switch(g.type){case ge.END_TURN:{g.player!==f&&p.play(Be["YOUR-TURN"]);break}case ge.CREATE_PERMANENT:{p.play(Be["STEP-SUMMON"]);break}case ge.ADD_GEMS:{p.play(Be["STEP-ADD-GEMS"]);break}case ge.REMOVE_PERMANENT:{p.play(Be["STEP-REMOVE-PERMANENT"]);break}case ge.MOVE:case ge.SWAP:{p.play(Be["STEP-MOVE"]);break}case ge.DAMAGE_PERMANENT:{g.damage>0?p.play(Be["STEP-DAMAGE-PERMANENT"]):g.damage<0&&p.play(Be["STEP-HEAL"]);break}}});return()=>{h(),p.unload()}},[i]),_.useEffect(()=>{u.current.notif=new Mt.Howl({src:[dr],sprite:on.sprite,volume:n.notif.volume/100,mute:n.notif.isMuted});const p=u.current.notif;return c(f=>{switch(f.type!==it.VICTORY&&f.type!==it.UNLOCK&&p.stop(),f.type){case it.PVP_REQUEST_ACCEPTED:{p.play(Be["NOTIF-TRUMPETS-2"]);break}case it.PVP_REQUEST_RECEIVED:{p.play(Be["NOTIF-TRUMPETS-1"]);break}case it.HINT_ANSWERED:{p.play(Be["NOTIF-BELLS"]);break}case it.ERRATUM:{p.play(Be["NOTIF-BELLS"]);break}case it.UNLOCK:{p.play(Be["NOTIF-CAVE"]);break}case it.SOLVE:{p.play(Be["NOTIF-CLAPS"]);break}case it.VICTORY:{p.play(Be.CHEER);break}}}),()=>{c(null),p.unload()}},[])};function hc(){const[a,r]=he(),s=Ee(),n=te(),{puzName:i}=Ge();if(i===void 0)throw new Error("expect puzName parameter to be defined");const c=U(),u=i===Ae;return _.useEffect(()=>{c===null||c.puzzles[i]===void 0||s({pathname:u?"../mastery":`../prep/${i}`,search:a.toString()},{replace:!0})},[i,c,s,a,u]),_.useEffect(()=>n.onErrorEvent.addListener(p=>{s({pathname:"../",search:a.toString()},{replace:!0})}),[n,s,a]),e.jsx(Oe,{size:128})}function qs({restart:a}){const[r,s]=he(),n=Ee(),i=te(),{puzName:c,slot:u}=Ge();if(c===void 0)throw new Error("expect puzName parameter to be defined");const p=qt(c),f=p===null?null:p===Ke.ACTIVE,h=U(),g=ds(),t=h!==null&&h.puzzles[c]!==void 0;return _.useEffect(()=>{if(t)return i.addAuthEffect(()=>{i.startAIBattleAsync(c,{slot:u===void 0?void 0:parseInt(u),restart:a,devKnobs:fs()})})},[i,c,t,n,r,u,a]),_.useEffect(()=>{if(f===null||!f||g===null)return;const{isCutscene:o=!1}=g;n({pathname:`../${o?"cutscene":"battle"}/${c}`,search:r.toString()},{replace:!0})},[f,n,c,r,g]),_.useEffect(()=>i.onErrorEvent.addListener(o=>{n({pathname:`../prep/${c}`,search:r.toString()},{replace:!0})}),[i,n,c,r]),e.jsx(Oe,{size:128})}function fc(){const[a,r]=he(),s=Ee(),n=te(),i=U();return _.useEffect(()=>{if(i===null)return;const c=i.puzzles[Os];(c==null?void 0:c.solveTime)!==void 0&&(window.location.href=`${B.djangoBaseUrl}victory`)},[i]),_.useEffect(()=>n.onErrorEvent.addListener(c=>{s({pathname:"../",search:a.toString()},{replace:!0})}),[n,s,a]),e.jsx(Oe,{size:128})}function pc(){const a=mt(),r=Te(h=>h.setSubscribedTeamDecksTeamId),s=Te(h=>h.setSubscribedTeamBattle),n=Pe(),{canSelectDeck:i}=ht(je.P1),c=Ee(),[u]=he();U(),ds(),Ko();const p=yn(),f=En();return _.useEffect(()=>{a!==null&&r(a)},[a,r]),_.useEffect(()=>{a!==null&&p&&s({teamId:a,puzName:n})},[s,n,a,p]),_.useEffect(()=>{f===null||i===null||(f||!i)&&(wr.error(`Invalid battle "${n}" for deckbuilding.`),c({pathname:`../prep/${n}`,search:u.toString()}))},[f,i,n,c,u]),i===null||f===null||f||!i?e.jsx(We,{}):e.jsxs(e.Fragment,{children:[e.jsx(Fs,{}),e.jsx("div",{className:"below-nav",children:e.jsxs("div",{className:"collection-root",children:[e.jsx(Ui,{}),e.jsx(Bi,{}),e.jsx(Ki,{})]})})]})}const gc=xn((a,r)=>({answerSelection:null,setAnswerSelection:s=>{a({answerSelection:s})},pendingAnswerSelection:null,setPendingAnswerSelection:s=>{a({pendingAnswerSelection:s})},hoverCell:null,setHoverCell:s=>{a({hoverCell:s})}}));function vc(){const a=U(),[r]=he();if(a===null)return e.jsx(Oe,{inline:!0});const{faction:s,factionScoreContributions:n,masteries:i}=a,c=i[xt].isEnabled??!1,u=s===null?0:n[s];return c?e.jsxs("div",{children:[s===null?e.jsx(e.Fragment,{children:e.jsx("div",{className:"no-faction-msg",children:"You're not aligned with a faction yet."})}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{}),e.jsxs("div",{children:[e.jsx("b",{children:"Your faction:"})," ",e.jsx(Ue,{faction:s})," ",wt(s)," ",e.jsx(Ue,{faction:s})]}),u===0?null:e.jsxs("div",{children:[e.jsxs("b",{children:["Total team ",e.jsx(Ue,{faction:s})," points:"]})," ",u]})]}),e.jsx($e,{to:{pathname:`/team/${encodeURIComponent(encodeURIComponent(a.displayName))}`,search:r.toString()},children:e.jsx("button",{className:"change-faction-btn",children:s===null?"Choose a faction!":"Change faction alignment"})})]}):null}function ur(){var we,A;const{djangoBaseUrl:a}=B,[r]=he(),[s,n]=_.useState(!1),{answerSelection:i,setAnswerSelection:c,pendingAnswerSelection:u,setPendingAnswerSelection:p,hoverCell:f,setHoverCell:h}=gc(),g=Wt(z=>z.getServerInterfaceController)(),t=mt(),o=Wo(),l=K(z=>z.selectedMasteryId),d=K(z=>z.setSelectedMasteryId),m=K(z=>z.setHoveredMasteryId),v=K(z=>z.setNavIsMasteryTreePage),x=K(z=>z.setIsMasteryUnlockModalOpen);ae(z=>z.setSendStep);const{puzName:b}=Ge(),y=pn(),j=bt(z=>z.isSpectating),T=U(),S=_.useCallback(z=>{g!==null&&g.sendReq({type:G.MASTERY_TREE_STEP,step:z})},[g]);if(_.useEffect(()=>(v(!0),()=>{v(!1)}),[v]),_.useEffect(()=>{if(g!==null&&!j)return g.addAuthEffect(()=>{g.sendReq({type:G.VIEW_PUZZLE,puzName:Ae})})},[g,j]),_.useEffect(()=>{if(t!==null&&g!==null)return g.addSubscribeEffect({type:Pt.TEAM_MASTERY_TREE,teamId:t})},[g,t]),_.useEffect(()=>()=>{c(null),m(null)},[c,m]),_.useEffect(()=>{i!==null&&o!==null&&o.placements[i.answer]!==void 0&&c(null)},[i,c,o]),_.useEffect(()=>{if(o!==null&&u!==null){if(i!==null){p(null);return}o.placements[u.answer]===void 0&&(c(u),p(null))}},[i,c,u,p,o]),Se("r",()=>{i!==null&&c({...i,orientation:(()=>{switch(i.orientation){case vt.HORIZONTAL:return vt.VERTICAL;case vt.VERTICAL:return vt.HORIZONTAL}})()})}),Se("esc",()=>{c(null)}),B.isPublicAccess){const{djangoBaseUrl:z}=B;return e.jsxs("div",{className:"below-nav public-access-not-supported",children:[e.jsx("h2",{children:"Mastery Tree"}),e.jsx("div",{className:"public-access-not-supported-message",children:"The mastery tree is not yet supported in public access. You may still access the solution and stats pages. Please create or use an existing account to gain access to puzzle content."}),e.jsxs("div",{className:"public-access-not-supported-buttons",children:[e.jsx("a",{href:`${z}post-hunt-solve/mastery_tree`,children:e.jsx("button",{children:"Check your answer spoiler-free"})}),e.jsx("a",{href:`${z}solution/mastery_tree`,children:e.jsx("button",{children:"View solution"})}),e.jsx("a",{href:`${z}stats/mastery_tree`,children:e.jsx("button",{children:"Stats"})})]})]})}if(T===null||o===null||y===null)return e.jsx(Oe,{size:128});const{faction:w,puzzles:P,battleGroups:E,masteries:C,hintsInfo:R}=T,M=((we=P[Ae])==null?void 0:we.solveTime)!==void 0,{numHintsUsed:L,numHintsTotal:D}=R,I=D-L,X=Object.values(P).flatMap(({puzName:z,battleGroupName:N,answer:Q})=>E[N]===void 0||z===Ae||Q===void 0||Q===""?[]:[Q]);X.sort();const Y=Object.values(C).filter(({isEnabled:z})=>z),{puzPrompt:q}=P[wn]??{};Object.keys(C).sort().map(z=>Y.some(({masteryId:N})=>z===N)?"1":"0").join("");const ce=(z,N)=>{var Q;return((Q=Object.values(C).find(oe=>z===oe.x&&N===oe.y))==null?void 0:Q.masteryId)??null},J=f===null||i!==null?null:ce(f.x,f.y),F=f===null||i!==null||J!==null?null:Object.values(o.placements).reverse().find(z=>bs(z,f.x,f.y)!==null)??null,fe=i===null||f===null?null:{answer:i.answer,x:f.x,y:f.y,orientation:i.orientation},se=X.map(z=>{const N=Yo(z),Q=!!o.placements[N],oe=Q?(()=>{const k=F!==null&&F.answer===N;return e.jsx("button",{className:`mastery-tree-answer-button${k?" highlight":""}`,onClick:()=>{S==null||S({type:ys.DELETE,answer:N})},children:"Delete"})})():[vt.HORIZONTAL,vt.VERTICAL].map(k=>{const O=i!==null&&i.answer===N&&i.orientation===k;return e.jsx("button",{className:`mastery-tree-answer-button${O?" highlight":""}`,disabled:Q,onClick:H=>{if(O){c(null);return}c({answer:N,orientation:k}),H.stopPropagation()},children:{[vt.HORIZONTAL]:"Horz",[vt.VERTICAL]:"Vert"}[k]},k)});return e.jsxs("div",{className:"mastery-tree-answer",children:[e.jsx("div",{className:"mastery-tree-answer-label",children:z}),oe]},N)}),ne=Vo(o),pe=(()=>{if(ne===null)return e.jsx("div",{className:"mastery-tree-error",children:"Oops! Looks like your mastery tree got into an invalid state. Use the buttons on the left to reset the mastery tree or delete answers from it to regain access to the mastery tree."});const z=[];for(let N=0;N<Et;N++){const Q=[];for(let oe=0;oe<Tt;oe++){const k=ne[N][oe],O=Object.values(o.placements).find(qe=>bs(qe,oe,N)!==null)??null,H=O!==null&&o.connectedAnswers.includes(O.answer),ue=fe===null?null:bs(fe,oe,N),be=fe===null||ue===null?null:fe.answer[ue],Ze=(()=>fe===null||ue===null?!1:!qo(ne,fe,ue))(),Ne=ce(oe,N),tt=Ne!==null&&J!==null&&Ne===J,ft=F!==null&&bs(F,oe,N)!==null,_t=oe===Zo&&N===Xo,Xe=Ne!==null&&l!==null&&Ne===l,Rt=Ze?" invalid":_t?" tree-root":tt?" hovered-mastery":Ne!==null?" mastery-target":ft?" hovered-answer":H?" connected":"",Z=tt||ft,pt=be??k;Q.push(e.jsx("div",{className:`mastery-tree-cell${Rt}${Xe?" selected-mastery":""}${Z?" clickable":""}`,style:{width:`max(${100/Tt}cqw, 1em)`,height:`max(${100/Et}cqh, 1em)`},onMouseEnter:()=>{h({x:oe,y:N}),Ne!==null&&m(Ne)},onMouseLeave:()=>{m(null)},onClick:qe=>{if(fe!==null){S==null||S({type:ys.PLACE,placement:fe}),qe.stopPropagation();return}if(Ne!==null){d(Ne);return}if(F!==null){S==null||S({type:ys.DELETE,answer:F.answer}),p({answer:F.answer,orientation:F.orientation});return}},children:e.jsx("div",{className:"mastery-tree-cell-char",children:pt})},oe))}z.push(e.jsx("div",{className:"mastery-tree-row",style:{width:`max(100cqw, ${Tt}em)`,height:`max(${100/Et}cqh, 1em)`},children:Q},N))}return z})(),_e=Object.values(C).filter(({isEnabled:z})=>z).length,de=Object.keys(C).length,Re=e.jsxs(e.Fragment,{children:[q===void 0?e.jsxs(e.Fragment,{children:[e.jsxs("h5",{children:["Masteries activated: ",_e," / ",de]}),e.jsxs("div",{children:["Activate all ",de," masteries to proceed."]}),(A=T.puzzles[zn])!=null&&A.solveTime?e.jsx($e,{to:{pathname:`../prep/${zn}`,search:r.toString()},children:e.jsxs("button",{className:"mastery-tree-cutscene-btn",children:[e.jsx("div",{children:"Replay cutscene"}),e.jsx("div",{children:"(Your first ANSWER)"})]})}):null]}):e.jsxs(e.Fragment,{children:[e.jsxs("h5",{children:[q.header,M?e.jsxs("div",{className:"solved-title-marker",style:{fontSize:"0.8em"},children:["Solved!"," ",e.jsx("span",{className:"solved-title-answer",children:P[Ae].answer})]}):null]}),e.jsx("div",{children:q.text})]}),q!==void 0||B.isPosthunt||y?e.jsxs("div",{className:"mastery-next-buttons",children:[q!==void 0?e.jsxs(e.Fragment,{children:[M?B.isPosthunt?null:e.jsx("a",{href:`${a}solve/${Ae}`,children:e.jsx("button",{children:"Leave feedback"})}):e.jsx("a",{href:`${a}solve/${Ae}`,children:e.jsx("button",{children:"Submit answer"})}),D&&!M?e.jsx("a",{href:`${a}hints/${Ae}`,children:e.jsxs("button",{children:[I?"Get a hint":"View hints"," (",I,e.jsx(W,{tag:"span",children:"üí°"}),")"]})}):null]}):null,B.isPosthunt||y?e.jsxs("div",{className:"mastery-solution-buttons",children:[e.jsx("a",{href:`${a}solution/${Ae}`,children:e.jsx("button",{children:"Solution"})}),e.jsx("a",{href:`${a}stats/${Ae}`,children:e.jsx("button",{children:"Stats"})})]}):null]}):null]});return e.jsxs(e.Fragment,{children:[e.jsx(Fs,{puzName:Ae}),e.jsx(fa,{cursorGroupName:Ae,enabled:!0,children:e.jsx("div",{className:"below-nav",children:e.jsxs("div",{className:"mastery-tree-root",onClick:()=>{c(null)},children:[e.jsxs("div",{className:"mastery-tree-left-sidebar",children:[e.jsxs("div",{className:"mastery-tree-controls",children:[e.jsx("button",{onClick:()=>n(!0),children:"Reset"}),i===null?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("kbd",{children:"r"})," Rotate"]}),e.jsxs("div",{children:[e.jsx("kbd",{children:"Esc"})," Deselect"]})]})]}),e.jsx("div",{className:"mastery-tree-answers",children:se})]}),e.jsx("div",{className:"mastery-tree-main",children:e.jsx("div",{className:"mastery-tree-grid-panel",children:e.jsx("div",{id:"mastery-tree-grid",className:`mastery-tree-grid${i!==null?" pointer":""}`,style:{height:`max(min(100cqh, ${100/Tt*Et}cqw), ${Et}em)`,width:`max(min(100cqw, ${100/Et*Tt}cqh), ${Tt}em)`},children:pe})})}),e.jsxs("div",{className:"mastery-tree-right-sidebar",children:[e.jsx(da,{}),w===null?e.jsx(vc,{}):null,e.jsx("div",{className:"mastery-next",children:Re}),e.jsxs("div",{className:"mastery-tree-right-sidebar-buttons",children:[b===void 0?null:e.jsx($e,{to:{pathname:`../prep/${b}`,search:r.toString()},children:e.jsx("button",{children:"Back"})}),e.jsxs("div",{children:[e.jsx("b",{children:"Note to postsolvers:"})," During the hunt, progress on the mastery tree was gated behind hunt progress. If you‚Äôre just postsolving individual battles, you may force-activate masteries from the"," ",e.jsxs("a",{href:"#",onClick:()=>{x(!0)},children:[e.jsxs("b",{children:[e.jsx(W,{tag:"span",children:"üîì"})," Mastery Tree Unlocks"]})," ","panel"]}),"."]})]})]})]})})}),e.jsx(Rs,{isOpen:s,onClose:()=>n(!1),title:"Are you sure?",onConfirm:()=>{S==null||S({type:ys.RESET})},confirmLabel:"Reset",children:"This can‚Äôt be reversed."})]})}function mr(a){const{clickableId:r,displayName:s,answer:n,completionText:i,isMeta:c,isBattle:u,isCutscene:p,isLegendary:f,isNew:h,isSolved:g,mapPos:t,isAnyRoomActive:o,battleGroupName:l,hasAnswer:d,linkTargetOverride:m,stats:v,icon:x}=a,[b,y]=(()=>o?[g?"üîÅ":"‚è≥",(p?"Cutscene in progress!":"Battle in progress!")+(g?" (replay)":"")]:g?["‚úÖÔ∏è",""]:c?["‚ìÇÔ∏è","Metapuzzle"]:h&&l!==rt?["üÜï",""]:["‚ùó","‚ùì","ü§º","üï∏Ô∏è","üå≤"].includes(x??"")?[x,""]:["",""])(),j=e.jsxs(e.Fragment,{children:[e.jsx("div",{id:`clickable-${r}`,className:`map-enemy-battler${l===jt?" map-kero":l===Ae?" map-mastery-tree":l===xe?" map-pvp":""}`,style:{zIndex:l==="infinitely_many_hogs_and_logs"?0:1},children:Wr.includes(l)?e.jsx(At,{className:"map-weird-img",src:Qo(l)}):p&&l!==as?e.jsx(zt,{battleGroupName:"cutscene"}):l===bn?e.jsx(zt,{battleGroupName:"moonick-clickable"}):e.jsx(zt,{battleGroupName:l})}),e.jsxs("div",{className:"map-puz-label",children:[e.jsx(W,{children:x}),e.jsxs("div",{className:"map-puz-title",children:[e.jsx("div",{children:s}),n?e.jsx("b",{children:n}):null,i?e.jsx("b",{children:i}):null,v===void 0||l===rt?null:e.jsxs("span",{children:[v.solveCount," ",e.jsx("small",{children:v.solveCount===1?"solve":"solves"})," |"," ",v.unlockCount," ",e.jsx("small",{children:v.unlockCount===1?"unlock":"unlocks"})]})]}),e.jsx($,{text:y,children:e.jsx(W,{children:b})})]})]});return e.jsx("div",{className:"map-puz",style:{backgroundColor:"rgba(0, 255, 0, 0)",left:`${t.x}vw`,top:`${t.y}vw`},children:e.jsx(cs,{battleGroupName:l,hasAnswer:d,linkTargetOverride:m,children:j})})}function xc(a){const{displayName:r,isSolved:s,mapPos:n,isAnyRoomActive:i,windowScrollHeight:c,scrollTo:u,icon:p}=a,[f,h]=_.useState(!1);return e.jsx($,{text:f?void 0:r,placement:"right",directRef:g=>e.jsx("div",{className:`minimap-puz ${s?"solved":"unsolved"} ${i?"active":""}`,tabIndex:0,onClick:async()=>{h(!0),await u(),h(!1)},style:{left:`${(n.x-20)/60*100}%`,top:`${(n.y/100*window.innerWidth-window.innerWidth*.5)/(c-window.innerWidth*.5)*100}%`},...g,children:p})})}const bc={clickableId:as,displayName:"OPEN THE TREASURE CHEST",isNew:!1,isMeta:!1,isBattle:!1,isCutscene:!1,isLegendary:!1,isAnyRoomActive:!1,isSolved:!1,mapPos:{x:50,y:72.39819005},hasAnswer:!1,linkTargetOverride:`/game/cutscene/${as}/start`,battleGroupName:`${as}-initial`,icon:"‚ùó"};function yc({windowScrollHeight:a}){const r=_.useRef(null),s=U(),n=Yr(),i=(s==null?void 0:s.puzzles)??null,c=(s==null?void 0:s.masteries)??null,u=(s==null?void 0:s.battleGroups)??null,p=c!==null&&c[Jo].isEnabled,f=c!==null&&c[xr].isEnabled,h=i!==null&&i[wn]!==void 0,g=d=>{if(i===null)return;const{battleGroupName:m,displayName:v,isCutscene:x=!1,isLegendary:b=!1,mapPos:y,stats:j}=d;if(y===void 0||m===xe&&!f)return;const T=i[m];if(T===void 0)return;const{answer:S,hasAnswer:w=!1,isNew:P=!1,solveTime:E}=T,C=E!==void 0,R=m===Ae,M=m===xe,L=!R&&!w,D=Object.values(i).find(X=>X.battleGroupName===m&&X.roomStatus===Ke.ACTIVE)!==void 0,I=Qr(T,d);return{clickableId:m,displayName:v,answer:S,completionText:!C||S!==void 0?void 0:`${hn(d)}!`,isMeta:R&&h,isBattle:L,isCutscene:x,isLegendary:b,isNew:P,isSolved:C,mapPos:y,isAnyRoomActive:D,hasAnswer:w,battleGroupName:m,stats:p&&!x&&!M&&!(R&&!h)?j:void 0,icon:I}},t=Object.values(u??{}).map(g).filter(d=>!!d).sort((d,m)=>d.mapPos.y-m.mapPos.y),o=d=>d.mapPos.y*window.innerWidth/100-window.innerHeight/2,l=_.useCallback(async d=>{var x;const m=t.find(b=>b.clickableId===d),v=document.getElementById(`clickable-${d}`);!m||!v||(await Ii(o(m)),(x=v.parentElement)==null||x.focus())},[t]);return _.useEffect(()=>{const d=({key:m})=>{const v=j=>Math.min(o(j),document.body.scrollHeight-window.innerHeight),x={"`":j=>v(j)>window.scrollY+10,"~":j=>v(j)<window.scrollY-10}[m];if(!x)return;const b=t.filter(j=>!j.isSolved&&!Wr.includes(j.battleGroupName));if(!b.length)return;m==="~"&&b.reverse();const y=b.find(x)??b[0];l(y.clickableId)};return window.addEventListener("keypress",d),()=>window.removeEventListener("keypress",d)},[t,l]),_.useEffect(()=>{if(a===null)return;const d=()=>{r.current&&(r.current.style.top=`${(window.scrollY-window.innerWidth*.5)/(a-window.innerWidth*.5)*100}%`,r.current.style.height=`${window.innerHeight/((a??0)-window.innerWidth*.5)*100}%`)};return window.addEventListener("scroll",d,{passive:!0}),window.addEventListener("resize",d,{passive:!0}),d(),()=>{window.removeEventListener("scroll",d),window.removeEventListener("resize",d)}},[a]),_.useEffect(()=>{const d=()=>{(a??0)>window.innerHeight&&(sessionStorage.mapScroll=window.scrollY)};return window.addEventListener("scroll",d,{passive:!0}),()=>window.removeEventListener("scroll",d)},[a]),_.useLayoutEffect(()=>{window.scrollY===0&&sessionStorage.mapScroll&&(a??0)>window.innerHeight&&window.scrollTo(window.scrollX,+sessionStorage.mapScroll)},[a]),_.useEffect(()=>{const d=document.querySelector(".page-contents");if(d)return d.style.height="100%",d.style.overflow="hidden",()=>{d.style.height="",d.style.overflow=""}},[]),s===null||i===null||u===null||n===null?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"map",children:n?e.jsx(mr,{...bc}):t.map(d=>e.jsx(mr,{...d},d.clickableId))}),n||t.length<=5?null:e.jsxs("div",{className:"minimap",children:[e.jsx("div",{className:"minimap-background",children:e.jsxs("div",{className:"minimap-note",children:["press ",e.jsx("kbd",{children:"`"})," to jump!"]})}),e.jsx("div",{className:"minimap-screen",ref:r}),a===null?null:t.map(d=>e.jsx(xc,{...d,windowScrollHeight:a,scrollTo:()=>l(d.clickableId)},d.clickableId))]})]})}function jc({isTitleRevealed:a,scrollHeight:r}){if(r===null)return null;const s=window.innerWidth/2,n=i=>gr(i).slice(0,Math.ceil(r/s)).map((c,u)=>e.jsx(At,{className:"layer",src:c,style:{top:u*50+"vw"}},u));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fg",style:{height:r+"px"},children:a?n("islands"):null}),e.jsxs("div",{className:"bg",style:{height:r+"px"},children:[n("2-cave-full"),e.jsx("h1",{className:"title",children:"Galactic Puzzle Hunt 2023"}),a?e.jsx(At,{className:"gcc-new",src:Fn("galacticardcaptors.png")}):e.jsx(At,{className:"gcc",src:Fn("galacticosmicave.png")})]})]})}function _c(){const[a,r]=_.useState(null),[s,n]=_.useState(180),i=_.useRef(null),c=_.useRef(null),u=U(),p=Yr(),f=(u==null?void 0:u.puzzles)??null,h=(u==null?void 0:u.battleGroups)??null,{djangoBaseUrl:g}=B;_.useEffect(()=>{const j=c.current;if(j===null)return;const T=()=>{n(j.offsetHeight)},S=new ResizeObserver(T);return S.observe(j),T(),()=>{S.disconnect()}}),_.useEffect(()=>{if(f===null||h===null)return;const j=i.current;if(j===null)return;const T=()=>{r([...document.querySelectorAll(".map-puz")].map(w=>w.offsetTop+w.offsetHeight).reduce((w,P)=>Math.max(w,P),0)+(s??0))},S=new ResizeObserver(T);return S.observe(j),T(),()=>{S.disconnect()}},[s,f,h]);const{subscribedTeamBattle:t,setSubscribedTeamBattle:o,subscribedTeamFishPuzzle:l,setSubscribedTeamFishPuzzle:d}=Te();if(_.useEffect(()=>{u!==null&&(t!==null&&u.puzzles[t.puzName]===void 0&&o(null),l!==null&&u.puzzles[l.puzName]===void 0&&d(null))},[u,t,l,o,d]),u===null||f===null||h===null||p===null)return e.jsx(Oe,{size:128});const m=Object.values(f).filter(({puzName:j,solveTime:T})=>{var S;return T!==void 0&&(((S=h[j])==null?void 0:S.isLegendary)??!1)}).length,v=Object.values(f).filter(({puzName:j})=>{var T;return((T=h[j])==null?void 0:T.isLegendary)??!1}).length;f[jt];const x=f[ei]!==void 0,y="Local time: "+new Date("2024-01-01T11:11:00+11:00").toLocaleString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",timeZoneName:"short"});return e.jsxs(e.Fragment,{children:[e.jsx(jc,{isTitleRevealed:!p,scrollHeight:a}),e.jsxs("div",{className:"map-root",style:{height:a===null?void 0:`${a}px`},ref:i,children:[B.isPosthunt?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"map-notice",children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontWeight:"bold",color:"#f86"},children:[e.jsx(W,{tag:"span",children:"‚ö†Ô∏è"})," Note to new visitors and postsolvers:"]})," ","The ",e.jsx(Vr,{path:"/game/unlock",children:"unlock gadget"})," ","is now available. Use it to reset the website state and simulate hunt progress."]}),e.jsx("div",{children:"If you‚Äôre unfamiliar with the premise of this hunt, we highly recommend using the gadget to start the hunt from the beginning. Much of this hunt is designed to be experienced in tandem with hunt progress, rather than as independent puzzles."})]})}):null,e.jsxs("div",{className:"map-notice",children:[e.jsx("div",{children:B.isPosthunt?"Galactic Puzzle Hunt 2023 has come to a close. Thanks for puzzling with us!":e.jsxs(e.Fragment,{children:["The Galactic Puzzle Hunt is now over, but you can still register and progress through the hunt until"," ",e.jsx("time",{dateTime:"2024-01-01T11:11:00+11:00","data-format":"F j, Y \\a\\t g:i A T",title:y,children:"December 31, 2023 at 7:11 PM EST"}),"."]})}),e.jsxs("div",{children:["Please fill out our"," ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://forms.gle/rCDjii8iMwSRhv5KA",children:"feedback form"})," ","and check out our"," ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:`${g}wrapup`,children:"wrap-up"}),"!"]}),e.jsxs("div",{children:["If you enjoyed our hunt, please consider"," ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:`${g}donate`,children:"donating"}),".",e.jsx("br",{}),e.jsxs("b",{children:["If you‚Äôd like to hear from us about future events, please join our"," ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://groups.google.com/g/galacticpuzzlehunt",children:"interest list"}),"."]})]})]}),e.jsx(yc,{windowScrollHeight:(a??0)+50})]}),e.jsxs("div",{className:"map-footer",style:{top:`${(a??0)-(s??0)+1}px`},ref:c,children:[v===Js&&!x?e.jsxs("div",{className:"map-footer-text",children:[e.jsxs("div",{className:"map-footer-num-legendaries",children:[m," / ",Js," legendaries befriended."]}),e.jsx("div",{children:"Befriend all the legendaries to enter the water!"})]}):null,e.jsx("div",{className:"map-shadow"})]})]})}const Sc=a=>{const{teamId:r,puzName:s,displayName:n,isSolved:i,isUnlocked:c,answer:u}=a;_.useRef(null);const p=te(),f=n;return e.jsxs("div",{className:"admin-puz",children:[e.jsxs("div",{className:"admin-puz-label",children:[f,u===void 0?null:` (${u})`]}),e.jsx("div",{children:e.jsx("button",{disabled:i||!c,onClick:()=>{p.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideSolved:{[s]:!0}}}})},children:"Set solved"})}),e.jsx("div",{children:e.jsx("button",{disabled:!i,onClick:()=>{p.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideSolved:{[s]:!1}}}})},children:"Set unsolved"})}),e.jsx("div",{className:"admin-puz-spacer"}),e.jsx("div",{children:e.jsx("button",{disabled:c,onClick:()=>{p.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideUnlocked:{[s]:!0}}}})},children:"Set unlocked"})}),e.jsx("div",{children:e.jsx("button",{disabled:!c,onClick:()=>{p.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideUnlocked:{[s]:!1}}}})},children:"Set locked"})}),e.jsx("div",{children:"(dev only)"})]},s)},kc=a=>{const{teamId:r,cardName:s,displayName:n,isUnlocked:i}=a,c=te();return e.jsxs("div",{className:"admin-puz",children:[e.jsx("div",{className:"admin-puz-label",children:n}),e.jsx("div",{children:e.jsx("button",{disabled:i,onClick:()=>{c.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideCardUnlocked:{[s]:!0}}}})},children:"Set unlocked"})}),e.jsx("div",{children:e.jsx("button",{disabled:!i,onClick:()=>{c.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideCardUnlocked:{[s]:!1}}}})},children:"Set locked"})}),e.jsx("div",{children:"(dev only)"})]},s)};function Tc(){const[a,r]=_.useState(""),{subscribedTeamId:s}=Te(),n=ee(j=>j.globalState.teamAdminData),i=ee(j=>j.globalState.puzzles),c=ee(j=>j.globalState.battleGroups),u=U(s),p=ze(j=>j.cardsDB),f=te(),h=u===null||n[u.teamId]===void 0?"":n[u.teamId].displayName;if(_.useEffect(()=>{h!==null&&r(h)},[h,r]),u===null||Object.keys(i).length===0||n[u.teamId]===void 0||h===null)return e.jsx(We,{});const{teamId:g,puzzles:t,cardUnlocks:o}=u,{isHidden:l,isInactive:d,isTempBlocked:m}=n[g],v=zs(i,c),x=Object.values(i).sort((j,T)=>j.order-T.order).map(({puzName:j,battleGroupName:T})=>{const S=t[j],w=v[j],P=c[T].displayName,E=w===0?P:`${P}, Stage ${w}`;return e.jsx(Sc,{teamId:g,puzName:j,displayName:E,isSolved:(S==null?void 0:S.solveTime)!==void 0,isUnlocked:S!==void 0,answer:S==null?void 0:S.answer},j)}),b=Object.keys(p).filter(j=>p[j].cardUnlockGroupId!==null).sort().map(j=>e.jsx(kc,{teamId:g,cardName:j,displayName:p[j].displayName,isUnlocked:o[j]!==void 0},j)),y=()=>{a!==h&&f.sendReq({type:G.ADMIN_MODIFY,teams:{[g]:{displayName:a}}})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"admin-header",children:[e.jsxs("div",{className:"admin-selected-team-name",children:[e.jsx("div",{className:"admin-selected-team-name-label",children:"Team name:"}),e.jsx("div",{children:e.jsx("input",{className:"admin-team-name-input",type:"text",value:a,onChange:j=>{r(j.target.value)},onBlur:()=>{y()},onKeyPress:j=>{j.key==="Enter"&&y()}})})]}),e.jsxs("div",{className:"admin-header-checkboxes",children:[e.jsxs("div",{className:"admin-checkbox-control",children:[e.jsx("input",{type:"checkbox",id:"is-team-hidden-checkbox",defaultChecked:l,onChange:j=>{f.sendReq({type:G.ADMIN_MODIFY,teams:{[g]:{isHidden:j.target.checked}}})}})," ",e.jsx("label",{htmlFor:"is-team-hidden-checkbox",children:"Is Hidden"})]}),e.jsxs("div",{className:"admin-checkbox-control",children:[e.jsx("input",{type:"checkbox",id:"is-team-inactive-checkbox",defaultChecked:d,onChange:j=>{f.sendReq({type:G.ADMIN_MODIFY,teams:{[g]:{isInactive:j.target.checked}}})}})," ",e.jsx("label",{htmlFor:"is-team-inactive-checkbox",children:"Is Inactive"})]}),e.jsxs("div",{className:"admin-checkbox-control",children:[e.jsx("input",{type:"checkbox",id:"is-team-temporarily-blocked-checkbox",defaultChecked:m,onChange:j=>{f.sendReq({type:G.ADMIN_MODIFY,teams:{[g]:{isTempBlocked:j.target.checked}}})}})," ",e.jsx("label",{htmlFor:"is-team-temporarily-blocked-checkbox",children:"Is Temporarily Blocked"})]})]})]}),e.jsx("div",{className:"admin-header-spacer"}),e.jsxs("div",{className:"admin-puzzles",children:[x,b]})]})}function Ec(){te();const a=mt(),r=ee(h=>h.globalState.teamAdminData);ee(h=>h.globalState.teams);const{subscribedTeamId:s,setSubscribedTeamId:n,setNeedAdmin:i,setNeedTeamList:c}=Te(),[u,p]=_.useState("");if(_.useEffect(()=>{i(!0)},[i]),_.useEffect(()=>{c(!0)},[c]),_.useEffect(()=>()=>{n(a)},[n,a]),Object.keys(r).length===0)return e.jsx(We,{});const f=Object.keys(r).filter(h=>r[h].displayName.toLowerCase().indexOf(u.trim())>=0).sort().map(h=>{const g=r[h],t=s!==null&&s===h;return e.jsx("div",{children:e.jsx("button",{className:`admin-team-btn${t?" highlight":""}`,onClick:()=>{n(h)},children:g.displayName})},h)});return e.jsx("div",{className:"below-nav",children:e.jsxs("div",{className:"admin-root",children:[e.jsx("div",{className:"admin-sidebar",children:e.jsxs("div",{className:"admin-teams",children:[e.jsx("input",{type:"text",className:"admin-team-search-input",onChange:h=>{p(h.target.value.toLowerCase().trim())}}),f]})}),e.jsx("div",{className:"admin-main",children:e.jsx(Tc,{})})]})})}const wc=10*1e3,Nc=5*60*1e3,Cc=a=>{if(a.startsWith("PvP"))return"PvP";if(a.startsWith("Make Your Own"))return"MYO";if(a.startsWith("Bovine Social Media"))return"BSM";if(a.startsWith("Console-ation"))return"CP";a=a.replace("(and Logs)","");const r=[];let s=!1;for(const n of a){if(n==="'")continue;const i=n.match(/^[a-zA-Z]$/)!==null;(i?!s:n!==" ")&&r.push(n),s=i}return r.length>=7?`${r.slice(0,4).join("")}...`:r.join("")},Cs=a=>{switch(a){case me.NEW:return" ";case me.DIRTY:return"‚ö†Ô∏è";case me.SYNCING:return"‚è≥";case me.FAILED:return"üí•";case me.SYNCED:return"‚úÖ"}},Ac=(a,r,s,n)=>{const{displayName:i}=s[r],c=n[a];return c===0?i:`${i} ${c}`},va=(a,r,s,n)=>{const{puzName:i,battleGroupName:c,answer:u}=a;return{colKey:`${n??"puz"}-${i}`,displayName:Ac(i,c,r,s),emoji:r[c].emoji,puzzleLink:{battleGroupName:c,hasAnswer:u!==null}}},Ct=(a,r,s,n)=>a.map(i=>va(i,r,s,n)),Je=a=>a.map((r,s)=>e.jsx("col",{className:`${s===a.length-1?"big-board-group-end":""}`},r.colKey));function xa({teamId:a}){const r=ee(s=>s.globalState.teams);return e.jsx(Vt,{teamData:r[a]})}function rs({elemId:a,desc:r,state:s,onChange:n}){return e.jsxs("div",{className:"big-board-checkbox-option",children:[e.jsx("input",{type:"checkbox",id:a,defaultChecked:s,onChange:i=>{n(i.target.checked)}})," ",e.jsx("label",{htmlFor:a,children:r})]})}function ba(){const a=K(r=>r.setBigBoardTeamFilter);return e.jsxs("div",{className:"big-board-team-search",children:[e.jsx(W,{children:"üîç"})," ",e.jsx("input",{placeholder:"Filter teams...",onChange:r=>a(r.target.value.toLowerCase().trim())})]})}function ya(){const a=ke(d=>d.numTeamsPerPage),r=ke(d=>d.setNumTeamsPerPage),s=ke(d=>d.pageNum),n=ke(d=>d.setPageNum),[i,c]=_.useState(a.toString()),[u,p]=_.useState((s+1).toString()),f=ee(d=>d.globalState.teams),h=Object.keys(f).length,g=Math.ceil(h/a)-1,t=d=>{const m=Math.min(Math.max(0,d),g);n(m),p((m+1).toString())},o=()=>{const d=parseInt(i);if(Number.isInteger(d)&&d>=0){r(d);const m=Math.ceil(h/d)-1;s>m&&t(m)}},l=()=>{const d=parseInt(u);Number.isInteger(d)&&d>=0&&d<=g&&n(d-1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("input",{className:"big-board-num-teams-per-page-input",type:"text",inputMode:"numeric",value:i,onChange:d=>{c(d.target.value)},onBlur:()=>{o()},onKeyPress:d=>{d.key==="Enter"&&o()}})," ","/ page"]}),e.jsxs("div",{className:"big-board-page-num-buttons",children:[e.jsx("div",{className:"big-board-page-num-button",children:e.jsx("a",{href:"#",onClick:()=>t(0),children:"¬´"})}),e.jsx("div",{className:"big-board-page-num-button",children:e.jsx("a",{href:"#",onClick:()=>t(s-1),children:"‚Äπ"})}),e.jsx("div",{children:e.jsx("input",{className:"big-board-page-num-input",type:"text",inputMode:"numeric",value:u,onChange:d=>{p(d.target.value)},onBlur:()=>{l()},onKeyPress:d=>{d.key==="Enter"&&l()}})}),e.jsx("div",{className:"big-board-page-num-button",children:e.jsx("a",{href:"#",onClick:()=>t(s+1),children:"‚Ä∫"})}),e.jsx("div",{className:"big-board-page-num-button",children:e.jsx("a",{href:"#",onClick:()=>t(g),children:"¬ª"})})]})]})}function ln({colData:a,isActive:r,spectateLink:s}){const n=ke(b=>b.useEmojiHeaders),{colKey:i,displayName:c,shortName:u,emoji:p,puzzleLink:f}=a,[h,g]=_.useState(!1),{refs:t,floatingStyles:o,context:l}=Dr({open:h,onOpenChange:g,middleware:[Or(-8)]}),d=si(l),{getReferenceProps:m,getFloatingProps:v}=ni([d]),x=e.jsxs(e.Fragment,{children:[n&&p!==void 0&&p!==""?p:u??Cc(c),!r||s===void 0?null:e.jsx("a",{href:s,target:"_blank",rel:"noreferrer",children:"üëÅÔ∏è"})]});return e.jsxs("th",{className:r??!1?"big-board-active":"",children:[e.jsx("div",{className:"puzzle-title-header-link",ref:t.setReference,...m(),children:f===void 0?x:e.jsx(cs,{battleGroupName:f.battleGroupName,hasAnswer:f.hasAnswer,children:x})}),h&&e.jsx("div",{className:"puzzle-title-header-tooltip",ref:t.setFloating,style:o,...v(),children:c})]},i)}const ja=a=>![me.NEW,me.SYNCED].includes(a);function Ic({dirtyState:a={type:me.NEW,lastSyncTime:0},isSummary:r=!1,isFast:s=!1}){const n=Cs(a.type),i=Date.now()-a.lastSyncTime,c=ja(a.type),u=c&&i>(s?wc:Nc);return e.jsx("td",{className:`big-board-dirty-state-cell${r?" summary":""}${u?" danger":""}`,title:c?`Last sync: ${Ut(i,!0)} ago`:void 0,children:n})}const Zs=_.memo(Ic);function Es({numPerSecond:a,isSummary:r=!1}){return e.jsx("td",{className:`big-board-interval-metrics-cell${r?" summary":""}`,children:Math.round(a*10)<=0?null:a.toFixed(1)})}const _a=(a,r)=>{const s=K(p=>p.bigBoardTeamFilter),i=hs(null,!1,a).filter(({displayName:p})=>p.toLowerCase().includes(s)).map(({teamId:p})=>p);r!==void 0&&i.sort(r);const c=ke(p=>p.numTeamsPerPage),u=ke(p=>p.pageNum);return i.slice(u*c,(u+1)*c)},Sa=()=>{const a=ee(r=>r.globalState.puzzles);return Object.values(a).filter(({puzName:r,battleGroupName:s})=>{const{isFullPuzzle:n,answer:i}=a[s];return n&&i!==null&&r===s}).sort((r,s)=>r.order-s.order)},Pc=(a,r)=>Object.fromEntries(a.map(({teamId:s})=>{const n=r.teams[s],{fastSync:i,misc:c,masteryTree:u,decks:p,checkpoints:f,rooms:h,answers:g}=n??{},t={fastSync:i,misc:c,masteryTree:u,...Object.fromEntries(Object.entries(p??{}).map(([o,l])=>[`deck-${o}`,l])),...Object.fromEntries(Object.entries(f??{}).map(([o,l])=>[`checkpoint-${o}`,l])),...Object.fromEntries(Object.entries(h??{}).map(([o,l])=>[`puz-${o}`,l])),...Object.fromEntries(Object.entries(g??{}).map(([o,l])=>[`puz-${o}`,l]))};return[s,t]})),hr=(a,r)=>{const s=[me.NEW,me.SYNCED,me.DIRTY,me.FAILED,me.SYNCING];return s.indexOf(r.type)>s.indexOf(a.type)&&(a.type=r.type),ja(r.type)&&(a.lastSyncTime===0||r.lastSyncTime<a.lastSyncTime)&&(a.lastSyncTime=r.lastSyncTime),a},Dc=a=>{const r={},s={},n={};for(const[i,c]of Object.entries(a))for(const[u,p]of Object.entries(c))p!==void 0&&(r[p.type]=(r[p.type]??0)+1,s[i]=hr(s[i]??{type:me.NEW,lastSyncTime:0},p),n[u]=hr(n[u]??{type:me.NEW,lastSyncTime:0},p));return{dirtyStateCounts:r,teamDirtyStateSummaries:s,colDirtyStateSummaries:n}};function Oc(){const a=ke(N=>N.useEmojiHeaders),r=ke(N=>N.setUseEmojiHeaders),s=ke(N=>N.sortOrder),n=ke(N=>N.setSortOrder),i=te(),{setNeedAdmin:c,setNeedTeamList:u}=Te(),p=ze(N=>N.cardsDB),f=ee(N=>N.globalState.puzzles),h=ee(N=>N.globalState.battleGroups),g=ee(N=>N.globalState.serverHealth),t=zs(f,h),o=hs(null,!1,!0),l=Sa(),d=Object.values(f).filter(({puzName:N,battleGroupName:Q})=>{const{isFullPuzzle:oe,isCutscene:k,answer:O}=f[Q],{numPuzzles:H}=h[Q];return t[N],N===xe||Q===rt&&N!==Q||(oe||k)&&O===null&&(N!==Q||H===1)}).sort((N,Q)=>N.order-Q.order),m=d.filter(({puzName:N,battleGroupName:Q})=>Q===rt||$r(N,p).areCheckpointsAllowed()),v=o===null||g===null?null:Pc(o,g.dirtyState),x=v===null?null:Dc(v),b=(()=>{if(x===null||g===null)return null;const{teamDirtyStateSummaries:N}=x,{teamNumRequestsMetrics:Q}=g;switch(s){case js.LEADERBOARD:return null;case js.HEALTH:return(oe,k)=>{const O=N[oe],H=N[k],ue=(O==null?void 0:O.lastSyncTime)??0,be=(H==null?void 0:H.lastSyncTime)??0,Ze=(ue>0?0:1)-(be>0?0:1);if(Ze!==0)return Ze;if(ue===0&&be===0){const Ne=((O==null?void 0:O.type)??me.NEW)!==me.NEW,tt=((H==null?void 0:H.type)??me.NEW)!==me.NEW;return(Ne?0:1)-(tt?0:1)}return ue-be};case js.ACTIVITY:return(oe,k)=>{const O=(Q[oe]??{}).numPerInterval??0;return((Q[k]??{}).numPerInterval??0)-O}}})(),y=_a(!0,b??void 0);if(_.useEffect(()=>{c(!0)},[c]),_.useEffect(()=>{u(!0)},[u]),_.useEffect(()=>i.addSubscribeEffect({type:Pt.SERVER_HEALTH}),[i]),g===null||Object.keys(f).length===0||v===null||x===null)return e.jsx(We,{});const{fastSyncMetrics:j,slowSyncMetrics:T,checkAnswerMetrics:S,fastSyncQueueLength:w,numAuthsMetrics:P,numRequestsMetrics:E,teamNumAuthsMetrics:C,teamNumRequestsMetrics:R,numActivePeriodicTasksHandlers:M,numPendingSubmissionTasks:L,numCompletedRoomsToSync:D,teamInitQueueLength:I,numActiveConns:X,userTimeUsage:Y,systemTimeUsage:q,dirtyState:ce}=g,{dirtyStateCounts:J,teamDirtyStateSummaries:F,colDirtyStateSummaries:fe}=x,se=N=>{const Q=C[N];if(Q===void 0)return 0;const{intervalLength:oe,numPerInterval:k}=Q;return k/(oe/1e3)},ne=N=>{const Q=R[N];if(Q===void 0)return 0;const{intervalLength:oe,numPerInterval:k}=Q;return k/(oe/1e3)},pe={numAuthsPerSecond:0,numRequestsPerSecond:0};for(const N of Object.keys(C))pe.numAuthsPerSecond+=se(N);for(const N of Object.keys(R))pe.numRequestsPerSecond+=ne(N);const _e=[];for(let N=0;N<ri;N++)_e.push({colKey:`deck-${N}`,displayName:`Deck ${N+1}`});const de=Ct(d,h,t),Re=Ct(m,h,t,"checkpoint"),we=Ct(l,h,t),A=[{colKey:"fastSync",displayName:"Fast Sync",shortName:"Fast"},{colKey:"misc",displayName:"Misc. state",shortName:"Misc"},{colKey:"masteryTree",displayName:"Mastery Tree",shortName:"Mas.",puzzleLink:{battleGroupName:Ae,hasAnswer:!1}},..._e,...de,...Re,...we],z=y.map(N=>{ce.teams[N];const Q=se(N),oe=ne(N);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(xa,{teamId:N})}),e.jsx("td",{children:N}),e.jsx(Es,{numPerSecond:Q}),e.jsx(Es,{numPerSecond:oe}),e.jsx(Zs,{isSummary:!0,dirtyState:F[N]}),A.map(k=>e.jsx(Zs,{dirtyState:v[N][k.colKey],isFast:k.colKey==="fastSync"},k.colKey))]},N)});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"big-board",children:[e.jsxs("table",{children:[e.jsxs("colgroup",{children:[e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{className:"big-board-group-end"}),Je(_e),Je(de),Je(Re),Je(we)]}),e.jsxs("thead",{children:[e.jsxs("tr",{className:"big-board-header-groups",children:[e.jsx("th",{colSpan:8}),e.jsx("th",{colSpan:_e.length,children:e.jsx("div",{className:"big-board-header-group",children:"Decks"})}),e.jsx("th",{colSpan:de.length,children:e.jsx("div",{className:"big-board-header-group",children:"Rooms"})}),e.jsx("th",{colSpan:Re.length,children:e.jsx("div",{className:"big-board-header-group",children:"Checkpoints"})}),e.jsx("th",{colSpan:we.length,children:e.jsx("div",{className:"big-board-header-group",children:"Answers"})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Team"}),e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Auths / s"}),e.jsx("th",{children:"Reqs / s"}),e.jsx("th",{children:"[Summ.]"}),A.map(N=>e.jsx(ln,{colData:N},N.colKey))]})]}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"[Summary]"}),e.jsx("td",{}),e.jsx(Es,{numPerSecond:pe.numAuthsPerSecond,isSummary:!0}),e.jsx(Es,{numPerSecond:pe.numRequestsPerSecond,isSummary:!0}),e.jsx("td",{}),A.map(N=>e.jsx(Zs,{isSummary:!0,dirtyState:fe[N.colKey],isFast:N.colKey==="fastSync"},N.colKey))]}),z]})]}),e.jsx("div",{className:"big-board-right-padding"})]}),e.jsxs("div",{className:"health-footer",children:[e.jsxs("div",{className:"health-footer-metrics",children:[e.jsxs("div",{children:["Fast: ",es(j)]}),e.jsxs("div",{children:["Slow: ",es(T)]}),e.jsxs("div",{children:["Ans: ",es(S)]}),e.jsxs("div",{children:["Auths: ",es(P)]}),e.jsxs("div",{children:["Reqs: ",es(E)]})]}),e.jsxs("div",{className:"health-footer-bottom",children:[e.jsx(ba,{}),e.jsx(ya,{}),e.jsx(rs,{elemId:"use-emoji-headers-checkbox",desc:"Emoji",state:a,onChange:r}),e.jsxs("div",{className:"big-board-sort-selection",children:[e.jsx("label",{htmlFor:"big-board-sort-order",children:"Sort by:"}),e.jsx("select",{id:"big-board-sort-order",value:s,onChange:N=>{n(N.target.value)},children:Object.values(js).map(N=>e.jsx("option",{value:N,children:N},N))})]}),e.jsxs("div",{className:"health-footer-counts",children:[e.jsxs($,{text:"Dirty objects",children:[Cs(me.DIRTY)," ",J[me.DIRTY]??0]}),e.jsxs($,{text:"Objects in sync",children:[Cs(me.SYNCING)," ",J[me.SYNCING]??0]}),e.jsxs($,{text:"Failed syncs",children:[Cs(me.FAILED)," ",J[me.FAILED]??0]}),e.jsxs($,{text:"Fast sync queue length",children:["üêá ",w]}),e.jsxs($,{text:"Excess active periodic task handlers",children:["‚è±Ô∏è"," ",Math.max(M-1,0)]}),e.jsxs($,{text:"Pending answer submissions",children:["üìû ",L]}),e.jsxs($,{text:"Completed rooms pending sync",children:["üö™ ",D]}),e.jsxs($,{text:"Pending team inits",children:["üë• ",I]}),e.jsxs($,{text:"Active connections",children:["üîå ",X]}),e.jsxs($,{text:"User time",children:["U: ",(Y*100).toFixed(1),"%"]}),e.jsxs($,{text:"System time",children:["S: ",(q*100).toFixed(1),"%"]}),e.jsx("div",{className:"health-footer-bottom-spacer"})]})]})]})]})}function Rc({teamPuzState:a,huntEndTime:r,rank:s,masteryTreeSolveTime:n,finalBattleSolveTime:i,isFish:c,battleGroupNumMembers:u=0,spectateLink:p}){const{solveTime:f,numHintsUsed:h=0,numWrongGuesses:g=0,numMembers:t=0}=a??{},o=f!==void 0,l=a!==void 0,d=f!==void 0&&f>r,m=f!==void 0&&(c?n!==void 0&&f>n:i!==void 0&&f>i),x=[...o?["big-board-solved"]:g>0?["big-board-wrong"]:l?["big-board-unlocked"]:[],...h>0?["big-board-hinted"]:[],...d?["big-board-postsolved"]:[],...m?["big-board-backsolved"]:[],...t+u>0?["big-board-active"]:[]].join(" ");return e.jsxs("td",{className:x===""?void 0:x,title:f===void 0?void 0:`${m?"Backsolved":"Solved"} at ${new Date(f).toLocaleString()}`,children:[s===void 0?null:s+1,g===0?null:e.jsxs(e.Fragment,{children:["‚àí",g]}),h===0?null:e.jsxs("small",{children:["+",h]}),t===0||p===void 0?null:e.jsx("a",{href:p,target:"_blank",rel:"noreferrer",children:"üëÅÔ∏è"})]})}const Xs=_.memo(Rc);function Lc(){var oe;const a=ke(k=>k.useEmojiHeaders),r=ke(k=>k.setUseEmojiHeaders),s=ke(k=>k.collapseSubbattles),n=ke(k=>k.setCollapseSubbattles),i=ke(k=>k.showHidden),c=ke(k=>k.setShowHidden),u=ke(k=>k.showCardUnlocks),p=ke(k=>k.setShowCardUnlocks);K(k=>k.bigBoardTeamFilter);const f=te(),h=U(),{setNeedAdmin:g,setNeedTeamList:t}=Te(),o=ee(k=>k.globalState.teams),l=ee(k=>k.globalState.teamAdminData),d=Ds()??!1,m=ee(k=>k.globalState.puzzles),v=ee(k=>k.globalState.battleGroups),x=ee(k=>k.globalState.masteries),b=ee(k=>k.globalState.bigBoard),y=zs(m,v),j=_a(i),T=hs(null,!1),S=ze(k=>k.cardsDB),w=ot(),P=Sa(),E=Object.values(m).filter(({puzName:k,battleGroupName:O})=>{const{isFullPuzzle:H,isCutscene:ue,answer:be}=m[O],{numPuzzles:Ze}=v[O];return y[k],(H||k===xe)&&be===null&&(s?k===O:k!==O||Ze===1)}).sort((k,O)=>k.order-O.order),C=Object.values(m).filter(({puzName:k,battleGroupName:O})=>{const{isCutscene:H}=m[O];return H}).sort((k,O)=>k.order-O.order),R=Object.values(m).filter(({puzName:k,battleGroupName:O})=>O===rt&&k!==O).sort((k,O)=>k.order-O.order),M=Object.values(m).filter(({puzName:k,battleGroupName:O})=>O===Ws&&![Ws,wn].includes(k)).sort((k,O)=>k.order-O.order),L=Object.keys(S).filter(k=>S[k].cardUnlockGroupId!==null&&k!=="test-card"&&!w.isLegendary(k)).sort(),D=Object.keys(S).filter(k=>w.isLegendary(k)).sort();if(_.useEffect(()=>{g(!0)},[g]),_.useEffect(()=>{t(!0)},[t]),_.useEffect(()=>f.addSubscribeEffect({type:Pt.BIG_BOARD}),[f]),b===null||h===null||Object.keys(m).length===0)return e.jsx(We,{});const{huntEndTime:I}=h,X=Ct(E,v,y),Y=Ct(P,v,y),q=Ct(C,v,y),ce=Ct(R,v,y),J=M.map(({puzName:k})=>({colKey:`mastery-${k}`,displayName:x[k].displayName})),F=L.map(k=>({colKey:`card-${k}`,displayName:S[k].displayName})),fe=D.map(k=>({colKey:`card-${k}`,displayName:S[k].displayName})),se=[...X,...Y,...q,...ce,...J,...u?[...F,...fe]:[]],ne={},pe={},_e={},de={},Re=Object.fromEntries(Object.keys(b.teams).map(k=>[k,{numSolves:0,numWrongGuesses:0,numHintsUsed:0}])),we=Object.fromEntries(Object.keys(b.teams).map(k=>[k,{}]));for(const[k,O]of Object.entries(b.teams)){const{isHidden:H=!1}=o[k],ue=Re[k];for(const[be,Ze]of Object.entries(O.unlocks)){const{solveTime:Ne,numWrongGuesses:tt=0,numHintsUsed:ft=0,numMembers:_t=0}=Ze,{battleGroupName:Xe,isCutscene:Rt=!1}=m[be];de[be]??(de[be]={numUnlocks:0,numSolves:0,numWrongGuesses:0,numHintsUsed:0});const Z=de[be];Ne!==void 0&&(H||(Z.numSolves??(Z.numSolves=0),Z.numSolves++,pe[be]??(pe[be]=[]),pe[be].push({teamId:k,solveTime:Ne})),ti(be,Xe,Rt)&&(ue.lastSolveTime=Math.max(ue.lastSolveTime??0,Ne),ue.numSolves++)),ue.numWrongGuesses+=tt,ue.numHintsUsed+=ft,H||(Z.numUnlocks++,Z.numWrongGuesses+=tt,Z.numHintsUsed+=ft),s&&be!==Xe&&_t>0&&((oe=we[k])[Xe]??(oe[Xe]=0),we[k][Xe]+=_t)}}for(const{teamId:k}of T)ne[k]=Object.keys(ne).length;for(const[k,O]of Object.entries(pe)){O.sort((H,ue)=>H.solveTime-ue.solveTime);for(const[H,{teamId:ue}]of O.entries())_e[ue]??(_e[ue]={}),_e[ue][k]=H}const A=j.map(k=>{const{numHintsTotal:O=0,unlocks:H={},selectedPuzzles:ue={},enabledMasteries:be={},cardUnlocks:Ze={}}=b.teams[k]??{},{lastSolveTime:Ne=0,numSolves:tt=0,numWrongGuesses:ft=0,numHintsUsed:_t=0}=Re[k]??{},Xe=ne[k],Rt=!d||B.isImpersonate?null:l[k]??null;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(xa,{teamId:k})}),e.jsx("td",{children:Rt===null?null:e.jsx("a",{href:`${B.djangoBaseUrl}impersonate/${Rt.userId}`,children:e.jsx(W,{children:"üïµÔ∏è"})})}),e.jsx("td",{children:Xe!==void 0?Xe+1:null}),e.jsxs("td",{children:[tt<=0?null:tt,ft<=0?null:e.jsxs(e.Fragment,{children:["‚àí",ft]})]}),e.jsx("td",{children:_t<=0&&O<=0?null:`${_t} / ${O}`}),e.jsx("td",{children:Ne===void 0?null:new Date(Ne).toLocaleString()}),E.map(({puzName:Z})=>{var pt,qe,Cn;return e.jsx(Xs,{teamPuzState:H[Z],huntEndTime:I,rank:(pt=_e[k])==null?void 0:pt[Z],finalBattleSolveTime:(qe=H[jt])==null?void 0:qe.solveTime,isFish:!1,battleGroupNumMembers:((Cn=we[k])==null?void 0:Cn[m[Z].battleGroupName])??0,spectateLink:`/game/spectate/${Z}/${k}`},Z)}),P.map(({puzName:Z})=>{var pt,qe;return e.jsx(Xs,{teamPuzState:H[Z],huntEndTime:I,rank:(pt=_e[k])==null?void 0:pt[Z],masteryTreeSolveTime:(qe=H[Ws])==null?void 0:qe.solveTime,isFish:!0},Z)}),C.map(({puzName:Z})=>e.jsx(Xs,{teamPuzState:H[Z],huntEndTime:I,isFish:!1},Z)),R.map(({puzName:Z},pt)=>{const qe=ue[Z];return qe===void 0?e.jsx("td",{},Z):e.jsx(ln,{colData:va(m[qe],v,y),isActive:((H[Z]??{}).numMembers??0)>0,spectateLink:`/game/spectate/${Z}/${k}`},Z)}),M.map(({puzName:Z})=>e.jsx("td",{className:be[Z]!==void 0?"big-board-solved":H[Z]!==void 0?"big-board-unlocked":void 0},Z)),u?e.jsxs(e.Fragment,{children:[L.map(Z=>e.jsx("td",{className:Ze[Z]!==void 0?"big-board-solved":void 0},Z)),D.map(Z=>e.jsx("td",{className:Ze[Z]!==void 0?"big-board-solved":void 0},Z))]}):null]},k)}),z=[e.jsx("th",{children:"Team"},"team"),e.jsx("th",{},"impersonate"),e.jsx("th",{children:"#"},"rank"),e.jsx("th",{children:e.jsx(W,{children:"‚úÖ"})},"num-solves"),e.jsx("th",{children:e.jsx(W,{children:"üí°"})},"num-hints"),e.jsx("th",{children:"Last solve"},"last-solve")],N=(k,O)=>e.jsxs("tr",{children:[e.jsx("td",{children:k}),e.jsx("td",{colSpan:z.length-1}),E.map(({puzName:H})=>O(H)),P.map(({puzName:H})=>O(H)),e.jsx("td",{colSpan:C.length}),e.jsx("td",{colSpan:R.length}),e.jsx("td",{colSpan:M.length}),u?e.jsxs(e.Fragment,{children:[e.jsx("td",{colSpan:L.length}),e.jsx("td",{colSpan:D.length})]}):null]}),Q=(k,O)=>k===0||O===0?"":`${Math.round(100*k/O)}%`;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"big-board",children:[e.jsxs("table",{children:[e.jsxs("colgroup",{children:[z.map((k,O)=>e.jsx("col",{},O)),Je(X),Je(Y),Je(q),Je(ce),Je(J),u?e.jsxs(e.Fragment,{children:[Je(F),Je(fe)]}):null]}),e.jsxs("thead",{children:[e.jsxs("tr",{className:"big-board-header-groups",children:[e.jsx("th",{colSpan:z.length}),e.jsx("th",{colSpan:X.length,children:e.jsx("div",{className:"big-board-header-group",children:"Battles"})}),e.jsx("th",{colSpan:Y.length,children:e.jsx("div",{className:"big-board-header-group",children:"Questions"})}),e.jsx("th",{colSpan:q.length,children:e.jsx("div",{className:"big-board-header-group",children:"Cutscenes"})}),e.jsx("th",{colSpan:ce.length,children:e.jsx("div",{className:"big-board-header-group",children:"Instancers"})}),e.jsx("th",{colSpan:J.length,children:e.jsx("div",{className:"big-board-header-group",children:"Masteries"})}),u?e.jsxs(e.Fragment,{children:[e.jsx("th",{colSpan:F.length,children:e.jsx("div",{className:"big-board-header-group",children:"Card Unlocks"})}),e.jsx("th",{colSpan:fe.length,children:e.jsx("div",{className:"big-board-header-group",children:"Legendaries"})})]}):null]}),e.jsxs("tr",{children:[z,se.map(k=>e.jsx(ln,{colData:k},k.colKey))]})]}),e.jsxs("tbody",{children:[N("Solves",k=>{var O;return e.jsx("td",{className:"big-board-solved",children:((O=de[k])==null?void 0:O.numSolves)??0},k)}),N("Guesses",k=>{var O,H;return m[k].answer===null?e.jsx("td",{},k):e.jsx("td",{className:"big-board-wrong",children:(((O=de[k])==null?void 0:O.numWrongGuesses)??0)+(((H=de[k])==null?void 0:H.numSolves)??0)},k)}),N("Unlocks",k=>{var O;return e.jsx("td",{className:"big-board-unlocked",children:((O=de[k])==null?void 0:O.numUnlocks)??0},k)}),N("Hints",k=>{var O;return e.jsx("td",{className:"big-board-hinted",children:((O=de[k])==null?void 0:O.numHintsUsed)??0},k)}),N("%Solve/Guess",k=>{var O,H,ue;return m[k].answer===null?e.jsx("td",{},k):e.jsx("td",{children:Q(((O=de[k])==null?void 0:O.numSolves)??0,(((H=de[k])==null?void 0:H.numWrongGuesses)??0)+(((ue=de[k])==null?void 0:ue.numSolves)??0))},k)}),N("%Solve/Unlock",k=>{var O,H;return e.jsx("td",{children:Q(((O=de[k])==null?void 0:O.numSolves)??0,((H=de[k])==null?void 0:H.numUnlocks)??0)},k)}),A]})]}),e.jsx("div",{className:"big-board-right-padding"})]}),e.jsx("div",{className:"big-board-footer",children:e.jsxs("div",{className:"big-board-footer-options",children:[e.jsx(ba,{}),e.jsx(ya,{}),e.jsx(rs,{elemId:"use-emoji-headers-checkbox",desc:"Emoji",state:a,onChange:r}),e.jsx(rs,{elemId:"collapse-subbattles-checkbox",desc:"Collapse sub-battles",state:s,onChange:n}),e.jsx(rs,{elemId:"show-hidden-checkbox",desc:"Show hidden teams",state:i,onChange:c}),e.jsx(rs,{elemId:"show-card-unlocks-checkbox",desc:"Show card unlocks",state:u,onChange:p})]})})]})}const Mc="/static/game/assets/keros-notes-3da263ba.png";function ws({dialogue:a}){return e.jsx(Bs,{speaker:De.KERO_DOS,dialogue:`Kero Pro Tip
${a}`})}function zc(){const a=U(),r=a!==null&&Object.values(a.puzzles).some(i=>i.solveTime!==void 0&&i.puzName===i.battleGroupName&&a.battleGroups[i.battleGroupName].isLegendary),s=a!==null&&a.masteries[_n].isEnabled,n=un(Object.keys((a==null?void 0:a.cardUnlocks)??{}),0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"top-more-actions"}),e.jsx("h1",{children:"Kero‚Äôs Notes"}),e.jsxs("main",{className:"keros-notes",children:[e.jsx(mn,{className:"keros-notes-kero-image",keroLayers:n}),e.jsxs("div",{children:[e.jsxs("div",{className:"keros-notes-p",children:["Welcome to the GalactiCosmiCave! ",e.jsx(V,{text:"$(o¬¥‚ñΩ`o)$"})," ","This cave is filled with all sorts of creatures to meet and befriend!"]}),e.jsxs("div",{className:"keros-notes-p",children:["Befriending a creature is simple ‚Äî all it takes is a wave of the uwuand! But with all the CHAOS going around, it seems the uwuand hasn‚Äôt been working too well lately. No worries, that just means we‚Äôve gotta battle the creatures first! I‚Äôve already shown you the ropes, but these notes should help in case you forget anything. Hope you find them useful in your journey as"," ",e.jsx("strong",{children:"GalactiCardCaptors"}),"!"]})]}),e.jsxs("div",{className:"keros-note",children:[e.jsx("h4",{id:"website",children:e.jsx("a",{href:"#website",children:"The Website"})}),e.jsxs("div",{className:"keros-notes-p",children:["Battles and cutscenes are synced across your team, so everyone can enjoy them together! ",e.jsx(V,{text:"$‚ô°Ôºº(Ôø£‚ñΩÔø£)Ôºè‚ô°$"})," You can also split up and try different battles at once, or go back and replay cutscenes at your own pace."]}),e.jsxs("div",{className:"keros-notes-p",children:["On top of that, there‚Äôs also the"," ",e.jsx($e,{to:{pathname:"/game/prep/instancer"},children:"Instancer"}),"! The Instancer is a special place maintained by a group of spiders known as the Overworked Web Operatives! It comes with three rooms that you can use to create additional instances of battles or cutscenes at any time. These instances behave exactly like their ‚Äúreal‚Äù counterparts ‚Äî and if you win in an instance, you win in real life!"]}),e.jsxs("div",{className:"keros-notes-p",children:["Some battles allow you to save your progress. You also get an autosave at the start of each turn, in case you need it. Use this power wisely! ",e.jsx(V,{text:"$„ÉΩ(„Éª‚àÄ„Éª)Ôæâ$"})]}),e.jsx(ws,{dialogue:"There‚Äôs no undo button, so SAVE your GAMES! $(·µî.·µî)$"})]}),e.jsxs("div",{className:"keros-note",children:[e.jsx("h4",{id:"decks",children:e.jsx("a",{href:"#decks",children:"Decks"})}),e.jsx("div",{className:"keros-notes-p",children:"Cards let you call upon creatures you‚Äôve befriended to assist you in battles! You choose which friends to bring into a battle by building a deck of cards. A deck may contain up to 2 copies of each card, must have at least 1 card, and cannot have more than 30 cards in total."}),r?e.jsx("div",{className:"keros-notes-p",children:"Some creatures are legendaries! Legendaries are super powerful, but they don‚Äôt like each other very much. A deck may contain at most one legendary card."}):null]}),e.jsxs("div",{className:"keros-note",children:[e.jsx("h4",{id:"battles",children:e.jsx("a",{href:"#battles",children:"Battles"})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx("img",{src:Mc,className:"kero-game-diagram"})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"Battles are held on a rectangular field of Spaces, usually with 5 columns and 6 rows. The Spaces closer to your side, the bottom of the field, are Friendly Spaces; the other Spaces are Enemy Spaces."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"Spaces can be occupied by Units, which are either Creatures or Bases. Each Space can hold at most one Unit at any given time. The triangle in the upper-right corner shows who controls that Unit: Friendly Units have a ‚ñ≥ or ‚ñ≤; Enemy Units have a ‚ñº or ‚ñΩ."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"Whenever a Unit‚Äôs text refers to something Friendly, it means belonging to the Unit‚Äôs owner. ‚ÄúEnemy‚Äù has the opposite meaning: belonging to the opponent of the Unit‚Äôs owner."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"Each Unit has some amount of Health, and can receive Damage. Damage persists across turns. When a Unit holds Damage equal to or in excess of its Health, it is Destroyed. (Other effects may Destroy a Unit directly without impacting its Health.) Destroyed Units are removed from the field."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"When a Unit has at least one Damage, it displays a fraction [Health ‚àí Damage] / [Health] to indicate the amount of additional Damage it can sustain before being Destroyed; this quantity, Health ‚àí Damage, is also called Current Health. For example, a Unit at 4/7 Health that gains 2 Health will be at 6/9, not 6/7 or 4/9."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"Creatures on the field are either Ready or Unready. Most Actions can only be performed with Ready Creatures. Ready Creatures display a solid triangle (‚ñ≤ or ‚ñº); Unready Creatures appear desaturated and display a hollow triangle (‚ñ≥ or ‚ñΩ). Creatures that have an Action, whether or not they‚Äôre Ready, glow."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"You also maintain a draw pile, as well as a hand of cards that you can Summon Creatures from. At the start of each battle, your deck gets shuffled randomly into your draw pile. Then, you draw the top four cards from your draw pile into your hand. You also draw a card at the start of each turn, which means that you begin your first turn with five cards in hand. If your deck has less than five cards, you start the battle with your entire deck in hand and no cards in your draw pile."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"Generally, you lose when all your Bases are Destroyed. But with these Creatures, you can never tell! $‚ï∞(‚ñî‚àÄ‚ñî)‚ïØ$ It seems that different battles might have different conditions for winning or losing. Sometimes, winning isn‚Äôt even enough to befriend a Creature! How puzzling."})}),e.jsx(ws,{dialogue:"Zooming out might make things better on smaller screens! $„ÉΩ(¬∞„Äá¬∞)Ôæâ$"})]}),e.jsxs("div",{className:"keros-note",children:[e.jsx("h4",{id:"turns",children:e.jsx("a",{href:"#turns",children:"Turns"})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"At the beginning of your turn, you draw one card from your draw pile (if it has cards) and all Friendly Creatures become Ready."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"During your turn, you may perform any number of Actions in any order (subject to their restrictions and costs). Some Actions cost Food. You can get Food as a result of other Actions or passive Unit effects. The Food you have is displayed on the left of the battle field. Food does not persist across turns."})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"The Actions you can perform are:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(V,{text:"Summon a Creature from your hand: Pay the Creature‚Äôs Summon cost in Food, then place the Creature on an Empty Friendly Space. When Summoned, Creatures start Unready."})}),e.jsxs("li",{children:[e.jsx(V,{text:"Attack with a Ready Creature: Pay one Food of its Faction. (For Cows, you must specifically pay a Food it can Create.) The Creature deals Damage equal to its Power to another Enemy Unit and Unreadies. Normally, the target of the Attack must not be Protected from the attacker."}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(V,{text:"A Unit on a Friendly Space Protects Friendly Units behind it from Units on Enemy Spaces. Some Unit effects may grant Protection in other circumstances."})}),e.jsx("li",{children:e.jsx(V,{text:"A Unit is Sneaky if it is in an Enemy Space. Generally, Sneaky Units do not Protect any Friendly Units, but no Enemy Units are Protected from Sneaky Units."})})]})]}),e.jsx("li",{children:e.jsx(V,{text:"Move a Ready Creature: (This does not cost Food.) The Creature moves to an Adjacent Empty Space and Unreadies."})}),e.jsx("li",{children:e.jsx(V,{text:"Create with a Ready Creature: You gain one Food of the Creature‚Äôs Faction, and the Creature Unreadies. (Gray Cows may Create one of two Foods; see below.)"})}),e.jsx("li",{children:e.jsx(V,{text:"Activate the Special of a Ready Creature: Pay the cost (if any) and Unready the Creature, then perform the Special."})}),e.jsx("li",{children:e.jsx(V,{text:"Activate the Flex of a Creature: Pay the cost (if any), then perform the Flex. Unlike other Actions, the Creature does not need to be Ready, and activating the Flex doesn‚Äôt Unready the Creature."})}),s?e.jsx("li",{children:e.jsx(V,{text:"Draw a card: Pay two of any Food, then draw a card from your draw pile into your hand."})}):null]}),e.jsx(ws,{dialogue:"For a Sneaky Creature, all Enemy Units are Unprotected! $(>·¥ó‚Ä¢)$"})]}),e.jsxs("div",{className:"keros-note",children:[e.jsx("h4",{id:"food",children:e.jsx("a",{href:"#food",children:"Food"})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"Every Creature belongs to a Faction, indicated by their card‚Äôs color. Each Faction is associated with a preferred Food which they can Create or use to Attack."})}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(V,{text:"Boars produce {R} (Boarries). Their cards are red."})}),e.jsx("li",{children:e.jsx(V,{text:"Dryads produce {P} (Flower). Their cards are purple."})}),e.jsx("li",{children:e.jsx(V,{text:"Dinosaurs produce {G} (Eggs). Their cards are green."})}),e.jsx("li",{children:e.jsx(V,{text:"Bees produce {Y} (Honey). Their cards are yellow."})}),e.jsx("li",{children:e.jsx(V,{text:"Cows are a little unusual. A Cow is either white, gray or black, as shown by its card‚Äôs color. White Cows Create {W} (Whipped Cream) and require it to Attack. Black Cows Create {B} (Butter) and require it to Attack. Gray Cows Create either {W} (Whipped Cream) or {B} (Butter), and can use either to Attack. When Creating with a gray Cow, it is up to you to decide whether to Create {W} (Whipped Cream) or {B} (Butter)."})})]}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"There are two costs that aren‚Äôt Foods:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(V,{text:"{.} can be paid with any Food."})}),e.jsx("li",{children:e.jsx(V,{text:"{(W/B)} (Milk) can be paid with either {W} (Whipped Cream) or {B} (Butter)."})})]}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"There is one type of Food that is not a cost:"})}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx(V,{text:"{?} (Pie) can pay for any cost."})})}),e.jsx("div",{className:"keros-notes-p",children:e.jsx(V,{text:"You can often also tell a Creature‚Äôs Faction from its Summon cost. Apart from {.}, the Food in a Creature‚Äôs Summon cost is almost always the Food associated with its Faction. For Cows, this means {W} (Whipped Cream) for white Cows, and {B} (Butter) for black Cows. Gray Cows are different ‚Äî their Summon cost may contain any combination of {W} (Whipped Cream), {B} (Butter) or {(W/B)} (Milk), but will always contain at least one {(W/B)} (Milk)."})}),e.jsx(ws,{dialogue:"Everyone loves Pie! $(Ôæâ‚óï„ÉÆ‚óï)Ôæâ*:ÔΩ•Ôæü‚úß$"})]})]})]})}const Fc=a=>{const{teamId:r,cardName:s,displayName:n,isUnlocked:i}=a,c=te(),p=ot().isLegendary(s);return e.jsxs("div",{className:"unlock-puzzle-display",children:[e.jsx($,{text:i?"Set locked":"Set unlocked",children:e.jsx("button",{onClick:()=>{c.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideCardUnlocked:{[s]:!i}}}})},children:i?"üîë":"üîí"})}),e.jsx("div",{className:"unlock-puzzle-card",children:e.jsx(ai,{content:`${p?"üëë ":""}${n}`})})]},s)},Bc=a=>{const{teamId:r,puzName:s,displayName:n,isSolved:i,isUnlocked:c,hasAnswer:u,icon:p}=a,f=te();return e.jsxs("div",{className:"unlock-puzzle-display",children:[e.jsx($,{text:c?"Set locked":"Set unlocked",children:e.jsx("button",{onClick:()=>{f.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideUnlocked:{[s]:!c}}}})},children:c?"üîë":"üîí"})}),e.jsx($,{text:i?"Set unsolved":"Set solved",children:e.jsx("button",{disabled:!c||s===xe||s===rt,onClick:()=>{f.sendReq({type:G.ADMIN_MODIFY,teams:{[r]:{overrideSolved:{[s]:!i}}}})},children:i?"‚úÖÔ∏è":"üî≤Ô∏è"})}),c?e.jsxs(cs,{battleGroupName:s,hasAnswer:u,children:[p," ",n]}):e.jsxs("div",{children:[p," ",n]})]},s)};function $c(){const{subscribedTeamId:a}=Te(),r=ee(f=>f.globalState.teamAdminData),s=ze(f=>f.cardsDB),n=U(a),i=ot();if(n===null||Object.keys(s).length===0||r[n.teamId]===void 0)return e.jsx(We,{});const{teamId:c,cardUnlocks:u}=n,p=Is(s).sort((f,h)=>{const g=i.isLegendary(f),t=i.isLegendary(h);return g!==t?(g?1:0)-(t?1:0):f.localeCompare(h)}).map(f=>e.jsx(Fc,{teamId:c,cardName:f,displayName:s[f].displayName,isUnlocked:u[f]!==void 0},f));return e.jsx("div",{className:"unlock-puzzles",children:p})}function Uc(){const{subscribedTeamId:a}=Te(),r=ee(h=>h.globalState.teamAdminData),s=ee(h=>h.globalState.puzzles),n=ee(h=>h.globalState.battleGroups),i=U(a);if(i===null||Object.keys(s).length===0||r[i.teamId]===void 0)return e.jsx(We,{});const{teamId:c,puzzles:u}=i,p=zs(s,n),f=Object.values(s).filter(({puzName:h})=>p[h]===0).filter(({isCutscene:h,isFullPuzzle:g,puzName:t})=>h||g||t===xe||t===rt).sort((h,g)=>h.order-g.order).map(({puzName:h,battleGroupName:g})=>{const t=u[h],o=p[h],{isCutscene:l,answer:d}=s[h],{isLegendary:m,displayName:v}=n[g],x=d!==null,b=o===0?v:`${v}, Stage ${o}`;return e.jsx(Bc,{teamId:c,puzName:h,displayName:b,isSolved:(t==null?void 0:t.solveTime)!==void 0,isUnlocked:t!==void 0,hasAnswer:x,icon:_r(x,g,l,m)},h)});return e.jsx("div",{className:"unlock-puzzles",children:f})}function Gc(){const{subscribedTeamId:a}=Te(),r=ee(y=>y.globalState.teamAdminData),s=U(a),n=te(),i=ee(y=>y.globalState.puzzles),c=ze(y=>y.cardsDB),u=ot();if(s===null||Object.keys(i).length===0||Object.keys(c).length===0||r[s.teamId]===void 0)return e.jsx(We,{});const{battleGroups:p,cardUnlocks:f,puzzles:h,teamId:g}=s,t=()=>{n.resetServer()},o=()=>n.sendReq({type:G.ADMIN_MODIFY,teams:{[g]:{overrideUnlocked:Object.fromEntries(Object.keys(i).filter(y=>{const{isCutscene:j,isFullPuzzle:T}=i[y];return j||T||[xe,rt].includes(y)}).map(y=>[y,!0]))}}}),l=y=>{n.sendReq({type:G.ADMIN_MODIFY,teams:{[g]:{overrideCardUnlocked:Object.fromEntries(y.map(j=>[j,!0]))}}})},d=()=>l(Is(c).filter(y=>!u.isLegendary(y))),m=()=>l(Is(c).filter(y=>u.isLegendary(y))),v=Object.keys(p).filter(y=>!p[y].isCutscene).filter(y=>{var j;return(j=h[y])==null?void 0:j.unlockTime}).length,x=Object.keys(p).filter(y=>!p[y].isCutscene).filter(y=>{var j;return(j=h[y])==null?void 0:j.solveTime}).length,b=Object.keys(f).length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hunt-unlocks-buttons",children:[e.jsx("button",{onClick:t,children:"Reset all progress"}),e.jsx("button",{onClick:o,children:"Unlock all puzzles"}),e.jsx("button",{onClick:d,children:"Unlock all non-legendaries"}),e.jsx("button",{onClick:m,children:"Unlock all legendaries"})]}),e.jsxs("p",{children:["Puzzles unlocked: ",v," (of 41)",e.jsx("br",{}),"Puzzles solved: ",x," (of 39)",e.jsx("br",{}),"Cards unlocked: ",b," (of 63)"]})]})}function Hc(){te();const a=ee(i=>i.globalState.teamAdminData),{setNeedAdmin:r,setSubscribedTeamBattle:s,setSubscribedTeamFishPuzzle:n}=Te();return _.useEffect(()=>{r(!0)},[r]),_.useEffect(()=>{s(null),n(null)},[s,n]),Object.keys(a).length===0?e.jsx(We,{}):e.jsxs("div",{className:"unlock-body",children:[e.jsx("div",{className:"top-more-actions"}),e.jsx("h1",{children:"Unlocking"}),e.jsxs("main",{children:[e.jsxs("div",{className:"note",children:[e.jsx(W,{tag:"span",children:"‚ö†Ô∏è"})," ",e.jsx("b",{children:"Be careful!"})," There are no confirmations for anything you click on this page."]}),e.jsxs("p",{children:[e.jsx("b",{children:"To experience the hunt like a team during the hunt would"}),", click ‚ÄúReset all progress‚Äù and start at the"," ",e.jsx(Vr,{path:"/game/map",href:`${B.djangoBaseUrl}puzzles`,children:"map"}),". You won‚Äôt need to use this page again, unless you want to skip puzzles you‚Äôre stuck on. Progress is saved locally in your browser and synced across all your browser tabs. Note that there is currently no support for interaction between multiple postsolvers, and that all global leaderboards have been frozen."]}),e.jsxs("p",{children:["The default initial posthunt state has all puzzles and all non-legendaries unlocked to support postsolving individual puzzles independently. To restore this state, click ‚ÄúReset all progress‚Äù, ‚ÄúUnlock all puzzles‚Äù, then ‚ÄúUnlock all non-legendaries‚Äù."," ",e.jsx("b",{children:"Do not click ‚ÄúUnlock all legendaries‚Äù."})]}),e.jsxs("p",{children:["You can also manage unlocks within a battle by accessing the"," ",e.jsx("b",{children:"Battle Unlocks"})," panel from the ‚Äúüîì‚Äù group in the navbar. This panel only becomes available once you have a battle open."]}),e.jsx("h3",{children:"Hunt unlocks"}),e.jsx(Gc,{}),e.jsx("h3",{children:"Individual unlocks"}),e.jsxs(st.Container,{items:[{label:"Puzzles and cutscenes",content:e.jsx(Uc,{})},{label:"Cards",content:e.jsx($c,{})}],children:[e.jsx(st.ButtonList,{className:"unlock-button-list",children:e.jsx(st.Buttons,{})}),e.jsxs("p",{children:[e.jsx(W,{tag:"span",children:"‚ö†Ô∏è"})," ",e.jsx("b",{children:"Note:"})," Setting a card or puzzle to locked may appear to fail silently if your existing solves would cause the puzzle or card to be immediately unlocked."]}),e.jsx(st.Content,{})]})]})]})}function Kc(){const[a,r]=_.useState(!1),[s,n]=_.useState(!1),[i,c]=_.useState(!1),u=Us(m=>m.addToUserLog);ae(m=>m.sendStep),ae(m=>m.setSendStep);const p=Wt(m=>m.getServerInterfaceController),f=ze(m=>m.cardsDB),h=ze(m=>m.setCardsDB),g=p(),[t,o]=he(),l=ci("/game"),d=Ee();return K(m=>m.setNavPuzName),_.useEffect(()=>{h(di(Tr))},[h]),_.useEffect(()=>{if(g===null)return;const m=g.onErrorEvent.addListener(b=>{u(`Received error "${b.errCode}".`)}),v=g.addAuthEffect(()=>{u("Connected to server.")}),x=g.connectionControllers[Rr.MAIN].afterDisconnectEvent.addListener(({numReconnections:b,reconnectDelayInSeconds:y})=>{n(y<0),b===0?u("Disconnected from server. Reconnecting..."):y<0?u("Reconnection failed; giving up."):u(`Failed to reconnect. Reconnecting in ${y} seconds...`)});return()=>{m(),v(),x()}},[g,u]),_.useEffect(()=>{if(g!==null)return g.addStuckEffect(m=>{switch(m.errCode){case Ns.TEAM_TEMP_BLOCKED:{c(!0);break}default:r(!0)}})},[g,r,c]),_.useEffect(()=>(document.documentElement.classList.add("game-base"),()=>document.documentElement.classList.remove("game-base")),[]),_.useEffect(()=>{l&&d({pathname:"map",search:t.toString()},{replace:!0})},[l,d,t]),Object.keys(f).length===0?e.jsx(Oe,{size:128}):e.jsxs("div",{className:"page-contents",children:[e.jsxs(Ht,{isOpen:s||a,title:"Disconnected",children:["Sorry, something went wrong.",e.jsx("br",{}),"Please refresh the page."]}),e.jsxs(Ht,{isOpen:i,title:"Down for Maintenance",children:["The site is down for maintenance.",e.jsx("br",{}),"Please try again after a while, and monitor your email for updates!"]}),e.jsx(qr,{}),e.jsx(ui,{getKey:m=>m.pathname})]})}function Wc(){const[a,r]=he(),s=Ee(),n=mi(),i=K(l=>l.setHasRouter),c=K(l=>l.routerNavigatePath),u=K(l=>l.setRouterNavigatePath),p=at(),f=pr(),h=p??f,g=K(l=>l.setNavPuzName);_.useEffect(()=>{i(!0)},[i]),_.useEffect(()=>{c!==null&&(s({pathname:c,search:a.toString()}),u(null))},[c,u,a,s]),_.useEffect(()=>{g(h)},[h,g]),_.useEffect(()=>{const l=document.querySelector(".tray");l.style.transform=""},[n]);const{teamName:t}=Ge(),o=U();return _.useEffect(()=>{document.title=(()=>{var l,d,m;if(t)return t;if(o){const{puzzles:v,battleGroups:x}=o;if(h){const b=(d=x[(l=v[h])==null?void 0:l.battleGroupName])==null?void 0:d.displayName;if(b)return b}if((m=v[as])!=null&&m.solveTime)return"GalactiCardCaptors‚ú®Ô∏è"}return B.documentTitle})()},[h,t,o]),_.useEffect(()=>{var l;(l=o==null?void 0:o.puzzles[Os])!=null&&l.solveTime&&(document.querySelector("link[rel=icon]").href="/static/images/favicon.56ccd37f.ico")},[o]),mc(),e.jsx(qr,{})}const Yc=oi([{path:"/",element:e.jsx(Wc,{}),errorElement:e.jsx(gi,{}),children:[{path:"game",element:e.jsx(Kc,{}),children:[{path:"prep/:puzName",element:e.jsx(Qi,{})},{path:"prep/:puzName/start",element:e.jsx(hc,{})},...["battle","cutscene"].flatMap(a=>[{path:`${a}/:puzName`,element:e.jsx(cr,{})},{path:`${a}/:puzName/start`,element:e.jsx(qs,{})},{path:`${a}/:puzName/start/:slot`,element:e.jsx(qs,{})},{path:`${a}/:puzName/restart/:slot`,element:e.jsx(qs,{restart:!0})}]),{path:"spectate/:puzName/:spectateTeamId",element:e.jsx(cr,{})},{path:"deck/:slot/:puzName",element:e.jsx(pc,{})},{path:"mastery",element:e.jsx(ur,{})},{path:"mastery/:puzName",element:e.jsx(ur,{})},{path:"victory/start",element:e.jsx(fc,{})},{path:"map",element:e.jsx(_c,{})},{path:"admin",element:e.jsx(Ec,{})},{path:"unlock",element:e.jsx(Hc,{})},{path:"bigboard",element:e.jsx(Lc,{})},{path:"health",element:e.jsx(Oc,{})}]},{path:"game/keros_notes",element:e.jsx(zc,{})},{path:"game/art_credits",element:e.jsx(li,{})},{path:"teams",element:e.jsx($n,{})},{path:"teams/:mode",element:e.jsx($n,{})},{path:"team/:teamName",element:e.jsx(fi,{})}]}]);function Zc(){return e.jsx(ii,{router:Yc})}export{Zc as default};
//# sourceMappingURL=App-8b2140c6.js.map
